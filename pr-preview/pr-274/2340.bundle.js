/*! For license information please see 2340.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_carbon_ai_chat_examples_demo=self.webpackChunk_carbon_ai_chat_examples_demo||[]).push([[2340],{577:function(e,t,n){var r;n.d(t,{y:function(){return r}}),function(e){e[e.MISCELLANEOUS=1]="MISCELLANEOUS",e[e.LOCAL_MESSAGE=2]="LOCAL_MESSAGE",e[e.MESSAGE=3]="MESSAGE",e[e.COMPONENT=4]="COMPONENT",e[e.USER=6]="USER",e[e.DEVICE_ID=8]="DEVICE_ID",e[e.FILE=9]="FILE"}(r||(r={}))},948:function(e,t,n){function r(e){return Array.isArray(e)?e:[e]}async function s(e,t){for(let n=0;n<e.length;n++){const r=e[n];await t(r,n,e)}}function i(e,t,n){const r=function(e,t){if(e)for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}(e,t);return-1===r?void 0:e[r]}function a(e,t,n){for(let r=e.length-1;r>=0;r--){const s=t[e[r]];if(n(s,r,e))return s}}function o(e){return e&&e.length?e[e.length-1]:null}n.d(t,{PQ:function(){return s},U1:function(){return a},Uk:function(){return i},_j:function(){return r},ns:function(){return o}})},1120:function(e,t,n){n.d(t,{CL:function(){return c},aT:function(){return d},fS:function(){return u}});var r=n(9633),s=n(6753),i=n(7391),a=n(2870),o=n(577);function c(e,t,n=!1,r=!1){const a={ui_state:{id:(0,i.xN)(t.id,e)||(0,s.u)(o.y.LOCAL_MESSAGE),needsAnnouncement:!t.history.from_history,disableFadeAnimation:r},item:e,fullMessageID:t.id};return n&&(a.ui_state.isWelcomeResponse=!0),a}function u(e){return function(e){const t=(0,i.jv)(e);return{originalMessage:t,localMessage:c(e,t)}}({response_type:r.sP.INLINE_ERROR,text:e})}function d(e,t,n,r,s){const{item:a}=e;if((0,i._x)(a))e.ui_state.gridLocalMessageItemIDs=a.rows.map(s=>s.cells.map(s=>{const i=[];return E("items",e,s.items,i,t,n,r,t=>g(e.item,t),!1),i}));else if((0,i.Ex)(a))e.ui_state.itemsLocalMessageItemIDs=[],E("items",e,a.items,e.ui_state.itemsLocalMessageItemIDs,t,n,r,e=>g(a,e),s);else{const o=a.body||a.panel?.body;if(o&&(e.ui_state.bodyLocalMessageItemIDs=[],E("body",e,o,e.ui_state.bodyLocalMessageItemIDs,t,n,r,e=>g(a,e),!(0,i.Cx)(a))),!s)return;const c=a.footer||a.panel?.footer;c&&(e.ui_state.footerLocalMessageItemIDs=[],E("footer",e,c,e.ui_state.footerLocalMessageItemIDs,t,n,r,e=>function(e,t){return!!(0,i.Mm)(t)&&(!(0,i.Cx)(e)||!(0,i.Cx)(t))}(a,e),!(0,i.Cx)(a)))}}function E(e,t,n,r,s,o,u,E,g){n.forEach(n=>{if(E(n)){const e=c(n,s,!1,!0);r.push(e.ui_state.id),u.push(e),(0,i.bY)(e.item)&&d(e,s,o,u,g)}else(0,a.yA)(`The "${t.item.response_type}" response type does not support "${n.response_type}" in "${e}" array.`)})}function g(e,t){switch(e.response_type){case r.sP.CARD:return!(0,i._0)(t)&&(0,i.Wo)(t);case r.sP.CAROUSEL:return(0,i._0)(t);case r.sP.BUTTON:return e.button_type===r.kw.SHOW_PANEL&&(0,i.Wo)(t);case r.sP.GRID:return!(0,i._0)(t)&&(0,i.Wo)(t);default:return!1}}},1748:function(e,t,n){n.d(t,{$z:function(){return W},A$:function(){return re},AM:function(){return de},Ay:function(){return Ae},By:function(){return o},CA:function(){return Ee},Cw:function(){return B},Ew:function(){return F},FG:function(){return _},GZ:function(){return E},HD:function(){return ie},IE:function(){return ue},JX:function(){return I},Ky:function(){return fe},Mp:function(){return se},Mu:function(){return O},NO:function(){return c},P9:function(){return $},Pq:function(){return d},Qz:function(){return _e},RT:function(){return G},Rj:function(){return s},T0:function(){return p},TD:function(){return A},TP:function(){return Z},TV:function(){return he},Tp:function(){return T},UC:function(){return z},Uy:function(){return L},VG:function(){return l},XU:function(){return x},Xi:function(){return S},YO:function(){return f},ZB:function(){return te},_J:function(){return g},_P:function(){return y},_V:function(){return ce},bH:function(){return ee},c:function(){return h},c7:function(){return D},dD:function(){return ne},ds:function(){return k},ex:function(){return X},fO:function(){return oe},gA:function(){return j},hU:function(){return R},hp:function(){return ge},iA:function(){return M},iS:function(){return ae},ko:function(){return N},m:function(){return i},nS:function(){return q},qO:function(){return J},qe:function(){return w},qu:function(){return V},qx:function(){return K},rJ:function(){return pe},rq:function(){return H},sK:function(){return U},uc:function(){return C},vI:function(){return u},vf:function(){return Q},vp:function(){return v},wq:function(){return P},ww:function(){return m},xi:function(){return b},yM:function(){return a},zM:function(){return Y}});var r=n(6753);const s="CHANGE_STATE",i="UPDATE_BOT_NAME",a="UPDATE_BOT_AVATAR_URL",o="UPDATE_LAUNCHER_AVATAR_URL",c="UPDATE_MAIN_HEADER_TITLE",u="HYDRATE_CHAT",d="HYDRATE_MESSAGE_HISTORY",E="ADD_LOCAL_MESSAGE_ITEM",g="REMOVE_MESSAGES",h="UPDATE_LOCAL_MESSAGE_ITEM",p="SET_APP_STATE_VALUE",f="ADD_IS_TYPING_COUNTER",_="ADD_IS_LOADING_COUNTER",A="ADD_IS_HYDRATING_COUNTER",S="SET_VIEW_STATE",l="SET_VIEW_CHANGING",T="SET_INITIAL_VIEW_CHANGE_COMPLETE",y="UPDATE_CSS_VARIABLES",I="MESSAGE_SET_OPTION_SELECTED",N="SET_MESSAGE_UI_PROPERTY",M="SET_MESSAGE_HISTORY_PROPERTY",C="MERGE_HISTORY",D="SET_LAUNCHER_PROPERTY",v="SET_LAUNCHER_CONFIG_PROPERTY",m="ANNOUNCE_MESSAGE",R="SET_CHAT_MESSAGES_PROPERTY",P="RESTART_CONVERSATION",O="ACCEPTED_DISCLAIMER",w="ADD_MESSAGE",L="UPDATE_HOME_SCREEN_CONFIG",b="UPDATE_HAS_SENT_NON_WELCOME_MESSAGE",G="UPDATE_PERSISTED_CHAT_STATE",H="SET_TOUR_DATA",U="CLEAR_TOUR_DATA",k="CHANGE_STEP_IN_TOUR",F="SET_HOME_SCREEN_IS_OPEN",B="UPDATE_LAUNCHER_CONFIG",V="UPDATE_MESSAGE",x="SET_LAUNCHER_MINIMIZED",W="CLOSE_IFRAME_PANEL",J="OPEN_IFRAME_CONTENT",X="SET_CONVERSATIONAL_SEARCH_CITATION_PANEL_IS_OPEN",q="SET_CUSTOM_PANEL_OPTIONS",Y="SET_CUSTOM_PANEL_OPEN",j="GO_BACK_TO_HOME",$="UPDATE_INPUT_STATE",z="SET_IS_PAGE_VISIBLE",K="ADD_INPUT_FILE",Q="CLEAR_INPUT_FILES",Z="REMOVE_INPUT_FILE",ee="REMOVE_LOCAL_MESSAGE_ITEM",te="FILE_UPLOAD_INPUT_ERROR",ne="ADD_NESTED_MESSAGES",re="SET_RESPONSE_PANEL_IS_OPEN",se="SET_PANEL_RESPONSE_CONTENT",ie="STREAMING_ADD_CHUNK",ae="STREAMING_START",oe="STREAMING_MERGE_HISTORY",ce="ADD_NOTIFICATION",ue="REMOVE_ALL_NOTIFICATIONS",de="REMOVE_NOTIFICATIONS",Ee="UPDATE_CHAT_HEADER_CONFIG",ge="UPDATE_MAX_VISIBLE_HEADER_OBJECTS",he="SET_STOP_STREAMING_BUTTON_VISIBLE",pe="SET_STOP_STREAMING_BUTTON_DISABLED",fe="SET_STREAM_ID",_e="UPDATE_MAIN_HEADER_AVATAR",Ae={changeState(e){return{type:s,partialState:e}},chatWasHydrated(){return{type:u}},hydrateMessageHistory(e){return{type:d,messageHistory:e}},removeMessages(e){return{type:g,messageIDs:e}},restartConversation(){return{type:P}},addLocalMessageItem(e,t,n,r){return{type:E,messageItem:e,message:t,addMessage:n,addAfterID:r}},addMessage(e){return{type:w,message:e}},updateLocalMessageItem(e){return{type:h,messageItem:e}},updateMessage(e){return{type:V,message:e}},messageSetOptionSelected(e,t){return{type:I,messageID:e,sentMessage:t}},updatePersistedChatState(e){return{type:G,chatState:e}},setTourData(e){return{type:H,newActiveTourMessageID:e}},clearTourData(){return{type:U}},changeStepInTour(e){return{type:k,newStepNumber:e}},updateHasSentNonWelcomeMessage(e){return{type:b,hasSentNonWelcomeMessage:e}},setAppStateValue(e,t){return{type:p,key:e,value:t}},addIsTypingCounter(e){return{type:f,addToIsTyping:e}},addIsLoadingCounter(e){return{type:_,addToIsLoading:e}},addIsHydratingCounter(e){return{type:A,addToIsHydrating:e}},updateBotName(e){return{type:i,name:e}},updateMainHeaderTitle(e){return{type:c,title:e}},updateBotAvatarURL(e){return{type:a,url:e}},updateCSSVariables(e,t,n){return{type:y,variables:e,publicVars:t,whiteLabelVariables:n}},updateHomeScreenConfig(e){return{type:L,homeScreenConfig:e}},setViewState(e){return{type:S,viewState:e}},setViewChanging(e){return{type:l,viewChanging:e}},setInitialViewChangeComplete(e){return{type:T,changeComplete:e}},setMessageUIProperty(e,t,n){return{type:N,localMessageID:e,propertyName:t,propertyValue:n}},setLauncherProperty(e,t){return{type:D,propertyName:e,propertyValue:t}},setLauncherConfigProperty(e,t,n){return{type:v,propertyName:e,propertyValue:t,launcherType:n}},setMessageHistoryProperty(e,t,n){return{type:M,messageID:e,propertyName:t,propertyValue:n}},mergeMessageHistory(e,t){return{type:C,messageID:e,history:t}},setMessageErrorState(e,t){return Ae.setMessageHistoryProperty(e,"error_state",t)},setMessageWasAnnounced(e){return Ae.setMessageUIProperty(e,"needsAnnouncement",!1)},announceMessage(e){return{type:m,message:e}},setChatMessagesStateProperty(e,t){return{type:R,propertyName:e,propertyValue:t}},addNotification(e){const t=(0,r.u)();return{type:ce,notificationID:t,notification:e}},removeNotifications({groupID:e,notificationID:t}){return{type:de,groupID:e,notificationID:t}},removeAllNotifications(){return{type:ue}},acceptDisclaimer(){return{type:O}},setHomeScreenIsOpen(e){return{type:F,isOpen:e}},updateLauncherConfig(e){return{type:B,launcherConfig:e}},setLauncherMinimized(){return{type:x}},closeIFramePanel(){return{type:W}},setIFrameContent(e){return{type:J,messageItem:e}},setViewSourcePanelIsOpen(e,t,n){return{type:X,isOpen:e,citationItem:t,relatedSearchResult:n}},setCustomPanelConfigOptions(e){return{type:q,options:e}},setCustomPanelOpen(e){return{type:Y,isOpen:e}},toggleHomeScreen(){return{type:j}},updateInputState(e,t){return{type:$,newState:e,isInputToAgent:t}},setIsBrowserPageVisible(e){return{type:z,isVisible:e}},addInputFile(e,t){return{type:K,file:e,isInputToAgent:t}},removeFileUpload(e,t){return{type:Z,fileID:e,isInputToAgent:t}},removeLocalMessageItem(e){return{type:ee,localMessageItemID:e}},fileUploadInputError(e,t,n){return{type:te,fileID:e,errorMessage:t,isInputToAgent:n}},clearInputFiles(e){return{type:Q,isInputToAgent:e}},addNestedMessages(e){return{type:ne,localMessageItems:e}},setResponsePanelIsOpen(e){return{type:re,isOpen:e}},setResponsePanelContent(e,t=!1){return{type:se,localMessageItem:e,isMessageForInput:t}},streamingStart(e){return{type:ae,messageID:e}},streamingMergeHistory(e,t){return{type:oe,messageID:e,history:t}},streamingAddChunk(e,t,n,r){return{type:ie,fullMessageID:e,chunkItem:t,isCompleteItem:n,disableFadeAnimation:r}},updateChatHeaderConfig(e){return{type:Ee,chatHeaderConfig:e}},setMaxVisibleHeaderObjects(e){return{type:ge,maxTotal:e}},setStopStreamingButtonVisible(e){return{type:he,isVisible:e}},setStopStreamingButtonDisabled(e){return{type:pe,isDisabled:e}},setStreamID(e){return{type:fe,currentStreamID:e}},updateMainHeaderAvatar(e){return{type:_e,config:e}}}},2340:function(e,t,n){n.r(t),n.d(t,{HumanAgentServiceImpl:function(){return x},createService:function(){return J},validateCustomServiceDesk:function(){return X}});var r=n(8690),s=n(1122),i=n(9499),a=n(1120),o=n(1748),c=n(9763),u=n(3092),d=n(9280),E=n(9080),g=n(7391),h=n(2870),p=n(5041),f=n(8625),_=n(5505),A=n(5230),S=n(948),l=n(9633);function T(e,t){return{localMessages:e,originalMessage:t}}async function y(e,t,n,r=!0){const s=function(e,t,n){const r=t?.nickname;let s;switch(e){case l.Xb.AGENT_JOINED:s=r?"agent_agentJoinedName":"agent_agentJoinedNoName";break;case l.Xb.RELOAD_WARNING:s="agent_youConnectedWarning";break;case l.Xb.AGENT_LEFT_CHAT:s=r?"agent_agentLeftChat":"agent_agentLeftChatNoName";break;case l.Xb.AGENT_ENDED_CHAT:s=r?"agent_agentEndedChat":"agent_agentEndedChatNoName";break;case l.Xb.TRANSFER_TO_AGENT:s=r?"agent_transferring":"agent_transferringNoName";break;case l.Xb.USER_ENDED_CHAT:s="agent_youEndedChat";break;case l.Xb.CHAT_WAS_ENDED:s="agent_conversationWasEnded";break;case l.Xb.DISCONNECTED:s="agent_disconnected";break;case l.Xb.RECONNECTED:s="agent_reconnected";break;case l.Xb.SHARING_REQUESTED:s="agent_sharingRequested";break;case l.Xb.SHARING_ACCEPTED:s="agent_sharingAccepted";break;case l.Xb.SHARING_DECLINED:s="agent_sharingDeclined";break;case l.Xb.SHARING_CANCELLED:s="agent_sharingCancelled";break;case l.Xb.SHARING_ENDED:s="agent_sharingEnded";break;default:return""}return s&&n.formatMessage({id:s},{personName:r})}(e,n,t.intl),i=I(e),{originalMessage:a,localMessage:o}=i;return o.item.text=s,n&&(a.history||(a.history={}),a.history.agent_profile=n),r&&await t.fire({type:_.xp.AGENT_PRE_RECEIVE,data:a}),(0,d.o)(a),r&&await t.fire({type:_.xp.AGENT_RECEIVE,data:a}),i}function I(e){const t={response_type:l.sP.TEXT,agent_message_type:e},n=(0,g.jv)(t);return{localMessage:(0,a.CL)(t,n),originalMessage:n}}async function N(e,t,n,r,s){r&&await(0,S.PQ)(e,async({localMessages:e,originalMessage:t})=>{await(0,S.PQ)(e,async(e,n)=>{await s.actions.handleUserDefinedResponseItems(e,t),s.store.dispatch(o.Ay.addLocalMessageItem(e,t,0===n))})})}async function M(e,t,n){const r=function(e){const{agent_botReturned:t}=e;if(!t)return null;const{originalMessage:n,localMessage:r}=I(null);return r.item.text=t,{originalMessage:n,localMessage:r}}(n.store.getState().languagePack);if(r){const s=n.restartCount;(0,A.Ah)(()=>{s===n.restartCount&&N([T([r.localMessage],r.originalMessage)],0,0,!t,n)},e)}}async function C(e,t,n,r,s){const i=await y(e,s,t,n);await N([T([i.localMessage],i.originalMessage)],0,0,!r,s)}var D=n(6895);const{FROM_USER:v,RECONNECTED:m,DISCONNECTED:R,AGENT_ENDED_CHAT:P,AGENT_JOINED:O,USER_ENDED_CHAT:w,CHAT_WAS_ENDED:L,TRANSFER_TO_AGENT:b,AGENT_LEFT_CHAT:G,RELOAD_WARNING:H,SHARING_CANCELLED:U,SHARING_DECLINED:k,SHARING_ACCEPTED:F,SHARING_REQUESTED:B,SHARING_ENDED:V}=l.Xb;class x{constructor(e){this.chatStarted=!1,this.showingDisconnectedError=!1,this.isAgentTyping=!1,this.uploadingFiles=new Set,this.showLeaveWarning=!0,this.serviceManager=e}getCustomServiceDeskName(){return this.serviceManager.store.getState().config.public.serviceDeskFactory?this.serviceDesk.getName?.():void 0}async initialize(){if(this.serviceDesk)throw new Error("A service desk has already been created!");const{store:e,instance:t}=this.serviceManager,n=e.getState(),{config:s,persistedToBrowserStorage:i}=n,a=(0,r.A)(i.chatState.agentState.serviceDeskState);if(this.serviceDeskCallback=new W(this.serviceManager,this),s.public.serviceDeskFactory){const e={callback:this.serviceDeskCallback,instance:t,persistedState:a};this.serviceDesk=await s.public.serviceDeskFactory(e),X(this.serviceDesk),(0,h.cY)("Initializing a custom service desk")}this.showLeaveWarning=!this.serviceDesk?.reconnect}async startChat(e,t){if(!this.serviceDesk)throw new Error("A service desk has not been configured.");if(this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.isSuspended&&await this.endChat(!0,!0,!1),this.chatStarted)throw new Error("A chat is already running. A call to endChat must be made before a new chat can start.");const{serviceManager:n}=this;try{this.chatStarted=!0,this.isAgentTyping=!1,this.uploadingFiles.clear(),this.serviceManager.store.dispatch((0,c.cg)(this.uploadingFiles.size>0));const r={type:_.xp.AGENT_PRE_START_CHAT,message:t};if(await n.fire(r),r.cancelStartChat)return this.chatStarted=!1,await this.fireEndChat(!1,!0),void n.store.dispatch((0,c.np)(!1,null));const s=n.store.getState().config.public.serviceDesk?.agentJoinTimeoutSeconds;s&&(this.waitingForAgentJoinedTimer=setTimeout(()=>this.handleAgentJoinedTimeout(),1e3*s)),n.store.dispatch((0,c.np)(!0,e.ui_state.id)),await this.serviceDesk.startChat(t,{preStartChatPayload:r.preStartChatPayload})}catch(e){throw(0,h.yA)("[startChat] An error with the service desk occurred.",e),this.serviceDeskCallback&&await this.serviceDeskCallback.setErrorStatus({type:f.By.CONNECTING,logInfo:e}),n.store.dispatch((0,c.np)(!1,null)),this.chatStarted=!1,this.cancelAgentJoinedTimer(),e}}async firePreEndChat(e){const t={type:_.xp.AGENT_PRE_END_CHAT,endedByAgent:e,preEndChatPayload:null,cancelEndChat:!1};return await this.serviceManager.fire(t),t}async fireEndChat(e,t){await this.serviceManager.fire({type:_.xp.AGENT_END_CHAT,endedByAgent:e,requestCancelled:t})}async endChat(e,t=!0,n=!0){if(!this.chatStarted||!this.serviceDesk)return;const{isConnected:r}=this.persistedAgentState();let s;if(r&&(s=await this.firePreEndChat(!1),s.cancelEndChat))return;const i=e?w:L;await this.doEndChat(!1,s?.preEndChatPayload,t,n,i)}async doEndChat(e,t,n,r,s){const{isConnected:i}=this.persistedAgentState(),a=this.isSuspended();this.cancelAgentJoinedTimer(),this.closeScreenShareRequestModal(f.Ri.CANCELLED);try{await(0,E.$)(this.serviceDesk.endChat({endedByAgent:e,preEndChatPayload:t}),5e3)}catch(e){(0,h.yA)("[doEndChat] An error with the service desk occurred.",e)}if(i&&n){const{agentProfile:e}=this.persistedAgentState();await C(s,e,!0,a,this.serviceManager)}this.chatStarted=!1,this.isAgentTyping=!1,this.serviceManager.store.dispatch((0,c._0)()),await this.fireEndChat(e,!i),i&&r&&await M(1500,a,this.serviceManager)}async sendMessageToAgent(e,t){if(!this.serviceDesk||!this.chatStarted)return;const{serviceManager:n}=this;(0,d.o)(t);const r=(0,g.r2)(e);r.input.agent_message_type=v,await n.fire({type:_.xp.AGENT_PRE_SEND,data:r,files:t});const s=(0,i.A)(r,r.input.text),a=s.ui_state.id,o=[];s.item.text&&o.push(T([s],r)),t.forEach(e=>{const t=(0,g.jS)(e),n=(0,i.A)(t,t.input.text,e.id);o.push(T([n],t)),this.uploadingFiles.add(e.id)}),this.serviceManager.store.dispatch((0,c.cg)(this.uploadingFiles.size>0)),await N(o,0,0,!this.isSuspended(),n);let E=!1,p=!1;setTimeout(()=>{E||p||this.setMessageErrorState(s.fullMessageID,u.J.RETRYING)},3e3),setTimeout(()=>{E||this.setMessageErrorState(s.fullMessageID,u.J.FAILED)},2e4);const f={filesToUpload:t};try{await this.serviceDesk.sendMessageToAgent(r,a,f),E=!0,this.setMessageErrorState(s.fullMessageID,u.J.NONE),await n.fire({type:_.xp.AGENT_SEND,data:r,files:t})}catch(e){p=!0,(0,h.yA)("[sendMessageToAgent] An error with the service desk occurred.",e),this.setMessageErrorState(s.fullMessageID,u.J.FAILED)}}filesSelectedForUpload(e){if(this.serviceDesk&&this.chatStarted)try{this.serviceDesk.filesSelectedForUpload?.(e)}catch(e){(0,h.yA)("[userReadMessages] An error with the service desk occurred.",e)}}async userReadMessages(){if(this.serviceDesk&&this.chatStarted)try{await this.serviceDesk.userReadMessages()}catch(e){(0,h.yA)("[userReadMessages] An error with the service desk occurred.",e)}}async checkAreAnyAgentsOnline(e){let t;const n=this.serviceManager.restartCount;if(this.serviceDesk?.areAnyAgentsOnline)try{const n=this.serviceManager.store.getState().config.public.serviceDesk?.availabilityTimeoutSeconds,r=n?1e3*n:5e3,s=await(0,E.$)(this.serviceDesk.areAnyAgentsOnline(e),r);t=!0===s?f.Gf.ONLINE:!1===s?f.Gf.OFFLINE:f.Gf.UNKNOWN}catch(e){(0,h.yA)("Error attempting to get agent availability",e),t=f.Gf.OFFLINE}else t=f.Gf.UNKNOWN;return n===this.serviceManager.restartCount&&this.serviceManager.fire({type:_.xp.AGENT_ARE_ANY_AGENTS_ONLINE,areAnyAgentsOnline:t}),t}async userTyping(e){if(this.serviceDesk&&this.chatStarted)try{await(this.serviceDesk.userTyping?.(e))}catch(e){(0,h.yA)("[userTyping] An error with the service desk occurred.",e)}}setMessageErrorState(e,t){this.serviceManager.store.dispatch(o.Ay.setMessageErrorState(e,t))}async handleAgentJoinedTimeout(){const e=this.serviceManager.store.getState().languagePack.errors_noAgentsJoined,{originalMessage:t,localMessage:n}=(0,a.fS)(e);await N([T([n],t)],0,0,!this.isSuspended(),this.serviceManager),this.endChat(!1)}cancelAgentJoinedTimer(){this.waitingForAgentJoinedTimer&&(clearTimeout(this.waitingForAgentJoinedTimer),this.waitingForAgentJoinedTimer=null)}async screenShareUpdateRequestState(e){if(!this.persistedAgentState().isConnected)return;let t;switch(this.closeScreenShareRequestModal(e),e){case f.Ri.ACCEPTED:t=F;break;case f.Ri.DECLINED:t=k;break;case f.Ri.CANCELLED:t=U;break;case f.Ri.ENDED:t=V;break;default:return}await this.addAgentLocalMessage(t)}async screenShareStop(){this.serviceManager.store.dispatch((0,c.F)(!1)),await this.addAgentLocalMessage(V),await(this.serviceDesk?.screenShareStop?.())}async handleHydration(e,t){const{store:n}=this.serviceManager;let r=!1;const{isConnected:s}=this.persistedAgentState();if(s){if(this.chatStarted=!0,e&&this.serviceDesk?.reconnect)try{n.dispatch((0,c.AF)(!0)),setTimeout(this.serviceManager.appWindow.requestFocus),r=await this.serviceDesk.reconnect()}catch(e){(0,h.yA)("Error while trying to reconnect to an agent.",e)}if(n.dispatch((0,c.AF)(!1)),!this.persistedAgentState().isConnected)return void(this.chatStarted=!1);if(setTimeout(this.serviceManager.appWindow.requestFocus),r)this.showLeaveWarning=!1;else{this.chatStarted=!1;const e=this.isSuspended();if(n.dispatch((0,c._0)()),t){const{agentProfile:t}=this.persistedAgentState();await C(l.Xb.CHAT_WAS_ENDED,t,!1,e,this.serviceManager),await M(0,e,this.serviceManager)}}}}closeScreenShareRequestModal(e){this.serviceManager.store.dispatch((0,c.KT)(!1)),this.screenShareRequestPromise&&(this.screenShareRequestPromise.doResolve(e),this.screenShareRequestPromise=null),this.serviceManager.store.dispatch((0,c.F)(e===f.Ri.ACCEPTED))}async addAgentLocalMessage(e,t,n=!0,r=!0){t||(t=this.persistedAgentState().agentProfile);const{localMessage:s,originalMessage:i}=await y(e,this.serviceManager,t,n);await N([T([s],i)],0,0,!this.isSuspended(),this.serviceManager)}persistedAgentState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState}isSuspended(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.isSuspended}}class W{constructor(e,t){this.serviceManager=e,this.service=t}updateCapabilities(e){this.serviceManager.store.dispatch((0,c.qb)((0,r.A)(e)))}async updateAgentAvailability(e){this.service.chatStarted&&this.serviceManager.store.dispatch((0,c.hB)(e))}async agentJoined(e){this.service.chatStarted&&(this.service.cancelAgentJoinedTimer(),this.serviceManager.store.dispatch((0,c.BC)(e)),await this.service.addAgentLocalMessage(O,e),this.service.showLeaveWarning&&(await this.service.addAgentLocalMessage(H,null,!1,!1),this.service.showLeaveWarning=!1))}async agentReadMessages(){this.service.chatStarted&&(0,h.cY)("[ServiceDeskCallbackImpl] agentReadMessages")}async agentTyping(e){this.persistedAgentState().isConnected&&e!==this.service.isAgentTyping&&(this.serviceManager.store.dispatch((0,c.oP)(e)),this.service.isAgentTyping=e)}async sendMessageToUser(e,t){if(!this.service.chatStarted||!e)return;const n="string"==typeof e?(0,g.Z2)(e):e;(0,g.Wf)(n),n.output?.generic?.length&&n.output.generic.forEach(e=>{e.agent_message_type||(e.agent_message_type=l.Xb.FROM_AGENT)});const{serviceManager:r}=this;let s;void 0===t?s=this.persistedAgentState().agentProfile:(s=this.persistedAgentState().agentProfiles[t],s||(s=this.persistedAgentState().agentProfile,s&&(0,h.yA)(`Got agent ID ${t} but no agent with that ID joined the conversation. Using the current agent instead.`))),await r.fire({type:_.xp.AGENT_PRE_RECEIVE,data:n,agentProfile:s}),n.history.agent_profile=s;const i=n.output.generic.map(e=>(0,a.CL)(e,n));await N([T(i,n)],0,0,!this.service.isSuspended(),this.serviceManager),await r.fire({type:_.xp.AGENT_RECEIVE,data:n,agentProfile:s})}async beginTransferToAnotherAgent(e){this.service.chatStarted&&(e&&this.serviceManager.store.dispatch((0,c.BC)(e)),await this.service.addAgentLocalMessage(b,e))}async agentLeftChat(){this.service.chatStarted&&(await this.service.addAgentLocalMessage(G),this.service.isAgentTyping=!1,this.serviceManager.store.dispatch((0,c.VD)()))}async agentEndedChat(){if(!this.service.chatStarted)return;const e=await this.service.firePreEndChat(!0);e.cancelEndChat||await this.service.doEndChat(!0,e.preEndChatPayload,!0,!0,P)}async setErrorStatus(e){if(!this.service.chatStarted)return;const{type:t,logInfo:n}=e,{store:r}=this.serviceManager,{isConnecting:s}=r.getState().agentState;switch(n&&(0,h.yA)(`An error occurred in the service desk (type=${t})`,n),s&&e.type===f.By.DISCONNECTED&&e.isDisconnected&&(e={type:f.By.CONNECTING}),e.type){case f.By.DISCONNECTED:e.isDisconnected?(this.service.showingDisconnectedError=!0,await this.service.addAgentLocalMessage(R,null,!0,!1),r.dispatch(o.Ay.updateInputState({isReadonly:!0},!0))):this.service.showingDisconnectedError&&(this.service.showingDisconnectedError=!1,await this.service.addAgentLocalMessage(m,null,!0,!1),r.dispatch(o.Ay.updateInputState({isReadonly:!1},!0)));break;case f.By.CONNECTING:{const{languagePack:t}=this.serviceManager.store.getState(),n=e.messageToUser||t.errors_connectingToAgent,{originalMessage:r,localMessage:i}=(0,a.fS)(n);await N([T([i],r)],0,0,!this.service.isSuspended(),this.serviceManager),this.serviceManager.store.dispatch((0,c.np)(!1,null)),this.service.chatStarted=!1,this.service.cancelAgentJoinedTimer(),await this.service.fireEndChat(!1,s);break}case f.By.USER_MESSAGE:this.service.setMessageErrorState(e.messageID,u.J.FAILED)}}async setFileUploadStatus(e,t,n){const{store:r}=this.serviceManager;if(r.getState().allMessagesByID[e])if(D.aT.COMPLETE,t){if(r.dispatch(o.Ay.setMessageHistoryProperty(e,"file_upload_status",D.aT.COMPLETE)),r.dispatch(o.Ay.setMessageHistoryProperty(e,"error_state",u.J.FAILED)),u.J.FAILED,n){const{originalMessage:e,localMessage:t}=(0,a.fS)(n);t.item.agent_message_type=l.Xb.INLINE_ERROR,await N([T([t],e)],0,0,!this.service.isSuspended(),this.serviceManager)}}else r.dispatch(o.Ay.setMessageHistoryProperty(e,"file_upload_status",D.aT.SUCCESS)),r.dispatch(o.Ay.announceMessage({messageID:"fileSharing_ariaAnnounceSuccess"}));else t&&r.dispatch(o.Ay.fileUploadInputError(e,n,!0));this.service.uploadingFiles.delete(e),this.serviceManager.store.dispatch((0,c.cg)(this.service.uploadingFiles.size>0))}async screenShareRequest(){return this.persistedAgentState().isConnected?(this.service.screenShareRequestPromise||(this.service.screenShareRequestPromise=(0,p.H)(),this.serviceManager.store.dispatch((0,c.KT)(!0)),await this.service.addAgentLocalMessage(B)),this.service.screenShareRequestPromise):Promise.reject(new Error("Cannot request screen sharing if no chat is in progress."))}async screenShareEnded(){const e=this.serviceManager.store.getState().agentState.isScreenSharing,t=this.service.screenShareRequestPromise;this.service.closeScreenShareRequestModal(f.Ri.CANCELLED),e?(this.serviceManager.store.dispatch((0,c.F)(!1)),await this.service.addAgentLocalMessage(V)):t&&await this.service.addAgentLocalMessage(U)}persistedAgentState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState}persistedState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.serviceDeskState}updatePersistedState(e,t=!0){const{store:n}=this.serviceManager;let i;i=t?(0,s.A)({},n.getState().persistedToBrowserStorage.chatState.agentState.serviceDeskState,e):(0,r.A)(e),n.dispatch((0,c.HO)((0,d.o)(i)))}}function J(e){return new x(e)}function X(e){if(e)if("object"!=typeof e)(0,h.yA)(`The custom service desk does not appear to be valid. The type should be "object" but is "${typeof e}"`,e);else{["startChat","endChat","sendMessageToAgent"].forEach(t=>{const n=e[t];"function"!=typeof n&&(0,h.yA)(`The custom service desk does not appear to be valid. The type of property "${t}"should be "function" but is "${typeof n}"`,n,e)});const t=e.getName?.();if(!t)throw Error("The custom service desk does not have a name.");if(t&&("string"!=typeof t||t.length>40))throw new Error(`The custom service desk name "${t}" is not valid.`)}else(0,h.yA)("The custom service desk does not appear to be valid. No service desk was provided.",e)}},3092:function(e,t,n){var r;n.d(t,{J:function(){return r}}),function(e){e[e.NONE=1]="NONE",e[e.FAILED=2]="FAILED",e[e.RETRYING=3]="RETRYING",e[e.WAITING=4]="WAITING"}(r||(r={}))},5041:function(e,t,n){function r(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});return n.doResolve=t=>{n.isResolved=!0,n.isComplete=!0,e(t)},n.doReject=e=>{n.isRejected=!0,n.isComplete=!0,t(e)},n.isResolved=!1,n.isRejected=!1,n.isComplete=!1,n}n.d(t,{H:function(){return r}})},5230:function(e,t,n){n.d(t,{Ah:function(){return f},PB:function(){return p},a3:function(){return E},cT:function(){return g},pz:function(){return u},w9:function(){return h},yS:function(){return d}});var r=n(4880),s=n(711);const i="undefined"!=typeof window&&"undefined"!=typeof navigator,a=i?(0,r.o0)():void 0;let o=0,c=0;i&&(o=window.screen.width,c=window.screen.height);const u="iOS"===a?.os,d=u||"Android OS"===a?.os,E=d&&(o<500||c<500),g=E&&o<500,h=(0,s.A)(function(){if(!i||!window.sessionStorage)return!1;try{return window.sessionStorage.setItem("web-chat-test-item","true"),window.sessionStorage.getItem("web-chat-test-item"),window.sessionStorage.removeItem("web-chat-test-item"),!0}catch{return!1}});function p(e){try{return new URL(e).hostname}catch{return e}}function f(e,t){return t?setTimeout(e,t):(e(),null)}},6753:function(e,t,n){n.d(t,{u:function(){return s}});var r=n(8139);function s(e){return(0,r.A)()}},7391:function(e,t,n){n.d(t,{$H:function(){return m},$Q:function(){return l},Bj:function(){return T},Cx:function(){return w},D6:function(){return H},Dc:function(){return p},E_:function(){return y},Ex:function(){return P},I3:function(){return Y},Ll:function(){return S},Mm:function(){return O},OL:function(){return G},Of:function(){return E},Or:function(){return j},R2:function(){return u},Rt:function(){return k},SP:function(){return A},Sq:function(){return I},Sv:function(){return d},U7:function(){return f},Wf:function(){return g},Wo:function(){return F},XV:function(){return J},Xk:function(){return U},Z2:function(){return D},_0:function(){return R},_x:function(){return V},bY:function(){return L},eK:function(){return C},ee:function(){return B},f9:function(){return W},jS:function(){return M},jv:function(){return v},kZ:function(){return X},ks:function(){return h},p0:function(){return _},qH:function(){return x},r2:function(){return N},xN:function(){return q}});var r=n(8690),s=n(948),i=n(6753),a=n(9633),o=n(6895),c=n(577);const u="main";function d(e){return e&&void 0!==e.output}function E(e){return e?.item.response_type===a.sP.DATE}function g(e){return e.id||(e.id=(0,i.u)(c.y.MESSAGE)),e.thread_id||(e.thread_id=u),e.history||(e.history={}),e.history.timestamp||(e.history.timestamp=Date.now()),void 0===e.history.from_history&&(e.history.from_history=!1),e}function h(e){return void 0!==e?.input}function p(e){return Boolean(e.item.agent_message_type)}function f(e){return e?.input?.message_type===a.s9.EVENT}function _(e){return e&&"text"===e.response_type&&void 0!==e.text}function A(e){return e.response_type===a.sP.PAUSE&&1==e.typing}function S(e){return e.response_type===a.sP.PAUSE}function l(e){return e?.response_type===a.sP.OPTION&&void 0!==e.options}function T(e,t){const n={id:(0,i.u)(c.y.MESSAGE),thread_id:u,...(0,r.A)(e.value)};return n.history={label:e.label,related_message_id:t},n}function y(e,t){const n={id:(0,i.u)(c.y.MESSAGE),thread_id:u,input:null};return e.value?.input?.text?n.input=(0,r.A)(e.value.input):n.input={text:e.label},n.history={related_message_id:t},n}function I(){return g({id:(0,i.u)(c.y.MESSAGE),input:{text:""},history:{silent:!0,is_welcome_request:!0},thread_id:u})}function N(e){return g({input:{text:e,message_type:a.s9.TEXT}})}function M(e){return g({id:e.id,input:{text:e.file.name,message_type:a.Co.FILE,agent_message_type:a.Xb.FROM_USER},history:{file_upload_status:o.aT.UPLOADING}})}function C(e,t,n){const r=N(e);return r.history={label:t,related_message_id:n},r}function D(e,t=u,n=a.sP.TEXT,r){const s={response_type:n,text:e};return{id:(0,i.u)(c.y.MESSAGE),thread_id:t,output:{generic:[s]}}}function v(e,t){return g({output:{generic:[e]}})}function m(e){return e?.response_type===a.sP.CONNECT_TO_AGENT}function R(e){return e?.response_type===a.sP.CARD}function P(e){return e?.response_type===a.sP.CAROUSEL}function O(e){return e?.response_type===a.sP.BUTTON}function w(e){return O(e)&&e.button_type===a.kw.SHOW_PANEL}function L(e){return O(e)?b(e.panel):R(e)?b(e):P(e)?void 0!==e.items:V(e)}function b(e){return void 0!==e?.body||void 0!==e?.footer}function G(e){switch(e.response_type){case a.sP.TEXT:case a.sP.IMAGE:case a.sP.OPTION:case a.sP.CONNECT_TO_AGENT:case a.sP.IFRAME:case a.sP.VIDEO:case a.sP.AUDIO:case a.sP.DATE:case a.sP.CONVERSATIONAL_SEARCH:case a.sP.TABLE:case a.sP.INLINE_ERROR:case a.sP.CARD:case a.sP.CAROUSEL:case a.sP.BUTTON:case a.sP.GRID:return!1;default:return!H(e)}}function H(e){return U(e)}function U(e){return"IBM_BETA_JOURNEYS_TOUR"===e?.user_defined?.user_defined_type}function k(e){return Boolean(e.public.serviceDeskFactory)}function F(e){switch(e.response_type){case a.sP.IMAGE:case a.sP.IFRAME:case a.sP.VIDEO:case a.sP.AUDIO:case a.sP.TEXT:case a.sP.USER_DEFINED:case a.sP.CARD:case a.sP.GRID:return!0;default:return!1}}function B(e){return P(e)&&1===e.items.length}function V(e){return e?.response_type===a.sP.GRID}function x(e,t){let n="button";return e&&"button"===e?n="button":(e&&"dropdown"===e||t>4)&&(n="dropdown"),n}function W(e){return Boolean(e.partial_item)}function J(e){return Boolean(e.complete_item)}function X(e){return Boolean(e.final_response)}function q(e,t){const n=t?.streaming_metadata?.id;return n?`${e}-${n}`:null}function Y(e){return e.dimensions}function j(e){const t=e.botMessageState.messageIDs||[];return(0,s.U1)(t,e.allMessagesByID,e=>d(e)&&!function(e){return d(e)&&Boolean(e.output.generic?.find(e=>e?.agent_message_type))||h(e)&&Boolean(e.input.agent_message_type)}(e)&&Boolean(e.context))}},9280:function(e,t,n){function r(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(t=>{!Object.prototype.hasOwnProperty.call(e,t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||r(e[t])}),e}n.d(t,{o:function(){return r}})},9499:function(e,t,n){n.d(t,{A:function(){return a}});var r=n(9633),s=n(6753),i=n(577);function a(e,t,n=(0,s.u)(i.y.LOCAL_MESSAGE)){return{item:{response_type:r.sP.TEXT,...e.input},ui_state:{id:n,originalUserText:t,needsAnnouncement:!1},fullMessageID:e.id}}},9763:function(e,t,n){n.d(t,{A9:function(){return v},AF:function(){return A},BC:function(){return y},F:function(){return C},G:function(){return o},HD:function(){return a},HM:function(){return d},HO:function(){return D},KK:function(){return i},KT:function(){return M},Nj:function(){return c},Rf:function(){return f},VD:function(){return S},XF:function(){return u},_0:function(){return l},bf:function(){return s},cg:function(){return N},dB:function(){return r},gW:function(){return E},hB:function(){return T},j1:function(){return p},np:function(){return _},o$:function(){return g},oP:function(){return m},qb:function(){return I},xO:function(){return h}});const r="HA_SET_AGENT_AVAILABILITY",s="HA_SET_IS_CONNECTING",i="HA_SET_IS_RECONNECTING",a="HA_SET_AGENT_JOINED",o="HA_SET_AGENT_LEFT_CHAT",c="HA_END_CHAT",u="HA_UPDATE_CAPABILITIES",d="HA_UPDATE_FILE_UPLOAD_IN_PROGRESS",E="HA_SET_SHOW_SCREEN_SHARE_REQUEST",g="HA_SET_IS_SCREEN_SHARING",h="HA_SET_PERSISTED_STATE",p="HA_UPDATE_IS_SUSPENDED",f="HA_UPDATE_IS_TYPING";function _(e,t){return{type:s,isConnecting:e,localMessageID:t}}function A(e){return{type:i,isReconnecting:e}}function S(){return{type:o}}function l(){return{type:c}}function T(e){return{type:r,availability:e}}function y(e){return{type:a,agentProfile:e}}function I(e){return{type:u,capabilities:e}}function N(e){return{type:d,fileUploadInProgress:e}}function M(e){return{type:E,showRequest:e}}function C(e){return{type:g,isSharing:e}}function D(e){return{type:h,state:e}}function v(e){return{type:p,isSuspended:e}}function m(e){return{type:f,isTyping:e}}}}]);
//# sourceMappingURL=2340.bundle.js.map