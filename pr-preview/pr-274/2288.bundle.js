/*! For license information please see 2288.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_carbon_ai_chat_examples_demo=self.webpackChunk_carbon_ai_chat_examples_demo||[]).push([[2288],{1120:function(e,t,s){s.d(t,{CL:function(){return c},aT:function(){return u},fS:function(){return l}});var n=s(9633),a=s(6753),r=s(7391),o=s(2870),i=s(577);function c(e,t,s=!1,n=!1){const o={ui_state:{id:(0,r.xN)(t.id,e)||(0,a.u)(i.y.LOCAL_MESSAGE),needsAnnouncement:!t.history.from_history,disableFadeAnimation:n},item:e,fullMessageID:t.id};return s&&(o.ui_state.isWelcomeResponse=!0),o}function l(e){return function(e){const t=(0,r.jv)(e);return{originalMessage:t,localMessage:c(e,t)}}({response_type:n.sP.INLINE_ERROR,text:e})}function u(e,t,s,n,a){const{item:o}=e;if((0,r._x)(o))e.ui_state.gridLocalMessageItemIDs=o.rows.map(a=>a.cells.map(a=>{const r=[];return d("items",e,a.items,r,t,s,n,t=>h(e.item,t),!1),r}));else if((0,r.Ex)(o))e.ui_state.itemsLocalMessageItemIDs=[],d("items",e,o.items,e.ui_state.itemsLocalMessageItemIDs,t,s,n,e=>h(o,e),a);else{const i=o.body||o.panel?.body;if(i&&(e.ui_state.bodyLocalMessageItemIDs=[],d("body",e,i,e.ui_state.bodyLocalMessageItemIDs,t,s,n,e=>h(o,e),!(0,r.Cx)(o))),!a)return;const c=o.footer||o.panel?.footer;c&&(e.ui_state.footerLocalMessageItemIDs=[],d("footer",e,c,e.ui_state.footerLocalMessageItemIDs,t,s,n,e=>function(e,t){return!!(0,r.Mm)(t)&&(!(0,r.Cx)(e)||!(0,r.Cx)(t))}(o,e),!(0,r.Cx)(o)))}}function d(e,t,s,n,a,i,l,d,h){s.forEach(s=>{if(d(s)){const e=c(s,a,!1,!0);n.push(e.ui_state.id),l.push(e),(0,r.bY)(e.item)&&u(e,a,i,l,h)}else(0,o.yA)(`The "${t.item.response_type}" response type does not support "${s.response_type}" in "${e}" array.`)})}function h(e,t){switch(e.response_type){case n.sP.CARD:return!(0,r._0)(t)&&(0,r.Wo)(t);case n.sP.CAROUSEL:return(0,r._0)(t);case n.sP.BUTTON:return e.button_type===n.kw.SHOW_PANEL&&(0,r.Wo)(t);case n.sP.GRID:return!(0,r._0)(t)&&(0,r.Wo)(t);default:return!1}}},1424:function(e,t,s){s.d(t,{b:function(){return l}});var n=s(4544),a=s(3696),r=s(5022),o=s(5230),i=s(5688);function c({className:e,children:t,isOpen:s,hidePanelHeader:c,labelBackButton:l,title:u,hideBackButton:d,useAITheme:h,onClickCloseAndRestart:g,onClickRestart:p,testIdPrefix:m,...S},f){const y=(0,r.d4)(e=>e.config.public.headerConfig?.showRestartButton),C=(0,a.useRef)();return(0,a.useImperativeHandle)(f,()=>C.current),a.createElement(n,{active:s,focusTrapOptions:{clickOutsideDeactivates:!0,returnFocusOnDeactivate:!o.yS,preventScroll:!0}},a.createElement("div",{className:e},!c&&a.createElement(i.Y,{...S,ref:C,showRestartButton:y,onClickRestart:p,onCloseAndRestart:g,showBackButton:!d,labelBackButton:l,displayName:u,useAITheme:h,testIdPrefix:m,showCenter:!0}),a.createElement("div",{className:"WACPanelContent"},t)))}const l=a.memo(a.forwardRef(c))},2288:function(e,t,s){s.r(t),s.d(t,{AppContainer:function(){return bs}});var n=s(253),a=s(3696),r=s(5285),o=s(8306),i=s(1122),c=s(8690),l=s(1748),u=s(9049);function d(e){let t=e;return e?.starters?.buttons?.length&&(t={allow_return:!0,...e,starters:{...e.starters,buttons:e.starters.buttons.filter(e=>Boolean(e.label?.trim()))}},t?.starters?.buttons?.length||(t.starters.is_on=!1)),t}var h=s(5888),g=s(2870),p=s(5505),m=s(2685);function S(e,t,s){e.intl=(0,m.E)({locale:t,messages:s}),e.store.dispatch(l.Ay.setAppStateValue("languagePack",s)),e.store.dispatch(l.Ay.setAppStateValue("locale",t))}var f=s(6895);function y(e){const t=new Set,s={get(e,s){return t.has(s)||t.add(s),e[s]}};return new Proxy(e.writeableElements,s)}var C=s(9499),v=s(1120),E=s(8625),A=s(9763);const w="0.4.0";var I;!function(e){e.TEXT_NOTIFICATION="text_notification"}(I||(I={}));const M=[15e3,6e4];var T=s(5822),b=s(9280),_=s(3158),R=s(7019);const P={config:{is_on:!0,mobile:{is_on:!0,title:"",time_to_expand:15e3,new_expand_time:!1,time_to_reduce:1e4,notification_type:I.TEXT_NOTIFICATION},desktop:{is_on:!0,title:"",new_expand_time:!1,time_to_expand:15e3,notification_type:I.TEXT_NOTIFICATION}}};(0,b.o)(P);const D={title:null,hideBackButton:!1,hidePanelHeader:!1,disableAnimation:!1};(0,b.o)(D);const B={isOpen:!1,panelID:T.z0,options:D};(0,b.o)(B);const O={isOpen:!1,messageItem:null};(0,b.o)(O);const N={isOpen:!1,citationItem:null};(0,b.o)(N);const L={activeTourStepItems:null};(0,b.o)(L);const W={isOpen:!1,localMessageItem:null,isMessageForInput:!1};(0,b.o)(W);const H={launcher:!1,mainWindow:!1,tour:!1};(0,b.o)(H);const k={launcher:!0,mainWindow:!1,tour:!1};(0,b.o)(k);const x={mainWindow:!0,launcher:!1,tour:!1};(0,b.o)(x);const F={chatState:{version:w,disclaimersAccepted:{},homeScreenState:{isHomeScreenOpen:!1,showBackToBot:!1},hasSentNonWelcomeMessage:!1,persistedTourState:{activeTourID:null,activeTourCurrentStepIndex:null},agentState:{isConnected:!1,isSuspended:!1,agentProfiles:{}}},launcherState:{wasLoadedFromBrowser:!1,version:w,viewState:H,activeTour:!1,showUnreadIndicator:!1,mobileLauncherIsExtended:!1,mobileLauncherWasReduced:!1,mobileLauncherDisableBounce:!1,desktopLauncherIsExpanded:!1,desktopLauncherWasMinimized:!1,bounceTurn:1,hasSentNonWelcomeMessage:!1}};(0,b.o)(F);const V={localMessageIDs:[],messageIDs:[],isTypingCounter:0,isLoadingCounter:0,isHydratingCounter:0,isScrollAnchored:!1};(0,b.o)(V);const U={allMessageItemsByID:{},allMessagesByID:{},botMessageState:{...V}};(0,b.o)(U);const $={isConnecting:!1,isReconnecting:!1,numUnreadMessages:0,fileUploadInProgress:!1,showScreenShareRequest:!1,isScreenSharing:!1,isAgentTyping:!1,inputState:{fieldVisible:!0,isReadonly:!1,files:[],allowFileUploads:!1,allowMultipleFileUploads:!1,allowedFileUploadTypes:null,stopStreamingButtonState:{currentStreamID:null,isVisible:!1,isDisabled:!1}}};(0,b.o)($);const q={carbonTheme:_.jF.G10,useAITheme:!1,corners:R.L.ROUND};(0,b.o)(q);const Y={showFrame:!0,hasContentMaxWidth:!0};function G(e,t){return{...e,botMessageState:{...e.botMessageState,...t}}}function j(e,t,s){return void 0===s&&(s=e.persistedToBrowserStorage.chatState.homeScreenState.showBackToBot),{...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,homeScreenState:{...e.persistedToBrowserStorage.chatState.homeScreenState,isHomeScreenOpen:t,showBackToBot:s}}}}}function X(e,t,s,n){const a=e.allMessageItemsByID[t];return a?{...e,allMessageItemsByID:{...e.allMessageItemsByID,[t]:{...a,ui_state:{...a.ui_state,[s]:n}}}}:e}function Q(e,t){const s={...e,allMessagesByID:{...e.allMessagesByID,[t.id]:t}};return e.allMessagesByID[t.id]?s:G(s,{messageIDs:[...e.botMessageState.messageIDs,t.id]})}(0,b.o)(Y);var K=s(948),z=s(9080),J=s(6753),Z=s(7391),ee=s(5041),te=s(5235),se=s(4308);const ne=4.5;function ae(e){if(7===e.length){const t=e.substring(1,3),s=e.substring(3,5),n=e.substring(5,7);return[parseInt(t,16),parseInt(s,16),parseInt(n,16)]}if(4===e.length){const t=e.substring(1,2),s=e.substring(2,3),n=e.substring(3,4);return[parseInt(t+t,16),parseInt(s+s,16),parseInt(n+n,16)]}return(0,g.yA)(`Unsupported color code: "${e}"`),[0,0,0]}function re(e,t){const s=ae(e),n=ae(t),a=oe(s),r=oe(n);let o;return o=a>r?(a+.05)/(r+.05):(r+.05)/(a+.05),o}function oe([e,t,s]){const n=e/255,a=t/255,r=s/255;return.2126*(n<=.03928?n/12.92:((n+.055)/1.055)**2.4)+.7152*(a<=.03928?a/12.92:((a+.055)/1.055)**2.4)+.0722*(r<=.03928?r/12.92:((r+.055)/1.055)**2.4)}function ie(e){return re(te.Xx,e)>=ne?te.Xx:te.ON}function ce(e,t){const s=se(e).hsl().object();return se({...s,l:s.l+t}).round().hex().toLowerCase()}var le=s(6543);const ue="--cds-",de=/#([a-f0-9]{3}){1,2}\b/i,he={"$chat-button":"#000000","$chat-button-text-hover":"#525252"},ge={"$chat-button":"#ffffff","$chat-button-text-hover":"#f4f4f4"},pe={white:{blue20:["$highlight"],blue60:["$background-brand","$interactive","$border-interactive","$button-primary","$button-tertiary","$icon-interactive","$focus"],blue60Hover:["$button-primary-hover","$button-tertiary-hover"],blue80:["$button-primary-active","$button-tertiary-active"]},g10:{blue20:["$highlight"],blue60:["$background-brand","$interactive","$border-interactive","$button-primary","$button-tertiary","$icon-interactive","$focus"],blue60Hover:["$button-primary-hover","$button-tertiary-hover"],blue80:["$button-primary-active","$button-tertiary-active"]},g90:{blue20:[],blue60:["$background-brand","$interactive","$border-interactive","$button-primary","$button-tertiary","$focus-inverse"],blue60Hover:["$button-primary-hover","$button-tertiary-hover"],blue80:["$button-primary-active","$highlight","$button-tertiary-active"]},g100:{blue20:[],blue60:["$background-brand","$interactive","$border-interactive","$button-primary","$button-tertiary","$focus-inverse"],blue60Hover:["$button-primary-hover","$button-tertiary-hover"],blue80:["$button-primary-active","$highlight","$button-tertiary-active"]}};function me(e,t,s){t.forEach(t=>{e[t]=s})}function Se(e,t,s,n){s=s||_.jF.G10,e=e||{};const a=function(e,t){let s={};return t||([_.jF.G10,_.jF.WHITE].includes(e)?s={...s,...he}:[_.jF.G90,_.jF.G100].includes(e)&&(s={...s,...ge})),s}(s,n=n||!1),r={...a,...e};Object.entries(r).forEach(([t,s])=>{t.startsWith("$")&&!s.match(de)&&(console.warn(`${T.qI} You tried to call "updateCSSVariables" with an invalid value for "${t}": "${e[t]}". You must use hexadecimal values for colors.`),delete r[t])});const o=function(e,t){const s={},n=e["BASE-primary-color"],a=e["BASE-secondary-color"],r=e["BASE-accent-color"];if(n){s["PRIMARY-color"]=n,s["PRIMARY-color-text"]=ie(n),s["PRIMARY-color-hover"]=ce(n,-8),s["PRIMARY-color-active"]=ce(n,-10);const e=r||te.bm,a=t===_.jF.G90||t===_.jF.G100?te.ON:e;let o;o=re(n,a)>=ne?a:a!==e&&re(n,e)>=ne?e:a!==te.ON&&re(n,te.ON)>=ne?te.ON:te.Xx,o!==a&&(s["PRIMARY-color-focus"]=o)}if(a?(s["SECONDARY-color"]=a,s["SECONDARY-color-text"]=ie(a)):t!==_.jF.G90&&t!==_.jF.G100||(s["SECONDARY-color"]=`var(${ue}layer-02)`,s["SECONDARY-color-text"]=`var(${ue}text-primary);`),r){const e=pe[t],n=ce(r,40),a=ce(r,-8),o=ce(r,-20);me(s,e.blue20,n),me(s,e.blue60,r),me(s,e.blue60Hover,a),me(s,e.blue80,o),s["LAUNCHER-color-background"]=r,s["LAUNCHER-color-background-hover"]=a,s["LAUNCHER-color-background-active"]=o,s["LAUNCHER-EXPANDED-MESSAGE-color-background"]=r,s["LAUNCHER-EXPANDED-MESSAGE-color-hover"]=a,s["LAUNCHER-EXPANDED-MESSAGE-color-active"]=o,s["ACCENT-color"]=r;const i=ae(r);s["ACCENT-color-r"]=i[0].toString(),s["ACCENT-color-g"]=i[1].toString(),s["ACCENT-color-b"]=i[2].toString(),s["ACCENT-color-ghost-text"]=r;const c=ie(r);s["ACCENT-color-text"]=c,s["ACCENT-color-background-hover"]=a,s["ACCENT-color-background-active"]=o,s["LAUNCHER-color-focus-border"]=c,s["LAUNCHER-color-avatar"]=c,s["LAUNCHER-EXPANDED-MESSAGE-color-text"]=c,s["LAUNCHER-EXPANDED-MESSAGE-color-focus-border"]=c,s["LAUNCHER-MOBILE-color-text"]=c,s["ACCENT-color-bw"]=c,s["ACCENT-color-bw-hover"]=ce(c,-8),s["ACCENT-color-bw-active"]=ce(c,-10),s["ACCENT-color-bw-inverse"]=c===te.Xx?te.ON:te.Xx,s["ACCENT-color-bw-gray"]=c===te.Xx?te.Um:te.Tc,s["ACCENT-color-pastel"]=c===te.Xx?ce(r,20):ce(r,-15)}return s}(t||{},s);return Object.entries(o).forEach(([t,s])=>{""!==s&&void 0===e[t]&&(r[t]=s)}),r}function fe(e){let t;switch(e?.carbonTheme){case _.jF.WHITE:t=le.ps.WHITE;break;case _.jF.G10:t=le.ps.G10;break;case _.jF.G90:t=le.ps.G90;break;case _.jF.G100:t=le.ps.G100;break;default:t=le.ps.G10}return e?.useAITheme&&(t+=" WAC--aiTheme"),t}function ye(e,t){const{activeTour:s}=t.persistedToBrowserStorage.launcherState;return!(e.tour&&!s&&((0,g.yA)("Error changing the view. The new view was supposed to show a tour however there is no active tour to show. Changing the view has been canceled."),1))}var Ce=s(9633),ve=s(8795),Ee=s(577);const Ae=new Set(Object.values(ve.k)),we=`[updateCSSVariables] The AI theme is enabled and only ${Object.values(ve.k).join(", ")} can be updated.`;class Ie{constructor(e){this.hydrating=!1,this.restarting=!1,this.alreadyHydrated=!1,this.chunkQueue=[],this.serviceManager=e}async hydrateChat(e,t,s){let n=!1;try{this.hydrationPromise||(this.hydrating=!0,this.hydrationPromise=this.doHydrateChat(e,t,s),n=!0),await this.hydrationPromise}finally{this.hydrating=!1}n&&await this.serviceManager.fire({type:p.xp.CHAT_READY})}async doHydrateChat(e,t,s){let n;(0,g.cY)("Hydrating Carbon AI chat",e,t,s);const{serviceManager:a}=this;a.store.dispatch(l.Ay.addIsHydratingCounter(1)),this.alreadyHydrated||(n=await this.serviceManager.historyService.loadHistory(),a.humanAgentService?((0,g.cY)("Initializing the human agent service"),await a.humanAgentService.initialize()):(0,g.cY)("No service desk integrations present"));const{config:r}=a.store.getState();if(n)a.store.dispatch(l.Ay.hydrateMessageHistory(n.messageHistory)),await this.createElementsForUserDefinedResponses(n.messageHistory),n.latestPanelLocalMessageItem&&this.openResponsePanel(n.latestPanelLocalMessageItem,!0);else if(!e){const e=a.store.getState();e.homeScreenConfig?.is_on?a.store.dispatch(l.Ay.setHomeScreenIsOpen(!0)):r.public.messaging?.skipWelcome||await a.actions.send((0,Z.Sq)(),p.vW.WELCOME_REQUEST,{returnBeforeStreaming:!0},!0)}if(e&&(a.store.dispatch(l.Ay.setHomeScreenIsOpen(!1)),await a.actions.send(e,t,s,!0)),a.store.dispatch(l.Ay.chatWasHydrated()),a.store.dispatch(l.Ay.addIsHydratingCounter(-1)),n){const e=(0,K.ns)(n.messageHistory.botMessageState.localMessageIDs),t=n.messageHistory.allMessageItemsByID[e],s=n.messageHistory.allMessagesByID[t?.fullMessageID];!(0,Z.Dc)(t)&&(0,Z.ks)(s)&&a.messageService.resendMessage(s,t.ui_state.id)}const o=r.public.serviceDesk.allowReconnect??!0;this.serviceManager?.humanAgentService?.handleHydration(o,Boolean(n)),this.alreadyHydrated=!0}getPublicWebChatState(){const e=this.serviceManager.store.getState(),{persistedToBrowserStorage:t}=e,{chatState:s,launcherState:n}=t;return{isConnectedWithHumanAgent:s.agentState.isConnected,isWebChatOpen:n.viewState.mainWindow,isConnectingWithHumanAgent:e.agentState.isConnecting,isHomeScreenOpen:s.homeScreenState.isHomeScreenOpen,isDebugEnabled:(0,g.Tl)(),hasUserSentMessage:s.hasSentNonWelcomeMessage,isTourActive:n.activeTour,viewState:{...n.viewState},serviceDesk:{isConnected:s.agentState.isConnected,isConnecting:e.agentState.isConnecting,isSuspended:s.agentState.isSuspended??!1},locale:this.serviceManager.store.getState().locale,intl:this.serviceManager.intl}}async sendWithCatch(e,t,s={},n=!1){try{await this.send(e,t,s,n)}catch(e){(0,g.yA)("An error occurred sending the message",e)}}async send(e,t,s={},n=!1){const a="string"==typeof e?(0,Z.r2)(e):e;this.serviceManager.store.getState().persistedToBrowserStorage.chatState.homeScreenState.isHomeScreenOpen&&this.serviceManager.store.dispatch(l.Ay.setHomeScreenIsOpen(!1)),this.serviceManager.store.getState().responsePanelState.isOpen&&this.serviceManager.store.dispatch(l.Ay.setResponsePanelIsOpen(!1)),this.hydrationPromise||n?(n||await this.hydrationPromise,await this.doSend(a,t,s)):await this.hydrateChat(a,t,s)}async doSend(e,t,s={}){const{store:n}=this.serviceManager;(0,Z.Wf)(e);const a=e.history?.label||e.input.text;s.silent&&(e.history.silent=!0);const r=(0,C.A)(e,a);e.history.silent?n.dispatch(l.Ay.addMessage(e)):n.dispatch(l.Ay.addLocalMessageItem(r,e,!0)),s.setValueSelectedForMessageID&&n.dispatch(l.Ay.messageSetOptionSelected(s.setValueSelectedForMessageID,e)),(0,b.o)(e),await this.serviceManager.messageService.send((0,c.A)(e),t,r.ui_state.id,s)}async receive(e,t=!1,s,n){const{restartCount:a}=this.serviceManager;e.id||(e.id=(0,J.u)(Ee.y.MESSAGE));const r={type:p.xp.PRE_RECEIVE,data:e};if(await this.serviceManager.fire(r),a!==this.serviceManager.restartCount)return;if(t||this.serviceManager.store.dispatch(l.Ay.updateHasSentNonWelcomeMessage(!0)),a!==this.serviceManager.restartCount)return;const{languagePack:o}=this.serviceManager.store.getState();if((0,Z.Sv)(e))this.processMessageResponse(e,t,s,n).catch(e=>{(0,g.yA)("Error processing the message response",e)});else{const t=(0,Z.Z2)(o.errors_singleMessage,e.thread_id,Ce.sP.INLINE_ERROR);this.receive(t,!1)}(0,b.o)(e),await this.serviceManager.fire({type:p.xp.RECEIVE,data:e})}async removeMessages(e){this.serviceManager.store.dispatch(l.Ay.removeMessages(e))}async insertHistory(e){const t=this.serviceManager.mainWindow?.getMessagesScrollBottom(),s=this.serviceManager.store.getState(),n={notes:[{body:e}]},a=await this.serviceManager.historyService.loadHistory(n),r={allMessageItemsByID:s.allMessageItemsByID,allMessagesByID:s.allMessagesByID,botMessageState:s.botMessageState},o=(0,i.A)({},a.messageHistory,r);o.botMessageState.messageIDs=[...a.messageHistory.botMessageState.messageIDs,...r.botMessageState.messageIDs],o.botMessageState.localMessageIDs=[...a.messageHistory.botMessageState.localMessageIDs,...r.botMessageState.localMessageIDs],this.serviceManager.store.dispatch(l.Ay.hydrateMessageHistory(o)),await this.createElementsForUserDefinedResponses(a.messageHistory),this.serviceManager.mainWindow?.doAutoScroll({scrollToBottom:t})}async receiveChunk(e,t,s={}){const n=(0,ee.H)();return this.chunkQueue.push({chunk:e,messageID:t,options:s,chunkPromise:n}),1===this.chunkQueue.length&&this.processChunkQueue(),n}async processChunkQueue(){const{chunk:e,options:t,chunkPromise:s}=this.chunkQueue[0];let{messageID:n}=this.chunkQueue[0];const a=(0,Z.XV)(e),r=(0,Z.f9)(e),{store:o}=this.serviceManager,i=o.getState().botInputState.stopStreamingButtonState.isVisible;if(r&&e.partial_item.streaming_metadata.cancellable&&!i&&o.dispatch(l.Ay.setStopStreamingButtonVisible(!0)),a||r){n||(n=e.streaming_metadata.response_id),o.getState().allMessagesByID[n]||o.dispatch(l.Ay.streamingStart(n));const s=e.partial_item||e.complete_item;if(o.dispatch(l.Ay.streamingAddChunk(n,s,a,t.disableFadeAnimation??!0)),e.partial_response?.history){if(Object.keys(e.partial_response).length>1)throw new Error('The partial_response object only supports the "history" property.');o.dispatch(l.Ay.streamingMergeHistory(n,e.partial_response?.history))}await this.handleUserDefinedResponseItemsChunk(n,e,s)}else(0,Z.kZ)(e)&&this.receive(e.final_response,t.isLatestWelcomeNode,null,{disableFadeAnimation:!0});(a||(0,Z.kZ)(e))&&i&&(o.dispatch(l.Ay.setStopStreamingButtonDisabled(!1)),o.dispatch(l.Ay.setStopStreamingButtonVisible(!1))),this.chunkQueue.shift(),s.doResolve(),this.chunkQueue[0]&&this.processChunkQueue()}getOrCreateUserDefinedElement(e){let t=this.serviceManager.userDefinedElementRegistry.get(e);return t||(t={element:document.createElement("div"),slotName:`slot-user-defined-${(0,J.u)()}`},t.element.setAttribute("slot",t.slotName),this.serviceManager.userDefinedElementRegistry.set(e,t)),t}async handleUserDefinedResponseItems(e,t){if((0,Z.OL)(e.item)){let s,n;e.item.user_defined?.silent||({element:s,slotName:n}=this.getOrCreateUserDefinedElement(e.ui_state.id));const a={type:p.xp.USER_DEFINED_RESPONSE,data:{message:e.item,fullMessage:t,element:s,slot:n,fullWidth:!1}};await this.serviceManager.fire(a),a.data.fullWidth&&this.serviceManager.store.dispatch(l.Ay.setMessageUIProperty(e.ui_state.id,"fullWidth",!0))}else if((0,Z.bY)(e.item)){const{itemsLocalMessageItemIDs:s,bodyLocalMessageItemIDs:n,footerLocalMessageItemIDs:a,gridLocalMessageItemIDs:r}=e.ui_state,{allMessageItemsByID:o}=this.serviceManager.store.getState(),i=e=>{const s=o[e];return this.handleUserDefinedResponseItems(s,t)};r?.length&&await(0,K.PQ)(r,e=>(0,K.PQ)(e,e=>(0,K.PQ)(e,e=>i(e)))),s?.length&&await(0,K.PQ)(s,i),n?.length&&await(0,K.PQ)(n,i),a?.length&&await(0,K.PQ)(a,i)}}async handleUserDefinedResponseItemsChunk(e,t,s){if((0,Z.OL)(s)){const{store:n}=this.serviceManager,a=(0,Z.xN)(e,s);let r,o;s.user_defined?.silent||({element:r,slotName:o}=this.getOrCreateUserDefinedElement(a));const i={type:p.xp.CHUNK_USER_DEFINED_RESPONSE,data:{messageItem:s,chunk:t,element:r,slot:o,fullWidth:!1}};await this.serviceManager.fire(i),n.getState().allMessageItemsByID[a].ui_state.fullWidth!==i.data.fullWidth&&n.dispatch(l.Ay.setMessageUIProperty(a,"fullWidth",i.data.fullWidth))}}async processMessageResponse(e,t,s,n={}){const{store:a}=this.serviceManager,{config:r}=a.getState(),o=this.serviceManager.restartCount,i=e.output.generic;e.request_id=s?.id,(0,Z.Wf)(e),a.dispatch(l.Ay.addMessage(e));let c=null;for(let s=0;s<i.length&&o===this.serviceManager.restartCount;s++){const u=i[s];if(u){const s=(0,Z.Ll)(u),i=(0,Z.$H)(u),d=(0,Z.Xk)(u),h=(0,v.CL)(u,e,t,n.disableFadeAnimation);if(d&&(n.skipTourCard||u.user_defined?.skip_card)){const e=n.skipTourCard?p.h4.START_TOUR_METHOD:p.h4.SKIP_CARD,{viewState:t}=a.getState().persistedToBrowserStorage.launcherState;if(t.mainWindow){const t=n.skipTourCard?p.MX.CALLED_START_TOUR:p.MX.TOUR_SKIP_CARD;this.startTour(h,e,{mainWindowCloseReason:t}).catch(e=>{(0,g.yA)("Error starting the tour",e)})}else{const t=n.skipTourCard?p.ey.CALLED_START_TOUR:p.ey.TOUR_SKIP_CARD;this.startTour(h,e,{viewChangeReason:t}).catch(e=>{(0,g.yA)("Error starting the tour",e)})}}else!d&&n.skipTourCard&&(0,g.yA)("The message response received was not a tour, so the tour card was not skipped nor was a tour started by the startTour() call.");const m=[];if((0,v.aT)(h,e,!1,m,!0),a.dispatch(l.Ay.addNestedMessages(m)),i&&(0,Z.Sv)(e)){if(a.dispatch(l.Ay.addIsTypingCounter(1)),!(0,Z.Rt)(r)){const e='Web chat received a "connect_to_agent" message but there is no service desk configured. Check your chat configuration.';this.errorOccurred({errorType:_.sO.INTEGRATION_ERROR,message:e}),a.dispatch(l.Ay.setMessageHistoryProperty(h.fullMessageID,"agent_no_service_desk",!0))}const t=await(this.serviceManager.humanAgentService?.checkAreAnyAgentsOnline(e));if(o===this.serviceManager.restartCount){a.dispatch(l.Ay.setMessageHistoryProperty(h.fullMessageID,"agent_availability",t));let s=!1;r.public.serviceDesk?.skipConnectAgentCard&&(s=!0),a.dispatch(l.Ay.addIsTypingCounter(-1)),s&&t===E.Gf.ONLINE&&this.serviceManager.humanAgentService.startChat(h,e)}}if(s){const e=(0,Z.SP)(u);e&&a.dispatch(l.Ay.addIsTypingCounter(1)),await(0,z.y)(u.time),e&&o===this.serviceManager.restartCount&&a.dispatch(l.Ay.addIsTypingCounter(-1))}else await this.handleUserDefinedResponseItems(h,e),h.item.user_defined?.silent||o!==this.serviceManager.restartCount||(this.serviceManager.store.dispatch(l.Ay.addLocalMessageItem(h,e,!1,c)),c=h.ui_state.id)}}}openResponsePanel(e,t){this.serviceManager.store.dispatch(l.Ay.setResponsePanelContent(e,t)),this.serviceManager.store.dispatch(l.Ay.setResponsePanelIsOpen(!0))}async insertLocalMessageResponse(e){e.id=(0,J.u)(Ee.y.MESSAGE),await this.processMessageResponse(e,!1,null,{})}updateLanguagePack(e){const{languagePack:t,locale:s}=this.serviceManager.store.getState(),n={...t,...e};S(this.serviceManager,s,n)}addNotification(e){this.serviceManager.store.dispatch(l.Ay.addNotification(e))}removeNotification(e){this.serviceManager.store.dispatch(l.Ay.removeNotifications({groupID:e}))}removeAllNotifications(){this.serviceManager.store.dispatch(l.Ay.removeAllNotifications())}updateCSSVariables(e,t={}){const{store:s}=this.serviceManager,{theme:n}=s.getState(),{carbonTheme:a,useAITheme:r}=n;if(r){const s=e;e={},t={},s&&Object.entries(s).forEach(([t])=>{Ae.has(t)?e[t]=s[t]:(0,g.OP)(we)})}else e={...e},t={...t};const o=Se(e,t,a,r);s.dispatch(l.Ay.updateCSSVariables(o,e,t))}updateBotName(e){this.serviceManager.store.dispatch(l.Ay.updateBotName(e))}updateMainHeaderTitle(e){this.serviceManager.store.dispatch(l.Ay.updateMainHeaderTitle(e))}updateBotAvatarURL(e){this.serviceManager.store.dispatch(l.Ay.updateBotAvatarURL(e))}updateHomeScreenConfig(e){this.serviceManager.store.dispatch(l.Ay.updateHomeScreenConfig(e))}updateLauncherConfig(e){this.serviceManager.store.dispatch(l.Ay.updateLauncherConfig(e))}async changeView(e,t,s=!0,a=!1){const{store:r}=this.serviceManager,{viewState:o}=r.getState().persistedToBrowserStorage.launcherState;let i=function(e,t){const{viewState:s}=t.persistedToBrowserStorage.launcherState;let n;return n="string"==typeof e?{...H,[e]:!0}:{...s,...e},n}(e,r.getState());return ye(i,r.getState())?((0,n.A)(i,o)&&!a||(await this.fireViewChangeEventsAndChangeView(i,t),i=r.getState().persistedToBrowserStorage.launcherState.viewState,s&&(i.mainWindow||i.tour)&&!r.getState().isHydrated&&this.hydrateChat().catch(e=>{(0,g.yA)("Error hydrating the chat",e)})),i):o}async fireViewChangeEventsAndChangeView(e,t){const{store:s}=this.serviceManager;if(s.getState().viewChanging)throw new Error("The view may not be changed while a view change event is already running. Please make sure to resolve any promises from these events.");s.dispatch(l.Ay.setViewChanging(!0));const{viewState:n}=s.getState().persistedToBrowserStorage.launcherState,{viewChangeReason:a}=t,r=(0,b.o)(n);try{const t={type:p.xp.VIEW_PRE_CHANGE,reason:a,oldViewState:r,newViewState:e,cancelViewChange:!1};if(await this.serviceManager.fire(t),t.cancelViewChange)return void(0,g.cY)("The view changing was cancelled by a view:pre:change event.");if(!ye(t.newViewState,s.getState()))return;e=t.newViewState,s.dispatch(l.Ay.setViewState((0,b.o)(e)));const n={type:p.xp.VIEW_CHANGE,reason:a,oldViewState:r,newViewState:e,cancelViewChange:!1};if(await this.serviceManager.fire(n),n.cancelViewChange)return s.dispatch(l.Ay.setViewState(r)),void(0,g.cY)("The view changing was cancelled by a view:change event.");if(!ye(n.newViewState,s.getState()))return void s.dispatch(l.Ay.setViewState(r));e=n.newViewState,s.dispatch(l.Ay.setViewState((0,b.o)(e)))}finally{s.dispatch(l.Ay.setViewChanging(!1))}}async startTour(e,t,s){this.serviceManager.store.dispatch(l.Ay.setTourData(e.fullMessageID)),(await this.changeView(f.qi.TOUR,s)).tour&&(await this.serviceManager.fire({type:p.xp.TOUR_START,reason:t}),await this.serviceManager.fire({type:p.xp.TOUR_STEP,step:this.serviceManager.store.getState().tourState.activeTourStepItems[0]}))}async endTour(e){const{viewState:t}=this.serviceManager.store.getState().persistedToBrowserStorage.launcherState;let s=t;return t.tour&&(s=await this.changeView(f.qi.LAUNCHER,e)),!s.tour&&(this.serviceManager.store.dispatch(l.Ay.clearTourData()),!0)}goToSpecificTourStep(e){const{activeTourStepItems:t}=this.serviceManager.store.getState().tourState,s=t.findIndex(t=>t.step_id===e);s?this.changeStepInTour({newStepIndex:s}):(0,g.yA)(`No step with the id "${e}" was found within the current tour. As a result, goToTourStep() did not change the current tour step.`)}async changeStepInTour(e){const{store:t}=this.serviceManager,{activeTourStepItems:s}=t.getState().tourState,{activeTourCurrentStepIndex:n}=t.getState().persistedToBrowserStorage.chatState.persistedTourState;let{newStepIndex:a}=e;e.nextStep?a=n+1:e.previousStep&&(a=n-1),t.dispatch(l.Ay.changeStepInTour(a));const r=t.getState().persistedToBrowserStorage.chatState.persistedTourState.activeTourCurrentStepIndex;r===a?await this.serviceManager.fire({type:p.xp.TOUR_STEP,step:s[r]}):(0,g.OP)("The tour tried to change to a step that was out of bounds for the step array, so no step change was made.")}errorOccurred(e){(0,g.yA)("An error has occurred",e),e.catastrophicErrorType&&this.serviceManager.store.dispatch(l.Ay.setAppStateValue("catastrophicErrorType",e.catastrophicErrorType)),(0,g.MO)(this.serviceManager.additionalChatParameters.onError,e)}async restartConversation(e={}){const{skipHydration:t=!1,endAgentConversation:s=!0,fireEvents:n=!0}=e;if((0,g.cY)("Restarting conversation"),this.restarting)(0,g.OP)("You cannot restart a conversation while a previous restart is still pending.");else{this.restarting=!0;try{const{serviceManager:e}=this,{store:a}=e;n&&await e.fire({type:p.xp.PRE_RESTART_CONVERSATION}),e.restartCount++,this.hydrating&&await this.hydrationPromise;const r=a.getState(),{persistedToBrowserStorage:o}=r,{viewState:i}=o.launcherState,{isConnecting:c}=r.agentState,{isConnected:u}=r.persistedToBrowserStorage.chatState.agentState;(u||c)&&s&&await e.humanAgentService.endChat(!0,!1,!1),i.tour&&await this.serviceManager.actions.changeView(f.qi.MAIN_WINDOW,{mainWindowOpenReason:p.eg.CALLED_RESTART_CONVERSATION},!1),this.serviceManager.instance.updateAssistantInputFieldVisibility(!0),this.serviceManager.messageService.cancelAllMessageRequests(),a.dispatch(l.Ay.restartConversation()),t||(this.hydrationPromise=null),n&&await e.fire({type:p.xp.RESTART_CONVERSATION}),this.hydrating&&await this.hydrationPromise,t||e.store.getState().isHydrated?a.dispatch(l.Ay.chatWasHydrated()):(this.hydrationPromise=null,a.getState().persistedToBrowserStorage.launcherState.viewState.mainWindow&&await e.actions.hydrateChat())}finally{this.restarting=!1}}}async destroySession(e){const{store:t}=this.serviceManager,{persistedToBrowserStorage:s}=t.getState(),n=s.launcherState.viewState,a=(0,c.A)(F);e?(a.launcherState.viewState=n,n.tour&&(a.launcherState.viewState={...n,tour:!1,mainWindow:!0})):a.launcherState.viewState=k,this.serviceManager.messageService.cancelAllMessageRequests(),this.serviceManager.userSessionStorageService.clearLauncherSession(),this.serviceManager.userSessionStorageService.clearChatSession(),this.serviceManager.store.dispatch(l.Ay.setAppStateValue("persistedToBrowserStorage",a))}agentEndConversation(e){return this.serviceManager.humanAgentService.endChat(e)}agentUpdateIsSuspended(e){this.serviceManager.store.dispatch((0,A.A9)(e))}async createElementsForUserDefinedResponses(e){await(0,K.PQ)(Object.values(e.allMessageItemsByID),t=>{const s=e.allMessagesByID[t.fullMessageID];return this.handleUserDefinedResponseItems(t,s)})}}const Me="The event handler is not a function.";class Te{constructor(){this.handlersByType=new Map,this.eventsTypesRunning=new Set,this.eventsRunningCount=0}async fire(e,t){be("Before fire",e);const{type:s}=e;if(!s)throw new Error(`Attempted to fire an event with no type! ${JSON.stringify(e)}`);if(this.eventsTypesRunning.has(s))throw new Error(`An event of type ${s} is already running. Please make sure that you have resolved the Promises for any earlier events that were fired.`);try{this.eventsRunningCount++;try{this.eventsTypesRunning.add(s);const n=this.handlersByType.get(s);if(n&&n.length){const a=n.slice();await(0,K.PQ)(a,function(n){const a=n(e,t);return!a||a instanceof Promise||(0,g.OP)(`An event handler for event ${s} returned a non-promise. This might be a mistake.`,a),a})}}finally{this.eventsTypesRunning.delete(s)}}finally{this.eventsRunningCount--,this.waitForEmptyPromise&&0===this.eventsRunningCount&&this.waitForEmptyPromise.doResolve()}be("After fire",e)}fireSync(e,t){be("Before fire",e);const{type:s}=e,n=this.handlersByType.get(s);n&&n.length&&n.slice().forEach(s=>s(e,t)),be("After fire",e)}async waitForEmpty(){0!==this.eventsRunningCount&&(this.waitForEmptyPromise||(this.waitForEmptyPromise=(0,ee.H)()),await this.waitForEmptyPromise,this.waitForEmptyPromise=null)}on(e){return(0,K._j)(e).forEach(({type:e,handler:t})=>{if(!e)throw new Error(`Attempted to listen to an event with no type: "${e}"!`);if("function"==typeof t){this.handlersByType.has(e)||this.handlersByType.set(e,[]);const s=this.handlersByType.get(e);(0,g.d8)(`[EventBus] Adding ${e} event handler`,t),s.push(t)}else(0,g.yA)(Me,t)}),this}off(e){return(0,K._j)(e).forEach(({type:e,handler:t})=>{const s=this.handlersByType.get(e);if(s)if(t){const n=s.indexOf(t);if(-1!==n){const t=s.splice(n,1);(0,g.d8)(`[EventBus] Removing ${e} event handlers`,t)}}else(0,g.d8)(`[EventBus] Removing all ${e} event handlers`),this.handlersByType.set(e,[])}),this}once(e){return(0,K._j)(e).forEach(({type:e,handler:t})=>{if("function"==typeof t){const s=(n,a)=>(this.off({type:e,handler:s}),t(n,a));this.on({type:e,handler:s})}else(0,g.yA)(Me,t)}),this}logListeners(){this.handlersByType.forEach((e,t)=>{console.group(`Event ${t} (${e.length})`),e.forEach(e=>{(0,g.aO)("Listener",e)}),console.groupEnd()})}clear(){return this.handlersByType.clear(),this}}function be(e,t){if((0,g.Tl)()){const s=(0,c.A)(t);(0,g.cY)(`[EventBus] ${e}`,s)}}function _e(e){const t={open(t=D){const{store:s}=e;s.dispatch(l.Ay.setCustomPanelConfigOptions(t)),s.dispatch(l.Ay.setCustomPanelOpen(!0))},close(){e.store.dispatch(l.Ay.setCustomPanelOpen(!1))}};return Object.freeze(t)}var Re=s(3092);class Pe{constructor(e){this.serviceManager=e}async loadHistory(e){const t=this.serviceManager.store.getState(),{config:s,persistedToBrowserStorage:n}=t,a=s.public,{viewState:r}=n.launcherState;try{let t;if(e)t=e;else if(a.messaging?.customLoadHistory){t={notes:[{body:await a.messaging.customLoadHistory(this.serviceManager.instance)}]}}if(t){const e=t?.notes;return async function(e,t){const s={},n={},a={serviceManager:t,allMessages:[],allMessagesByID:n,allLocalMessagesByID:s,threadMessagesByThreadID:{},responsesByRequestID:{},relatedMessageByID:{},localMessagesByOriginalMessageID:{},lastThreadID:null,loadedHistory:{messageHistory:{allMessageItemsByID:s,allMessagesByID:n,botMessageState:null},latestTransferToAgentResponse:null,latestPanelLocalMessageItem:null}};return await async function(e,t){const{allMessages:s,allMessagesByID:n,responsesByRequestID:a,relatedMessageByID:r,serviceManager:o,localMessagesByOriginalMessageID:i}=t;if(!e?.length)return;e.forEach(e=>{e.body.forEach(e=>{const{message:s}=e;(0,Z.U7)(s)||!(0,Z.ks)(s)&&!(0,Z.Sv)(s)||function(e,t,s){e.history=e.history||{},e.history.from_history=!0,e.history.timestamp=new Date(s.time).getTime(),e.thread_id!==Z.R2&&(t.lastThreadID=e.thread_id),t.allMessagesByID[e.id]=e,t.allMessages.push(e)}(s,t,e)})});for(let e=s.length-1;e>=0;e--){const t=s[e];t.history?.file_upload_status===f.aT.UPLOADING&&(t.history.file_upload_status=f.aT.COMPLETE,t.history.error_state=Re.J.FAILED),(0,Z.Sv)(t)&&t.history.silent?(s.splice(e,1),delete n[t.id]):(i[t.id]=[],(0,Z.Sv)(t)&&t.request_id&&(a[t.request_id]=t),t.history.related_message_id&&(r[t.history.related_message_id]=t))}if(!s.length)return;Object.freeze(s);const c={type:p.xp.HISTORY_BEGIN,messages:s};await o.eventBus.fire(c,o.instance),s.forEach(b.o),await o.eventBus.fire({type:p.xp.HISTORY_END,messages:s},o.instance)}(e,a),a.allMessages.length?(function(e){const{allMessages:t,allLocalMessagesByID:s,localMessagesByOriginalMessageID:n}=e;t.forEach(t=>{if((0,Z.ks)(t)){if(!t.history?.silent){const e=t.history?.label||t.input.text,a=(0,C.A)(t,e);n[t.id].push(a),s[a.ui_state.id]=a}}else{const a=function(e){return(0,Z.Sv)(e)?e.output.generic:null}(t);a?.length&&a.forEach(a=>{if(!(0,Z.Ll)(a)){const r=(0,v.CL)(a,t,!1);if(n[t.id].push(r),s[r.ui_state.id]=r,(0,Z.bY)(r.item)){const s=[];(0,v.aT)(r,t,!0,s,!0),s.forEach(t=>{const s=t.ui_state.id;e.loadedHistory.messageHistory.allMessageItemsByID[s]=t})}}})}!function(e,t){const{threadMessagesByThreadID:s}=t;let n=s[Z.R2];n||(n=[],s[Z.R2]=n),n.push(e)}(t,e)})}(a),function(e){const{loadedHistory:t,threadMessagesByThreadID:s,localMessagesByOriginalMessageID:n}=e;t.messageHistory.botMessageState=function(e,t){const s=[],n=[];return e&&e.forEach(e=>{n.push(e.id),t[e.id].forEach(e=>{s.push(e.ui_state.id)})}),{...V,localMessageIDs:s,messageIDs:n}}(s[Z.R2],n)}(a),function(e){const{responsesByRequestID:t,threadMessagesByThreadID:s,localMessagesByOriginalMessageID:n}=e,a=s[Z.R2],r=(0,K.Uk)(a,e=>(0,Z.ks)(e)&&e.history.is_welcome_request);if(r){const e=t[r.id];e&&n[e.id].forEach(e=>{e.ui_state.isWelcomeResponse=!0})}}(a),function({allMessages:e,relatedMessageByID:t,localMessagesByOriginalMessageID:s}){e.forEach(e=>{(0,Z.Sv)(e)&&s[e.id].forEach(s=>{if((0,Z.$Q)(s.item)){const n=t[e.id];(0,Z.ks)(n)&&(s.ui_state.optionSelected=n)}else if((0,Z.Of)(s)){const n=t[e.id];(0,Z.ks)(n)&&(s.ui_state.originalUserText=n.history.label)}})})}(a),a.loadedHistory):null}(e,this.serviceManager)}r.tour&&(await this.serviceManager.actions.changeView(f.qi.MAIN_WINDOW,{mainWindowOpenReason:p.eg.SESSION_HISTORY},!1),this.serviceManager.store.dispatch(l.Ay.clearTourData()))}catch(e){(0,g.yA)("An error occurred while attempting to load the conversation history",e)}return null}}class De{start(e,t,s,n,a){this.hasExceededMaxSilentLoading=!1,this.onEnd=t,this.onSilentLoading=setTimeout(()=>{this.hasExceededMaxSilentLoading=!0,e()},n),this.onMaxAttempt=setTimeout(()=>{s()},a)}end(){this.onMaxAttempt&&clearTimeout(this.onMaxAttempt),this.onSilentLoading&&clearTimeout(this.onSilentLoading),this.onEnd&&this.onEnd(this.hasExceededMaxSilentLoading),this.hasExceededMaxSilentLoading=null,this.onEnd=null}}const Be=[1e3,3e3,5e3];var Oe;!function(e){e[e.SILENT=1]="SILENT",e[e.VISIBLE=2]="VISIBLE"}(Oe||(Oe={}));class Ne{constructor(e,t){this.pendingLocale=!1,this.localeIsExplicit=!1,this.serviceManager=e,this.messageLoadingManager=new De,this.queue={waiting:[],current:null};const s=t.messaging?.messageTimeoutSecs;this.timeoutMS=s?1e3*s:15e4}async processSuccess(e,t){const{requestOptions:s,isProcessed:n}=e,a=Boolean(e.message.history.is_welcome_request);if(n)return;this.setMessageErrorState(e,Re.J.NONE);const{message:r}=e;t&&(r.input.message_type!==Ce.s9.EVENT&&(a||this.messageLoadingManager.end(),t.history=t.history||{},t.history.timestamp=t.history.timestamp||Date.now(),e.trackData.lastRequestTime=Date.now()-e.timeLastRequest,e.trackData.totalRequestTime=Date.now()-e.timeFirstRequest,await this.serviceManager.actions.receive(t,a,r,s)),this.messageLoadingManager.end()),e.isProcessed||(e.sendMessagePromise.doResolve(),e.isProcessed=!0,this.moveToNextQueueItem())}addErrorMessage(){const{store:e}=this.serviceManager,t=e.getState().languagePack.errors_singleMessage,{originalMessage:s,localMessage:n}=(0,v.fS)(t);e.dispatch(l.Ay.addLocalMessageItem(n,s,!0))}async resendMessage(e,t){await this.send((0,c.A)(e),p.vW.HYDRATE_RESEND,t,{skipQueue:!0,silent:!0})}sendToAssistantAndUpdateErrorState(e){e.isProcessed||(this.sendToAssistant(e),(6e3>Date.now()-e.timeFirstRequest?Oe.SILENT:Oe.VISIBLE)===Oe.VISIBLE&&(this.setMessageErrorState(e,Re.J.RETRYING),this.queue.waiting.forEach(e=>{this.setMessageErrorState(e,Re.J.WAITING)})))}async processError(e,t,s){const{message:n,timeFirstRequest:a,timeLastRequest:r,tryCount:o,isProcessed:i,trackData:c,requestOptions:l}=e,u=n.history.is_welcome_request,d=Date.now()-a,h=this.timeoutMS>d&&o<Be.length;if(!i)if(c.lastRequestTime=Date.now()-r,c.totalRequestTime=Date.now()-a,h&&s){c.numErrors++;const t=Be[e.tryCount++];setTimeout(()=>{this.sendToAssistantAndUpdateErrorState(e)},t)}else{let s=!1;u?s=!0:l.silent&&this.addErrorMessage(),this.serviceManager.actions.errorOccurred({errorType:_.sO.MESSAGE_COMMUNICATION,message:"An error occurred sending a message",otherData:t,catastrophicErrorType:s}),this.rejectFinalErrorOnMessage(e,t)}}rejectFinalErrorOnMessage(e,t="An undefined error occurred trying to send your message."){const{sendMessagePromise:s}=e;this.setMessageErrorState(e,Re.J.FAILED);const{message:n}=e;e!==this.queue.current||n.input.message_type===Ce.s9.EVENT||n.history.is_welcome_request||this.messageLoadingManager.end(),s.doReject(new Error(t)),e.isProcessed=!0,e===this.queue.current&&this.moveToNextQueueItem()}async sendToAssistant(e){const{store:t}=this.serviceManager,s=t.getState(),{customSendMessage:n}=s.config.public.messaging;if(e.timeLastRequest=Date.now(),!e.isProcessed)try{const s=(0,c.A)(e.message);e.message=s,t.dispatch(l.Ay.updateMessage(s));const a=new AbortController;e.sendMessageController=a,(0,g.cY)("Called customSendMessage",s),await n(s,{signal:a.signal},this.serviceManager.instance),await this.processSuccess(e,null)}catch(t){(0,g.yA)("An error occurred while sending a message",t);const s=t&&("string"==typeof t?t:JSON.stringify(t))||"There was an unidentified error.";this.processError(e,s,!n)}}async runQueueIfReady(){if(!this.queue.current&&this.queue.waiting.length>0){const{eventBus:e,store:t}=this.serviceManager;this.clearCurrentQueueItem(),this.queue.current=this.queue.waiting.shift();const{current:s}=this.queue,{message:n,source:a}=s,r=t.getState(),{config:o}=t.getState(),{public:i}=o;if(s.timeFirstRequest=Date.now(),n.input.message_type!==Ce.s9.EVENT){if((0,Z.Or)(r)&&(n.thread_id=Z.R2),!n.history.is_welcome_request){const e=i.messaging?.messageLoadingIndicatorTimeoutSecs||0===i.messaging?.messageLoadingIndicatorTimeoutSecs?1e3*i.messaging.messageLoadingIndicatorTimeoutSecs:4e3;this.messageLoadingManager.start(()=>{this.serviceManager.store.dispatch(l.Ay.addIsLoadingCounter(1))},e=>{e&&this.serviceManager.store.dispatch(l.Ay.addIsLoadingCounter(-1))},()=>{this.cancelMessageRequestByID(n.id,!0)},e,this.timeoutMS)}if(s.isProcessed)return;const o=n.history?.label||n.input.text;if(await e.fire({type:p.xp.PRE_SEND,data:n,source:a},this.serviceManager.instance),s.isProcessed)return;const c=(0,C.A)(n,o,s.localMessageID);n.history.silent||(t.dispatch(l.Ay.updateLocalMessageItem(c)),t.dispatch(l.Ay.updateMessage(n))),(0,b.o)(n),await e.fire({type:p.xp.SEND,data:n,source:a},this.serviceManager.instance)}this.sendToAssistant(s)}}addToMessageQueue(e,t,s,n,a={}){const r={localMessageID:s,message:e,sendMessagePromise:n,requestOptions:a||{},timeFirstRequest:0,timeLastRequest:0,trackData:{numErrors:0,lastRequestTime:0,totalRequestTime:0},tryCount:0,isProcessed:!1,source:t};this.queue.waiting.push(r),this.queue.current&&e.history?.error_state===Re.J.RETRYING&&this.setMessageErrorState(r,Re.J.WAITING)}clearCurrentQueueItem(){this.queue.current&&(this.queue.current=null)}moveToNextQueueItem(){this.clearCurrentQueueItem(),this.runQueueIfReady()}setMessageErrorState(e,t){const{message:s}=e,{allMessagesByID:n}=this.serviceManager.store.getState(),a=n[s.id];if(a){const n=a.history?.error_state;if(n!==t&&(t!==Re.J.NONE||n)){let n;t===Re.J.FAILED&&(n="errors_ariaMessageFailed"),n&&this.serviceManager.store.dispatch(l.Ay.announceMessage({messageID:n})),this.serviceManager.store.dispatch(l.Ay.setMessageErrorState(s.id,t));const{allMessagesByID:a}=this.serviceManager.store.getState();e.message=a[s.id]}}}send(e,t,s,n){e.history.timestamp=e.history.timestamp||Date.now(),e.input=e.input||{},e.input.message_type=e.input.message_type||Ce.s9.TEXT;const a=(0,ee.H)();return this.addToMessageQueue(e,t,s,a,n),this.runQueueIfReady(),a}cancelAllMessageRequests(){for(;this.queue.waiting.length;)this.cancelMessageRequestByID(this.queue.waiting[0].message.id,!1);this.queue.current&&(this.cancelMessageRequestByID(this.queue.current.message.id,!1),this.clearCurrentQueueItem())}async cancelMessageRequestByID(e,t){let s;if(this.queue.current?.message.id===e)s=this.queue.current;else{const t=this.queue.waiting.findIndex(t=>t.message.id===e);-1!==t&&(s=this.queue.waiting[t],this.queue.waiting.splice(t,1))}if(s){const{lastResponse:e,sendMessageController:n}=s;n?.abort("Message was cancelled"),this.rejectFinalErrorOnMessage(s,"Message was cancelled"),t&&this.serviceManager.actions.errorOccurred({errorType:_.sO.MESSAGE_COMMUNICATION,message:"Message was cancelled",otherData:await(0,g.I2)(e)})}}}class Le{constructor(e){this.originalName=e,this.attributeSafe=e,this.suffix=function(e){const t=function(e){return e?e.trim():""}(e);return t?.length?`--${e}`:""}(e)}}class We{constructor(){this.userDefinedElementRegistry=new Map,this.restartCount=0}async fire(e){return this.eventBus.fire(e,this.instance)}}var He=s(5230);let ke={};const xe={getItem(e){return ke[e]},setItem(e,t){ke[e]=t},removeItem(e){delete ke[e]},length:Object.keys(ke).length,clear(){ke={}},key(e){return Object.keys(ke)[e]}},Fe=(0,He.w9)()?window.sessionStorage:xe;class Ve{constructor(e){this.serviceManager=e,this.prefix=`CARBON_CHAT_SESSION${this.serviceManager?.namespace?.suffix||""}`}loadChatSession(){try{const e=Fe.getItem(this.getChatSessionKey()),t=e?JSON.parse(e):null;return t?.version===w?t:(this.clearChatSession(),null)}catch(e){return this.clearChatSession(),null}}loadLauncherSession(){try{const e=Fe.getItem(this.getLauncherSessionKey()),t=e?JSON.parse(e):null;return t?.version===w?(t.wasLoadedFromBrowser=!0,t):(this.clearLauncherSession(),null)}catch(e){return this.clearLauncherSession(),null}}persistChatSession(e){try{Fe.setItem(this.getChatSessionKey(),JSON.stringify(e))}catch(e){(0,g.yA)("Error in persistChatSession",e)}}persistLauncherSession(e){try{Fe.setItem(this.getLauncherSessionKey(),JSON.stringify(e))}catch(e){(0,g.yA)("Error in persistLauncherSession",e)}}clearChatSession(){try{Fe.removeItem(this.getChatSessionKey())}catch(e){(0,g.yA)("Error in clearChatSession",e)}}clearLauncherSession(){try{Fe.removeItem(this.getLauncherSessionKey())}catch(e){(0,g.yA)("Error in clearLauncherSession",e)}}getChatSessionKey(){return this.prefix}getLauncherSessionKey(){return this.prefix}}var Ue=s(2446),$e=s(3582);function qe(e,t){if(Array.isArray(t))return t}const Ye={[A.bf]:(e,t)=>{const{isConnecting:s,localMessageID:n}=t;return{...e,agentState:{...e.agentState,isConnecting:s,activeLocalMessageID:n,numUnreadMessages:s?0:e.agentState.numUnreadMessages},persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,agentState:{...e.persistedToBrowserStorage.chatState.agentState,isSuspended:!!s&&e.persistedToBrowserStorage.chatState.agentState.isSuspended}}}}},[A.KK]:(e,t)=>{const{isReconnecting:s}=t;return{...e,agentState:{...e.agentState,isReconnecting:s}}},[A.dB]:(e,t)=>e.agentState.isConnecting?{...e,agentState:{...e.agentState,availability:e.agentState.isConnecting?t.availability:null}}:e,[A.gW]:(e,{showRequest:t})=>({...e,agentState:{...e.agentState,showScreenShareRequest:t}}),[A.HD]:(e,t)=>{const s={...e.persistedToBrowserStorage.chatState.agentState.agentProfiles},{agentProfile:n}=t;return n&&(s[n.id]=n),{...e,agentState:{...e.agentState,isConnecting:!1,isReconnecting:!1,availability:null},persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,agentState:{...e.persistedToBrowserStorage.chatState.agentState,isConnected:!0,agentProfile:n,agentProfiles:s}}}}},[A.xO]:(e,t)=>({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,agentState:{...e.persistedToBrowserStorage.chatState.agentState,serviceDeskState:t.state}}}}),[A.j1]:(e,t)=>e.agentState.isConnecting||e.persistedToBrowserStorage.chatState.agentState.isConnected?{...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,agentState:{...e.persistedToBrowserStorage.chatState.agentState,isSuspended:t.isSuspended}}}}:e,[A.Rf]:(e,t)=>({...e,agentState:{...e.agentState,isAgentTyping:t.isTyping}}),[A.G]:e=>({...e,botMessageState:{...e.botMessageState},agentState:{...e.agentState,isAgentTyping:!1},persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,agentState:{...e.persistedToBrowserStorage.chatState.agentState,agentProfile:null}}}}),[A.XF]:(e,t)=>{const s={...e.agentState.inputState,...t.capabilities};return s.allowFileUploads||(s.files=[]),{...e,agentState:{...e.agentState,inputState:s}}},[A.o$]:(e,{isSharing:t})=>({...e,agentState:{...e.agentState,isScreenSharing:t}}),[A.HM]:(e,t)=>({...e,agentState:{...e.agentState,fileUploadInProgress:t.fileUploadInProgress}}),[A.Nj]:e=>{let t=X(e,e.agentState.activeLocalMessageID,"wasAgentChatEnded",!0);return t={...t,agentState:{...t.agentState,isConnecting:!1,isReconnecting:!1,availability:null,activeLocalMessageID:null,isAgentTyping:!1,inputState:{...t.agentState.inputState,isReadonly:!1}},persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,agentState:{...e.persistedToBrowserStorage.chatState.agentState,isConnected:!1,isSuspended:!1,agentProfile:null}}}},t}};function Ge(e){const{activeTourID:t}=e.persistedToBrowserStorage.chatState.persistedTourState;if(t){const s=e.allMessagesByID[t],n=s?.output?.generic?.find(e=>Boolean(e.user_defined?.steps));if(n)return{...e,tourState:{...e.tourState,activeTourStepItems:n.user_defined?.steps}}}return je(e)}function je(e){return{...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,persistedTourState:{activeTourID:null,activeTourCurrentStepIndex:null}},launcherState:{...e.persistedToBrowserStorage.launcherState,activeTour:!1}},tourState:{...e.tourState,activeTourStepItems:null}}}const Xe=new Set([Ce.Xb.USER_ENDED_CHAT,Ce.Xb.CHAT_WAS_ENDED,Ce.Xb.RELOAD_WARNING]),Qe={[l.Rj]:(e,t)=>(0,i.A)({},e,t.partialState),[l.vI]:e=>({...e,isHydrated:!0}),[l.wq]:e=>{let t={...e,botMessageState:{...e.botMessageState,localMessageIDs:[],messageIDs:[],isTypingCounter:0,isScrollAnchored:!1},allMessageItemsByID:{},allMessagesByID:{},iFramePanelState:{...O},viewSourcePanelState:{...N},customPanelState:{...B},persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,homeScreenState:{...e.persistedToBrowserStorage.chatState.homeScreenState,showBackToBot:!1}}},isHydrated:!1,catastrophicErrorType:null};return t=je(t),t.homeScreenConfig.is_on&&(t=j(t,!0)),t},[l.Pq]:(e,t)=>{let s={...e,...t.messageHistory};return e.persistedToBrowserStorage.chatState.persistedTourState.activeTourID&&(s=Ge(s)),s},[l.GZ]:(e,t)=>{const{messageItem:s,message:n,addMessage:a,addAfterID:r}=t,{id:o}=s.ui_state,i=n.history.silent;let c=e;a&&(c=Q(c,n));const l=c.botMessageState.localMessageIDs.findIndex(e=>e===o),u=[...c.botMessageState.localMessageIDs];let d=l;if(-1!==l?u.splice(l,1):d=u.length,r){const e=u.findIndex(e=>e===r);-1!==e&&(d=e+1)}if(u.splice(d,0,o),!i){c={...c,allMessageItemsByID:{...c.allMessageItemsByID,[o]:s},botMessageState:{...c.botMessageState,localMessageIDs:u}},c.persistedToBrowserStorage.chatState.homeScreenState.isHomeScreenOpen&&(c=j(c,!1));const t=!s.item.agent_message_type,a=e.persistedToBrowserStorage.launcherState.viewState.mainWindow;t||a&&e.isBrowserPageVisible||!(0,Z.ks)(n)&&!Xe.has(s.item.agent_message_type)&&(c={...c,agentState:{...c.agentState,numUnreadMessages:c.agentState.numUnreadMessages+1}})}return c},[l._J]:(e,{messageIDs:t})=>{const s=new Set(t),n={...e.allMessagesByID},a={...e.allMessageItemsByID},r=e.botMessageState.messageIDs.filter(e=>!s.has(e)),o=e.botMessageState.localMessageIDs.filter(e=>{const t=a[e],n=s.has(t?.fullMessageID);return n&&delete a[e],!n});return t.forEach(e=>{delete n[e]}),{...e,allMessagesByID:n,allMessageItemsByID:a,botMessageState:{...e.botMessageState,messageIDs:r,localMessageIDs:o}}},[l.c]:(e,t)=>{const{messageItem:s}=t;return{...e,allMessageItemsByID:{...e.allMessageItemsByID,[s.ui_state.id]:s}}},[l.qu]:(e,t)=>{const{message:s}=t;return{...e,allMessagesByID:{...e.allMessagesByID,[s.id]:s}}},[l.qe]:(e,t)=>{const{message:s}=t,n=s.id;let a=e;if((0,Z.Sv)(s)){const t=[];s.output.generic.forEach(e=>{const s=(0,Z.xN)(n,e);s&&t.push(s)});const r={...e.allMessageItemsByID},o=[];let i;const c=e.botMessageState.localMessageIDs.filter((s,a)=>{const c=e.allMessageItemsByID[s].fullMessageID===n;return c&&(void 0===i&&(i=a),t.includes(s)?o.push(s):delete r[s]),!c});if(o.length){const e=t.filter(e=>o.includes(e));e.length&&c.splice(i,0,...e)}a={...a,allMessageItemsByID:r,botMessageState:{...a.botMessageState,localMessageIDs:c}}}return Q(a,s)},[l.JX]:(e,t)=>{const s={...e.allMessageItemsByID};return s[t.messageID]={...e.allMessageItemsByID[t.messageID],ui_state:{...e.allMessageItemsByID[t.messageID].ui_state,optionSelected:t.sentMessage}},{...e,allMessageItemsByID:s}},[l.YO]:(e,t)=>({...e,botMessageState:{...e.botMessageState,isTypingCounter:Math.max(e.botMessageState.isTypingCounter+t.addToIsTyping,0)}}),[l.FG]:(e,t)=>({...e,botMessageState:{...e.botMessageState,isLoadingCounter:Math.max(e.botMessageState.isLoadingCounter+t.addToIsLoading,0)}}),[l.TD]:(e,t)=>({...e,botMessageState:{...e.botMessageState,isHydratingCounter:Math.max(e.botMessageState.isHydratingCounter+t.addToIsHydrating,0)}}),[l.T0]:(e,t)=>({...e,[t.key]:t.value}),[l.RT]:(e,t)=>({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,...t.chatState}}}),[l.xi]:(e,t)=>e.persistedToBrowserStorage.chatState.hasSentNonWelcomeMessage===t.hasSentNonWelcomeMessage?e:{...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,hasSentNonWelcomeMessage:t.hasSentNonWelcomeMessage},launcherState:{...e.persistedToBrowserStorage.launcherState,hasSentNonWelcomeMessage:t.hasSentNonWelcomeMessage}}},[l.Xi]:(e,t)=>function(e,t){let{agentState:s}=e,{showUnreadIndicator:a}=e.persistedToBrowserStorage.launcherState;return t.mainWindow&&e.isBrowserPageVisible&&(0!==s.numUnreadMessages&&(s={...s,numUnreadMessages:0}),a=!1),{...e,announceMessage:(r=e,o=t,(0,n.A)(r.persistedToBrowserStorage.launcherState.viewState,o)?r.announceMessage:{messageID:o.mainWindow?"window_ariaWindowOpened":"window_ariaWindowClosed"}),agentState:s,persistedToBrowserStorage:{...e.persistedToBrowserStorage,launcherState:{...e.persistedToBrowserStorage.launcherState,viewState:t,showUnreadIndicator:a}}};var r,o}(e,t.viewState),[l.VG]:(e,t)=>({...e,viewChanging:t.viewChanging}),[l.Tp]:(e,t)=>({...e,initialViewChangeComplete:t.changeComplete}),[l.m]:(e,t)=>({...e,botName:t.name,headerDisplayName:e.theme.useAITheme?e.headerDisplayName:t.name}),[l.yM]:(e,t)=>({...e,botAvatarURL:t.url}),[l.By]:(e,t)=>({...e,launcher:{...e.launcher,config:{...e.launcher.config,mobile:{...e.launcher.config.mobile,avatar_url_override:t.source},desktop:{...e.launcher.config.desktop,avatar_url_override:t.source}}}}),[l.NO]:(e,t)=>({...e,headerDisplayName:t.title}),[l._P]:(e,t)=>{const{config:s}=e,{variables:n}=t,a={public:{...s.public}};return{...e,config:a,cssVariableOverrides:n}},[l.Uy]:(e,t)=>{const s=t.homeScreenConfig;return{...e,homeScreenConfig:(0,$e.A)({},e.homeScreenConfig,s,qe)}},[l.ko]:(e,t)=>X(e,t.localMessageID,t.propertyName,t.propertyValue),[l.iA]:(e,t)=>{const{messageID:s,propertyName:n,propertyValue:a}=t,r=e.allMessagesByID[s];return r?{...e,allMessagesByID:{...e.allMessagesByID,[s]:{...r,history:{...r.history,[n]:a}}}}:e},[l.uc]:(e,t)=>{const s=e.allMessagesByID[t.messageID];return s?{...e,allMessagesByID:{...e.allMessagesByID,[t.messageID]:{...s,history:(0,i.A)({},s.history,t.history)}}}:e},[l.ww]:(e,t)=>({...e,announceMessage:t.message}),[l.Mu]:e=>({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,disclaimersAccepted:{...e.persistedToBrowserStorage.chatState.disclaimersAccepted,[window.location.hostname]:!0}}}}),[l.Ew]:(e,{isOpen:t})=>j(e,t),[l.gA]:e=>j(e,!e.persistedToBrowserStorage.chatState.homeScreenState.isHomeScreenOpen,!0),[l.Cw]:(e,t)=>{const s=(0,i.A)({},e.launcher.config,t.launcherConfig);return{...e,launcher:{...e.launcher,config:s},persistedToBrowserStorage:{...e.persistedToBrowserStorage,launcherState:{...e.persistedToBrowserStorage.launcherState,desktopLauncherIsExpanded:!(!s.is_on||!s.desktop.is_on)&&e.persistedToBrowserStorage.launcherState.desktopLauncherIsExpanded,mobileLauncherIsExtended:!(!s.is_on||!s.mobile.is_on)&&e.persistedToBrowserStorage.launcherState.mobileLauncherIsExtended}}}},[l.c7]:(e,t)=>({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,launcherState:{...e.persistedToBrowserStorage.launcherState,[t.propertyName]:t.propertyValue}}}),[l.vp]:(e,t)=>{const s={...e,launcher:{...e.launcher,config:{...e.launcher.config}}};return t.launcherType&&t.launcherType!==f.vX.DESKTOP||(s.launcher.config.desktop={...e.launcher.config.desktop,[t.propertyName]:t.propertyValue}),t.launcherType&&t.launcherType!==f.vX.MOBILE||(s.launcher.config.mobile={...e.launcher.config.mobile,[t.propertyName]:t.propertyValue}),s},[l.hU]:(e,t)=>G(e,{[t.propertyName]:t.propertyValue}),[l.XU]:e=>({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,launcherState:{...e.persistedToBrowserStorage.launcherState,desktopLauncherIsExpanded:!1,desktopLauncherWasMinimized:!0}}}),[l.qO]:(e,{messageItem:t})=>({...e,iFramePanelState:{...e.iFramePanelState,messageItem:t,isOpen:!0},announceMessage:{messageID:"iframe_ariaOpenedPanel"}}),[l.$z]:e=>({...e,iFramePanelState:{...e.iFramePanelState,isOpen:!1},announceMessage:{messageID:"iframe_ariaClosedPanel"}}),[l.ex]:(e,t)=>({...e,viewSourcePanelState:{...e.viewSourcePanelState,citationItem:t.citationItem,relatedSearchResult:t.relatedSearchResult,isOpen:t.isOpen}}),[l.zM]:(e,t)=>({...e,customPanelState:{...e.customPanelState,isOpen:t.isOpen}}),[l.nS]:(e,t)=>({...e,customPanelState:{...e.customPanelState,options:t.options}}),[l.rq]:(e,t)=>Ge({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,persistedTourState:{activeTourID:t.newActiveTourMessageID,activeTourCurrentStepIndex:0}},launcherState:{...e.persistedToBrowserStorage.launcherState,activeTour:!0}}}),[l.sK]:e=>je(e),[l.ds]:(e,t)=>({...e,persistedToBrowserStorage:{...e.persistedToBrowserStorage,chatState:{...e.persistedToBrowserStorage.chatState,persistedTourState:{...e.persistedToBrowserStorage.chatState.persistedTourState,activeTourCurrentStepIndex:Math.max(Math.min(t.newStepNumber,e.tourState.activeTourStepItems.length-1),0)}}}}),[l.P9]:(e,t)=>Ke(e,{...ze(e,t.isInputToAgent),...t.newState},t.isInputToAgent),[l.UC]:(e,t)=>{let s;return s=e.persistedToBrowserStorage.launcherState.viewState.mainWindow&&t.isVisible?0:e.agentState.numUnreadMessages,{...e,isBrowserPageVisible:t.isVisible,agentState:{...e.agentState,numUnreadMessages:s}}},[l.qx]:(e,{file:t,isInputToAgent:s})=>{const n=ze(e,s);return Ke(e,{...n,files:[...n.files,t]},s)},[l.TP]:(e,{fileID:t,isInputToAgent:s})=>{const n=ze(e,s),a=[...n.files],r=a.findIndex(e=>e.id===t);return-1!==r&&a.splice(r,1),Ke(e,{...n,files:a},s)},[l.bH]:(e,{localMessageItemID:t})=>{const s=e.botMessageState.localMessageIDs.filter(e=>e!==t),n={...e.allMessageItemsByID};return n[t]&&delete n[t],{...e,allMessageItemsByID:n,botMessageState:{...e.botMessageState,localMessageIDs:s}}},[l._V]:(e,{notification:t,notificationID:s})=>({...e,notifications:e.notifications.concat({id:s,notification:t})}),[l.AM]:(e,{groupID:t,notificationID:s})=>({...e,notifications:e.notifications.filter(e=>s?e.id!==s:e.notification.groupID!==t)}),[l.IE]:e=>({...e,notifications:[]}),[l.vf]:(e,{isInputToAgent:t})=>Ke(e,{...ze(e,t),files:[]},t),[l.ZB]:(e,{fileID:t,errorMessage:s,isInputToAgent:n})=>{const a=ze(e,n),r=[...a.files],o=r.findIndex(e=>e.id===t);return-1!==o&&(r[o]={...r[o],isError:!0,errorMessage:s,status:f.aT.COMPLETE}),Ke(e,{...a,files:r},n)},[l.dD]:(e,{localMessageItems:t})=>{const s={...e.allMessageItemsByID};return t.forEach(e=>{s[e.ui_state.id]=e}),{...e,allMessageItemsByID:s}},[l.A$]:(e,{isOpen:t})=>({...e,responsePanelState:{...e.responsePanelState,isOpen:t}}),[l.Mp]:(e,{localMessageItem:t,isMessageForInput:s})=>({...e,responsePanelState:{...e.responsePanelState,localMessageItem:t,isMessageForInput:s}}),[l.iS]:(e,{messageID:t})=>Q(e,{id:t,output:{generic:[]},history:{timestamp:Date.now()}}),[l.fO]:(e,{messageID:t,history:s})=>{const n=e.allMessagesByID[t],a=(0,i.A)({},n,{history:s});return n?{...e,allMessagesByID:{...e.allMessagesByID,[t]:a}}:e},[l.HD]:(e,{chunkItem:t,fullMessageID:s,isCompleteItem:n,disableFadeAnimation:a})=>{const r=e.allMessagesByID[s],o=(0,Z.xN)(s,t),i=e.allMessageItemsByID[o];let c,{localMessageIDs:l}=e.botMessageState;if(i)n?(c=(0,v.CL)(t,r,!1),c.ui_state.needsAnnouncement=!1,c.ui_state.disableFadeAnimation=a,c.ui_state.streamingState={chunks:[],isDone:!0}):c={...i,ui_state:{...i?.ui_state,streamingState:{...i?.ui_state.streamingState,chunks:[...i?.ui_state.streamingState?.chunks||[],t]}}};else if(c=(0,v.CL)(t,r,!1),c.ui_state.needsAnnouncement=!1,c.ui_state.disableFadeAnimation=a,c.ui_state.isIntermediateStreaming=!0,c.ui_state.streamingState=n?{chunks:[],isDone:!0}:{chunks:[t],isDone:!1},l=[...l,o],!c.item.response_type)throw new Error(`New chunk item does not have a response_type: ${JSON.stringify(t)}`);return{...e,allMessageItemsByID:{...e.allMessageItemsByID,[o]:c},botMessageState:{...e.botMessageState,localMessageIDs:l}}},[l.CA]:(e,{chatHeaderConfig:t})=>({...e,chatHeaderState:{...e.chatHeaderState,config:{...e.chatHeaderState.config,...t}}}),[l.hp]:(e,{maxTotal:t})=>({...e,chatHeaderState:{...e.chatHeaderState,maxVisibleHeaderObjects:t}}),[l.TV]:(e,{isVisible:t})=>({...e,botInputState:{...e.botInputState,stopStreamingButtonState:{...e.botInputState.stopStreamingButtonState,isVisible:t}}}),[l.rJ]:(e,{isDisabled:t})=>({...e,botInputState:{...e.botInputState,stopStreamingButtonState:{...e.botInputState.stopStreamingButtonState,isDisabled:t}}}),[l.Ky]:(e,{currentStreamID:t})=>({...e,botInputState:{...e.botInputState,stopStreamingButtonState:{...e.botInputState.stopStreamingButtonState,currentStreamID:t}}}),[l.Qz]:(e,{config:t})=>({...e,headerAvatarConfig:t})};function Ke(e,t,s){return s?{...e,agentState:{...e.agentState,inputState:t}}:{...e,botInputState:t}}function ze(e,t){return t?e.agentState.inputState:e.botInputState}Object.assign(Qe,Ye);var Je=s(4774);function Ze(e){return!1===et(e).showFrame||He.a3||e.public.themeConfig?.corners===R.L.SQUARE?R.L.SQUARE:q.corners}function et(e){return e.public.themeConfig?.useAITheme?{showFrame:e.public.layout?.showFrame??!0,hasContentMaxWidth:e.public.layout?.hasContentMaxWidth??!0}:(0,i.A)({},Y,e.public.layout)}function tt(e,t){return t&&Qe[t.type]?Qe[t.type](e,t):e}const st={openChatByDefault:!1,showLauncher:!0,shouldTakeFocusIfOpensAutomatically:!0,serviceDesk:{},messaging:{},themeConfig:{useAITheme:!0}};var nt=s(5088);r.extend(o);class at{constructor(e,t,s){e?.debug&&(0,g.$Z)("Constructed chat widget",e);const n=(0,i.A)({},st,e);this.additionalChatParameters=s||{},this.appConfig={public:n},this.customHostElement=t}async start(){try{return(await this.startInternal()).instance}catch(e){return(0,g.yA)("There was an error starting your chat",e),null}}async startInternal(){const e=(0,Z.Rt)(this.appConfig);this.serviceManager=await async function(e,t){const s=e.public,n=new We;return n.additionalChatParameters=t,n.namespace=new Le(s.namespace),n.userSessionStorageService=new Ve(n),n.actions=new Ie(n),n.eventBus=new Te,n.store=function(e,t){let s;s=void 0!==e.public.themeConfig?.useAITheme?e.public.themeConfig?.useAITheme:q.useAITheme;const n={carbonTheme:e.public.themeConfig?.carbonTheme||q.carbonTheme,useAITheme:s,corners:Ze(e)},a=(0,g.Hg)(n.useAITheme,e),r={...U,notifications:[],botInputState:{fieldVisible:!0,isReadonly:!1,files:[],allowFileUploads:!1,allowMultipleFileUploads:!1,allowedFileUploadTypes:null,stopStreamingButtonState:{currentStreamID:null,isVisible:!1,isDisabled:!1},isReadonly:e.public.isReadonly,fieldVisible:!e.public.isReadonly},agentState:{...$},botName:a,headerDisplayName:null,botAvatarURL:e.public.botAvatarURL||null,headerAvatarConfig:null,chatWidthBreakpoint:null,chatWidth:null,chatHeight:null,cssVariableOverrides:Se({},{},n.carbonTheme,n.useAITheme),isHydrated:!1,languagePack:Je.Ay$,locale:"en",config:e,originalConfig:e,suspendScrollDetection:!1,homeScreenConfig:d({}),persistedToBrowserStorage:{...F,chatState:{...F.chatState,homeScreenState:{...F.chatState.homeScreenState}}},launcher:(0,i.A)({},P,{config:(0,i.A)({},{},{mobile:{}},{is_on:e.public.showLauncher})}),iFramePanelState:O,viewSourcePanelState:N,isDestroyed:!1,customPanelState:B,viewChanging:!1,initialViewChangeComplete:!1,targetViewState:e.public.openChatByDefault?x:k,responsePanelState:W,customMenuOptions:null,tourState:L,isBrowserPageVisible:!0,showNonHeaderBackgroundCover:!1,theme:n,layout:et(e),chatHeaderState:{config:null,maxVisibleHeaderObjects:0}},o=t.userSessionStorageService?.loadLauncherSession();o&&(r.targetViewState=o.viewState,o.viewState=H,r.persistedToBrowserStorage.launcherState=o);const c=e.public.debug?window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__({name:"CarbonAIChat",instanceId:`Chat${t.namespace.suffix}`}):void 0;return(0,Ue.y$)(tt,r,c)}(e,n),n.historyService=new Pe(n),n.messageService=new Ne(n,s),n.store.subscribe(function(e){let t=e.store.getState().persistedToBrowserStorage;return()=>{const{persistedToBrowserStorage:s}=e.store.getState();t!==s&&(t=s,e.userSessionStorageService.persistChatSession(s.chatState),e.userSessionStorageService.persistLauncherSession(s.launcherState))}}(n)),s.disableWindowTitleChanges||n.store.subscribe(function(e){const{store:t}=e;let s,n,a=t.getState();return()=>{const e=t.getState(),{agentState:r}=t.getState(),{numUnreadMessages:o}=r;o!==a.agentState.numUnreadMessages&&(o?(clearTimeout(n),s||(s=window.document.title),window.document.title=e.languagePack.agent_newMessage,n=setTimeout(()=>{window.document.title=`(${o}) ${s}`},1e4)):(clearTimeout(n),s&&(window.document.title=s,s=null))),a=e}}(n)),n.customPanelManager=function(e){const t={[T.z0]:_e(e)};return Object.freeze({getPanel(){return t[T.z0]}})}(n),S(n,n.store.getState().locale,n.store.getState().languagePack),n.writeableElements={[ve.t.AI_TOOLTIP_AFTER_DESCRIPTION_ELEMENT]:document.createElement("div"),[ve.t.WELCOME_NODE_BEFORE_ELEMENT]:document.createElement("div"),[ve.t.HEADER_BOTTOM_ELEMENT]:document.createElement("div"),[ve.t.BEFORE_INPUT_ELEMENT]:document.createElement("div"),[ve.t.HOME_SCREEN_HEADER_BOTTOM_ELEMENT]:document.createElement("div"),[ve.t.HOME_SCREEN_AFTER_STARTERS_ELEMENT]:document.createElement("div"),[ve.t.HOME_SCREEN_BEFORE_INPUT_ELEMENT]:document.createElement("div"),[ve.t.CUSTOM_PANEL_ELEMENT]:document.createElement("div")},s.debug&&(0,g.L6)(!0),s.debugStackTraces&&(0,g.Nb)(!0),n}(this.appConfig,this.additionalChatParameters);const[t,s,a,o]=await Promise.all([(0,h.gu)(this.serviceManager.store.getState().languagePack),(0,h.Xq)(this.serviceManager.store.getState().locale),Promise.resolve(this.additionalChatParameters.render),e?(0,nt.RE)():Promise.resolve(null)]);this.serviceManager.customHostElement=this.customHostElement,o&&(this.serviceManager.humanAgentService=o(this.serviceManager)),S(this.serviceManager,s.name,t),r.locale(s);const m=async()=>{await a({serviceManager:this.serviceManager});const e=this.serviceManager.store.getState(),{wasLoadedFromBrowser:t}=e.persistedToBrowserStorage.launcherState,{targetViewState:s}=e,{openChatByDefault:r}=e.config.public;if(s.mainWindow){let e=p.eg.SESSION_HISTORY;r&&!t&&(e=p.eg.OPEN_BY_DEFAULT),await this.serviceManager.actions.changeView(s,{mainWindowOpenReason:e})}else{const e=p.ey.WEB_CHAT_LOADED,t=s.tour,a=(0,n.A)(s,H);await this.serviceManager.actions.changeView(s,{viewChangeReason:e},t,a)}return this.serviceManager.store.dispatch(l.Ay.setInitialViewChangeComplete(!0)),this.serviceManager.instance};return this.serviceManager.instance=function({serviceManager:e,callRender:t}){let s=!1,n={render:()=>s?((0,g.yA)("The render function has already been called!"),Promise.resolve(n)):(s=!0,t()),on:t=>(e.eventBus.on(t),n),off:t=>(e.eventBus.off(t),n),once:t=>(e.eventBus.once(t),n),updateLanguagePack:t=>((0,g.cY)("Called instance.updateLanguagePack",t),e.actions.updateLanguagePack(t)),updateLocale:t=>{(0,g.cY)("Called instance.updateLocale",t);const s=(0,h.Xq)(t),n=(0,h.gu)(e.store.getState().languagePack);return Promise.all([s,n]).then(([t,s])=>{r.locale(t),S(e,t.name,s),e.messageService.pendingLocale=!0,e.messageService.localeIsExplicit=!0})},updateCSSVariables:(t,s)=>((0,g.cY)("Called instance.updateCSSVariables",t),e.actions.updateCSSVariables(t,s)),send:async(t,s)=>{if((0,g.cY)("Called instance.send",t,s),(0,u.i_)(e.store.getState()).isReadonly)throw new Error("You are unable to send messages in read only mode.");return e.actions.send(t,p.vW.INSTANCE_SEND,s)},doAutoScroll:(t={})=>{(0,g.cY)("Called instance.doAutoScroll",t),e.mainWindow?.doAutoScroll?.(t)},destroy:()=>{(0,g.cY)("Called instance.destroy"),e.store.dispatch(l.Ay.setAppStateValue("isDestroyed",!0)),e.container?.remove(),n=void 0},updateAssistantInputFieldVisibility:t=>{(0,g.cY)("Called instance.updateAssistantInputFieldVisibility",t),e.store.dispatch(l.Ay.updateInputState({fieldVisible:t},!1))},updateInputIsDisabled:t=>{(0,g.cY)("Called instance.updateInputIsDisabled",t),e.store.dispatch(l.Ay.updateInputState({isReadonly:t},!1))},updateBotUnreadIndicatorVisibility:t=>{(0,g.cY)("Called instance.updateBotUnreadIndicatorVisibility",t),e.store.dispatch(l.Ay.setLauncherProperty("showUnreadIndicator",t))},changeView:async t=>{(0,g.cY)("Called instance.changeView",t);let n=!1;s||((0,g.yA)('You tried to call "changeView" without ever having called the "render" method. There is no view to change!'),n=!0);const a=Object.values(f.qi);"string"==typeof t?a.includes(t)||((0,g.yA)(`You tried to change the view but the view you specified is not a valid view name. Please use the valid view names; ${a.join(", ")}.`),n=!0):"object"==typeof t?Object.keys(t).forEach(e=>{a.includes(e)||((0,g.yA)(`You tried to change the state of multiple views by providing an object, however you included the key "${e}" within the object which is not a valid view name. Please use the valid view names; ${a.join(", ")}.`),n=!0)}):((0,g.yA)('You tried to change the view but the view you provided was not a string or an object. You can either change to one of the supported views by providing a string, ex. "launcher", "mainWindow", or "tour". Or you can change the state of multiple views by providing an object, ex. { "launcher": true, "mainWindow": false, "tour": true }. Please use one of these supported options.'),n=!0),n||await e.actions.changeView(t,{viewChangeReason:p.ey.CALLED_CHANGE_VIEW})},notifications:{addNotification:t=>{(0,g.cY)("Called instance.addNotification",t),e.actions.addNotification(t)},removeNotifications:t=>{(0,g.cY)("Called instance.removeNotifications",t),e.actions.removeNotification(t)},removeAllNotifications:()=>{(0,g.cY)("Called instance.removeAllNotifications"),e.actions.removeAllNotifications()}},updateMainHeaderTitle:t=>{(0,g.cY)("Called instance.updateMainHeaderTitle",t),t||(t=null),e.actions.updateMainHeaderTitle(t)},updateHomeScreenConfig:t=>{(0,g.cY)("Called instance.updateHomeScreenConfig",t);const s=(0,c.A)(t);e.store.getState().theme.useAITheme&&t?.background&&((0,g.OP)("The home screen background can not be changed when the AI theme is enabled."),delete s.background),e.actions.updateHomeScreenConfig(d(s))},getState:()=>e.actions.getPublicWebChatState(),writeableElements:y(e),scrollToMessage:(t,s)=>{(0,g.cY)("Called instance.scrollToMessage",t,s),e.mainWindow?.doScrollToMessage(t,s)},updateLauncherConfig:t=>e.actions.updateLauncherConfig(t),customPanels:e.customPanelManager,updateCustomMenuOptions:t=>{(0,g.cY)("Called instance.updateCustomMenuOptions",t),e.store.dispatch(l.Ay.setAppStateValue("customMenuOptions",t))},restartConversation:async()=>((0,g.cY)("Called instance.restartConversation"),e.actions.restartConversation()),agentEndConversation:()=>((0,g.cY)("Called instance.agentEndConversation"),(0,g.OP)("The instance.agentEndConversation method is deprecated. Use instance.serviceDesk.endConversation instead."),e.actions.agentEndConversation(!1)),updateIsTypingCounter(t){(0,g.cY)("Called instance.updateIsTypingCounter",t);const{store:s}=e;if("increase"===t)s.dispatch(l.Ay.addIsTypingCounter(1));else if("decrease"===t){if(s.getState().botMessageState.isTypingCounter<=0)return void(0,g.yA)("You cannot decrease the typing counter when it is already <= 0");s.dispatch(l.Ay.addIsTypingCounter(-1))}else(0,g.yA)(`[updateIsTypingCounter] Invalid direction: ${t}. Valid values are "increase" and "decrease".`)},updateIsLoadingCounter(t){(0,g.cY)("Called instance.updateIsLoadingCounter",t);const{store:s}=e;if("increase"===t)s.dispatch(l.Ay.addIsLoadingCounter(1));else if("decrease"===t){if(s.getState().botMessageState.isLoadingCounter<=0)return void(0,g.yA)("You cannot decrease the loading counter when it is already <= 0");s.dispatch(l.Ay.addIsLoadingCounter(-1))}else(0,g.yA)(`[updateIsLoadingCounter] Invalid direction: ${t}. Valid values are "increase" and "decrease".`)},updateIsChatLoadingCounter(t){(0,g.cY)("Called instance.updateIsChatLoadingCounter",t);const{store:s}=e;if("increase"===t)s.dispatch(l.Ay.addIsHydratingCounter(1));else if("decrease"===t){if(s.getState().botMessageState.isHydratingCounter<=0)return void(0,g.yA)("You cannot decrease the hydrating counter when it is already <= 0");s.dispatch(l.Ay.addIsHydratingCounter(-1))}else(0,g.yA)(`[updateIsChatLoadingCounter] Invalid direction: ${t}. Valid values are "increase" and "decrease".`)},updateHeaderConfig:t=>{const s=(0,c.A)(t);e.store.dispatch(l.Ay.updateChatHeaderConfig(s))},updateMainHeaderAvatar:t=>{e.store.dispatch(l.Ay.updateMainHeaderAvatar(t))},updateBotName:t=>e.actions.updateBotName(t),updateBotAvatarURL:t=>e.actions.updateBotAvatarURL(t),elements:{getMainWindow:function(){return{addClassName:t=>e.mainWindow?.addClassName(t),removeClassName:t=>e.mainWindow?.removeClassName(t)}},getMessageInput:function(){return{getHTMLElement:()=>e.mainWindow?.getMessageInput()?.getHTMLElement(),setValue:t=>e.mainWindow?.getMessageInput()?.setValue(t),setEnableEnterKey:t=>e.mainWindow?.getMessageInput()?.setEnableEnterKey(t),addChangeListener:t=>e.mainWindow?.getMessageInput()?.addChangeListener(t),removeChangeListener:t=>e.mainWindow?.getMessageInput()?.removeChangeListener(t)}},getHomeScreenInput:function(){return{getHTMLElement:()=>e.mainWindow?.getHomeScreenInput()?.getHTMLElement(),setValue:t=>e.mainWindow?.getHomeScreenInput()?.setValue(t),setEnableEnterKey:t=>e.mainWindow?.getHomeScreenInput()?.setEnableEnterKey(t),addChangeListener:t=>e.mainWindow?.getHomeScreenInput()?.addChangeListener(t),removeChangeListener:t=>e.mainWindow?.getHomeScreenInput()?.removeChangeListener(t)}}},tours:{startTour:async t=>{(0,g.cY)("Called instance.tours.startTour",t),await e.actions.send(t,p.vW.START_TOUR_METHOD,{skipTourCard:!0})},endTour:async()=>{(0,g.cY)("Called instance.tours.endTour"),e.actions.endTour({viewChangeReason:p.ey.CALLED_END_TOUR})},goToNextStep:async()=>{(0,g.cY)("Called instance.tours.goToNextStep"),e.actions.changeStepInTour({nextStep:!0})},goToStep:async t=>{(0,g.cY)("Called instance.tours.goToStep",t),e.actions.goToSpecificTourStep(t)}},messaging:{addMessage:(t,s={})=>((0,g.cY)("Called instance.messaging.addMessage",t,s),e.messageService.messageLoadingManager.end(),e.actions.receive(t,s?.isLatestWelcomeNode??!1,null,{disableFadeAnimation:s?.disableFadeAnimation})),addMessageChunk:async(t,s={})=>{(0,g.cY)("Called instance.messaging.addMessageChunk",t,s),e.messageService.messageLoadingManager.end(),await e.actions.receiveChunk(t,null,s)},removeMessages:async t=>((0,g.cY)("Called instance.messaging.removeMessages",t),e.actions.removeMessages(t)),clearConversation:()=>((0,g.cY)("Called instance.messaging.clearConversation"),e.actions.restartConversation({skipHydration:!0,endAgentConversation:!1,fireEvents:!1})),insertHistory:t=>((0,g.cY)("Called instance.messaging.insertHistory",t),e.actions.insertHistory(t))},requestFocus:()=>{(0,g.cY)("Called instance.requestFocus"),e.appWindow?.requestFocus()},serviceDesk:{endConversation:()=>((0,g.cY)("Called instance.serviceDesk.endConversation"),e.actions.agentEndConversation(!1)),updateIsSuspended:async t=>((0,g.cY)("Called instance.serviceDesk.updateIsSuspended",t),e.actions.agentUpdateIsSuspended(t))}};return e.store.getState().config.public.debug&&(0,g.$Z)("[ChatInstanceImpl] Created chat instance",n),n}({serviceManager:this.serviceManager,callRender:()=>{const e=m();return this.serviceManager.renderPromise=e,e}}),{instance:this.serviceManager.instance,serviceManager:this.serviceManager}}}s(1108);var rt=s(4452),ot=s(2986),it=s(8710),ct=s(5022),lt=s(395),ut=s(6683),dt=s(5807);function ht(e){const t=(0,it.A)(),{store:s}=(0,ut.O)(),n=(0,a.useRef)(),r=(0,a.useCallback)(e=>{n.current?n.current.announceValue(e):setTimeout(()=>n.current.announceValue(e))},[]),o=(0,a.useRef)();return(0,a.useEffect)(()=>s.subscribe(()=>{const e=s.getState().announceMessage;e!==o.current&&(r(e),o.current=e)}),[s,r]),a.createElement(lt.s.Provider,{value:r},e.children,a.createElement(dt.o,{intl:t,ref:n}))}var gt=s(6254),pt=s(2895),mt=s(5608),St=s(7161),ft=s(4183),yt=s(7201),Ct=s(393),vt=s(7338);function Et(e,t,s){return s?t?e.launcher_isTourOpen:e.launcher_isTourClosed:t?e.launcher_isOpen:e.launcher_isClosed}var At=s(2566);function wt(e,t){const{onToggleOpen:s,languagePack:n,unreadAgentCount:r,intl:o,showUnreadIndicator:i,className:c,tabIndex:l,launcherHidden:u,activeTour:d}=e,h=(0,ct.d4)(e=>e.theme.useAITheme?void 0:e.launcher.config.desktop.avatar_url_override),g=(0,ct.d4)(e=>e.theme.useAITheme),p=a.createRef();(0,a.useImperativeHandle)(t,()=>({requestFocus:()=>{(0,vt.Ht)(p)}}));let m=Et(n,u,d);0!==r&&(m+=`. ${o.formatMessage({id:"icon_ariaUnreadMessages"},{count:r})}`);let S=g?a.createElement(St.A,{size:24,className:"WACLauncher_svg"}):a.createElement(yt.A,{size:24,className:"WACLauncher__svg"});return h&&(S=a.createElement("img",{className:"WACLauncher__Avatar",src:h,alt:"","aria-hidden":!0})),a.createElement("div",{className:rt("WACLauncher__ButtonContainer","WACLauncher__ButtonContainer--round",c,{"WACLauncher__ButtonContainer--hidden":u})},a.createElement(Ct.$nd,{"aria-label":m,className:rt("WACLauncher__Button",{WACLauncher__TourButton:d}),"data-testid":At.g.LAUNCHER,kind:le.wQ.PRIMARY,type:"button",onClick:s,ref:p,tabIndex:l},d?a.createElement(ft.A,{size:24,className:"WACLauncher__svg"}):S,(0!==r||i)&&a.createElement("div",{className:"WAC__countIndicator"},0!==r?r:"")))}const It=(0,a.forwardRef)(wt);var Mt=s(2794);function Tt(e){const{languagePack:t,intl:s,launcherConfig:n,launcherComplexRef:r,launcherRef:o,onOpen:i,onMinimize:c,unreadAgentCount:l,showUnreadIndicator:u,desktopLauncherIsExpanded:d,launcherHidden:h,activeTour:g,className:p}=e,{launcher_desktopGreeting:m,launcher_closeButton:S,launcher_ariaIsExpanded:f}=t;return a.createElement("div",{className:rt("WACLauncher__ButtonContainer","WACLauncherComplex__Container",p,{"WACLauncher__ButtonContainer--hidden":h}),ref:r},a.createElement("button",{className:"WACLauncherComplex__ContentButton",type:"button",onClick:i,disabled:!d},a.createElement("div",{className:rt("WACWidget__textEllipsis",{WACLauncherComplex__Text:!h})},n.desktop.title?n.desktop.title:m)),a.createElement(It,{languagePack:t,intl:s,ref:o,onToggleOpen:i,className:"WACLauncherComplex__SmallLauncherContainer",unreadAgentCount:l,showUnreadIndicator:u,launcherHidden:h,activeTour:g}),a.createElement(Ct.vwO,{className:"WACLauncher__CloseButton","aria-label":f,onClick:c,disabled:!d},a.createElement("div",{className:"WACLauncher__CloseButtonInnerWrapper"},a.createElement(Mt.A,{className:"WACLauncher__CloseButtonIcon"}),S)))}const bt=e=>{const{launcherRef:t,onDoToggle:s,requestFocus:n,launcherHidden:r,activeTour:o}=e,i=(0,ut.O)(),c=(0,gt.D)(),u=(0,it.A)(),d=(0,ct.d4)(e=>e.persistedToBrowserStorage.launcherState),{desktopLauncherWasMinimized:h,desktopLauncherIsExpanded:g,bounceTurn:p,showUnreadIndicator:m,viewState:S}=d,y=(0,ct.d4)(e=>e.launcher).config,{time_to_expand:C,new_expand_time:v}=y.desktop,E=y.desktop.is_on,A=(0,ct.d4)(e=>e.agentState.numUnreadMessages),[w,I]=(0,a.useState)(""),[T,b]=(0,a.useState)(""),_=(0,a.useRef)(),R=(0,a.useRef)();R.current=r;const P=(0,a.useRef)(!1),D=(0,a.useRef)();D.current=p;const B=(0,a.useRef)(),O=(0,a.useRef)(),N=(0,a.useRef)(),L=(0,a.useRef)(),W=(0,a.useRef)(),H=(0,a.useRef)(),k=(0,a.useCallback)(()=>{const e=`${_.current?.offsetHeight}px`;_.current?.style?.setProperty&&_.current.style.setProperty("--cds-chat-LAUNCHER-desktop-expanded-height",e)},[]),x=(0,a.useCallback)(()=>{R.current||(i.store.dispatch(l.Ay.setLauncherProperty("desktopLauncherIsExpanded",!0)),k(),b("WACLauncherComplex__Container--introAnimation"))},[k,i.store]),F=(0,a.useCallback)(()=>{B.current=setTimeout(()=>{x()},C)},[C,x]),V=(0,a.useCallback)(()=>{clearTimeout(B.current),clearTimeout(O.current)},[]),U=(0,a.useCallback)(()=>{R.current||I("WACLauncher__ButtonContainer--bounceAnimation")},[]),$=(0,a.useCallback)(()=>{R.current||(I("WACLauncher__ButtonContainer--noAnimation"),D.current++,i.store.dispatch(l.Ay.setLauncherProperty("bounceTurn",D.current)))},[i.store]),q=(0,a.useCallback)(()=>{1===D.current?(N.current=setTimeout(()=>{U()},M[0]),L.current=setTimeout(()=>{$()},M[0]+500),W.current=setTimeout(()=>{U()},M[0]+M[1]),H.current=setTimeout(()=>{$()},M[0]+M[1]+500)):2===D.current&&(W.current=setTimeout(()=>{U()},M[1]),H.current=setTimeout(()=>{$()},M[1]+500))},[$,U]),Y=(0,a.useCallback)(()=>{clearTimeout(N.current),clearTimeout(L.current),clearTimeout(W.current),clearTimeout(H.current)},[]),G=(0,a.useCallback)(()=>{V(),i.store.dispatch(l.Ay.setLauncherMinimized()),Y(),i.store.dispatch(l.Ay.setLauncherProperty("bounceTurn",3)),P.current=!1,I("WACLauncher__ButtonContainer--noAnimation")},[Y,V,i.store]);(0,pt.y)(()=>{if(g)P.current=!0;else{if(!h&&E)return F(),()=>{V()};if(h&&3!==p)return q(),()=>{Y()}}}),(0,a.useEffect)(()=>{S.launcher&&P.current&&(k(),b("WACLauncherComplex__Container--simpleAnimation"),P.current=!1)},[k,S.launcher]),(0,a.useEffect)(()=>{(S.mainWindow||S.tour)&&G()},[S,G]),(0,a.useEffect)(()=>{v&&(Y(),V(),F(),i.store.dispatch(l.Ay.setLauncherConfigProperty("new_expand_time",!1,f.vX.DESKTOP)))},[O,B,v,F,V,Y,i.store]);const j=(0,mt.Z)(y.desktop.title);(0,a.useEffect)(()=>{j!==y.desktop.title&&(y.desktop.title||j)&&k()},[k,y,j]);const X=(0,a.useCallback)(()=>{b("WACLauncherComplex__Container--closeAnimation"),setTimeout(()=>{I("WACLauncher__ButtonContainer--noAnimation"),i.store.dispatch(l.Ay.setLauncherMinimized()),setTimeout(n)},400)},[n,i.store]),Q=(0,a.useCallback)(()=>{G(),s()},[s,G]);let K;return K=g?a.createElement(Tt,{languagePack:c,intl:u,launcherComplexRef:_,launcherRef:t,launcherConfig:y,onOpen:Q,onMinimize:X,unreadAgentCount:A,showUnreadIndicator:m,desktopLauncherIsExpanded:g,launcherHidden:r,activeTour:o,className:T}):a.createElement(It,{languagePack:c,intl:u,ref:t,onToggleOpen:Q,unreadAgentCount:A,showUnreadIndicator:m,className:w,launcherHidden:r,activeTour:o}),K};function _t(e,t,s,n){if(e)if(e.classList.add(t),"number"==typeof s)setTimeout(()=>{e.classList.remove(t),n&&n()},s);else{const a=r=>{s&&r.animationName!==s||(e.removeEventListener("animationend",a),e.removeEventListener("animationcancel",a),e.classList.remove(t),n&&n())};e.addEventListener("animationend",a),e.addEventListener("animationcancel",a)}}var Rt=s(9705);function Pt(e,t){const{unreadAgentCount:s,showUnreadIndicator:n,launcherConfig:r,isExtended:o,playExtendAnimation:i,onToggleOpen:c,onSwipeRight:l,onReduceEnd:u,className:d,launcherHidden:h,activeTour:g}=e,p=(0,Rt.q)(),m=(0,gt.D)(),S=(0,it.A)(),f=(0,ct.d4)(e=>e.theme.useAITheme?void 0:e.launcher.config.mobile.avatar_url_override),[y,C]=(0,a.useState)(i),[v,E]=(0,a.useState)(!1),A=(0,mt.Z)(o),w=(0,a.useRef)(),I=(0,a.useRef)(),M=(0,a.useRef)(),T=(0,a.useRef)(),b=(0,a.useRef)({touchStartX:null,touchStartY:null}),_=!o&&A,R=o&&y,P=o&&!y,D=r.mobile.title||m.launcher_mobileGreeting;let B=Et(m,h,g);0!==s&&(B+=`. ${S.formatMessage({id:"icon_ariaUnreadMessages"},{count:s})}`);let O=a.createElement(yt.A,{size:24,className:"WACLauncher__svg"});return f&&(O=a.createElement("img",{className:"WACLauncher__Avatar",src:f,"aria-hidden":!0,alt:""})),(0,a.useImperativeHandle)(t,()=>({requestFocus:()=>{(0,vt.Ht)(w)},launcherContainerElement:()=>I.current})),(0,a.useEffect)(()=>{!function(e,t,s){const n=function(){const e=He.yS?32:64,{width:t,height:s}=window.screen,n=Math.min(s,t)-e;return Math.min(n,400)}()-68+12;e.style.setProperty("width",`${n}px`),t.style.setProperty("width",n-12+"px"),t.style.setProperty("display","flex");const{clientWidth:a}=t.querySelector(".WACLauncherExtended__GreetingText");let r=a+68+1;r>400&&(r=400),t.removeAttribute("style"),e.removeAttribute("style"),s.style.setProperty("--cds-chat--LAUNCHER-EXTENDED-width",`${r}px`)}(T.current,M.current,I.current)},[p,P,D]),(0,a.useEffect)(()=>{if(o){y?Dt({fadeInElement:M.current,fadeInTime:300},()=>{C(!1)}):E(!0);const e=w.current,t=e=>{!function(e,t,s){const{touchStartX:n,touchStartY:a}=t;if(null===n||null===a)return;const{clientX:r,clientY:o}=e,i=r-n,c=o-a;Math.abs(i)>Math.abs(c)&&i>0&&s(),t.touchStartX=null,t.touchStartY=null}(e.touches[0],b.current,l)},s=e=>{const{clientX:s,clientY:n}=e.touches[0],a=b.current;a.touchStartX=s,a.touchStartY=n,w.current.addEventListener("touchmove",t)};return e.addEventListener("touchstart",s),()=>{e.removeEventListener("touchmove",t),e.removeEventListener("touchstart",s)}}if(_){const e=()=>{u(),C(!0),I.current.removeEventListener("animationend",e)};I.current.addEventListener("animationend",e),Dt({fadeOutElement:M.current})}},[y,p,o,D,u,l,_]),a.createElement("div",{className:rt("WACLauncher__ButtonContainer WACLauncher__ButtonContainer--round WACLauncherExtended__Container",d,{"WACLauncher__ButtonContainer--hidden":h,"WACLauncherExtended__Button--extended":P,"WACLauncherExtended__Button--extendedAnimation":R,"WACLauncherExtended__Button--reducedAnimation":_}),ref:I},a.createElement(Ct.$nd,{"aria-label":B,className:rt("WACLauncher__Button","WACLauncherExtended__Button",{WACLauncher__TourButton:g}),kind:g?le.wQ.GHOST:le.wQ.PRIMARY,type:"button",ref:w,onClick:c},a.createElement("div",{className:"WACLauncherExtended__WrapperContainer"},a.createElement("div",{className:"WACLauncherExtended__Wrapper"},a.createElement("div",{className:"WACLauncherExtended__TextHolder",ref:T},a.createElement("div",{className:rt("WACLauncherExtended__Greeting",{"WACLauncherExtended__Element--hidden":!v}),ref:M},a.createElement("div",{className:"WACLauncherExtended__GreetingText","aria-hidden":!o},D))),a.createElement("div",{className:"WACLauncher__IconHolder"},g?a.createElement(ft.A,{size:24,className:"WACLauncher__svg"}):O))),(0!==s||n)&&a.createElement("div",{className:"WAC__countIndicator"},0!==s?s:"")))}function Dt({fadeOutElement:e,fadeInElement:t,fadeInTime:s=600},n){e&&(e.classList.remove("WACLauncherExtended__Element--hidden"),_t(e,"WACLauncherExtended__Element--FadeOut",500,()=>{e.classList.add("WACLauncherExtended__Element--hidden"),e.classList.remove("WACLauncherExtended__Element--FadeOut"),!t&&n&&n()})),t&&setTimeout(()=>{t.classList.remove("WACLauncherExtended__Element--hidden"),_t(t,"WACLauncherExtended__Element--FadeIn",600,()=>{t.classList.remove("WACLauncherExtended__Element--FadeIn"),n&&n()})},s)}const Bt=a.memo((0,a.forwardRef)(Pt));function Ot(e){const{launcherRef:t,onToggleOpen:s,launcherHidden:n,activeTour:r}=e,o=(0,ut.O)(),{config:i}=(0,ct.d4)(e=>e.launcher),c=(0,ct.d4)(e=>e.agentState.numUnreadMessages),{mobileLauncherIsExtended:u,mobileLauncherWasReduced:d,mobileLauncherDisableBounce:h,bounceTurn:g,showUnreadIndicator:p,viewState:m}=(0,ct.d4)(e=>e.persistedToBrowserStorage.launcherState),[S,y]=(0,a.useState)(!1),C=(0,mt.Z)(u),v=(0,mt.Z)(d),E=(0,a.useRef)(g).current,A=(0,a.useRef)(d).current,w=(0,a.useRef)(null),I=(0,a.useRef)(null),T=(0,a.useRef)(null),b=(0,a.useRef)(A&&!h),{time_to_expand:_,new_expand_time:R,time_to_reduce:P}=i.mobile,D=i.mobile.is_on,B=void 0===C&&!u,O=void 0!==C&&!C&&u,N=O||void 0!==v&&!v&&d||S,L=(0,a.useCallback)(()=>{d||o.store.dispatch(l.Ay.setLauncherProperty("mobileLauncherWasReduced",!0))},[d,o]),W=(0,a.useCallback)(()=>{!function(){const e=w.current,t=I.current;t&&(clearTimeout(t),I.current=null),e&&(clearTimeout(e),w.current=null)}(),u&&(document.removeEventListener("scroll",W),o.store.dispatch(l.Ay.setLauncherProperty("mobileLauncherIsExtended",!1)))},[u,o]),H=(0,a.useCallback)(()=>{w.current=setTimeout(()=>{u||O||(o.store.dispatch(l.Ay.setLauncherProperty("mobileLauncherWasReduced",!1)),o.store.dispatch(l.Ay.setLauncherProperty("mobileLauncherIsExtended",!0)))},_)},[u,O,o.store,_]),k=(0,a.useCallback)(()=>{const e=T.current;e&&(e(),T.current=null),o.store.dispatch(l.Ay.setLauncherProperty("mobileLauncherDisableBounce",!0)),W(),L()},[W,o.store,L]);(0,pt.y)(()=>{if(!d&&B&&D)H();else if(b.current){const e=t?.current?.launcherContainerElement();if(e){const t=()=>{if(b.current){let s=E;e.removeEventListener("animationend",t),y(!0),T.current=function(e,t,s,n){const{startingIndex:a,beforeAll:r,afterAll:o,beforeEach:i,afterEach:c}=n;let l=a||0,u=!1,d=null;function h(){r&&0===l&&r();const e=l===s.length;e||u?e&&o&&o():d=setTimeout(p,s[l])}function g(){c&&c(),l++,e.removeEventListener("animationend",g),e.classList.remove(t),h()}function p(){i&&i(),e.addEventListener("animationend",g),e.classList.add(t)}return h(),()=>{u=!0,clearTimeout(d),e.classList.remove(t),e.removeEventListener("animationend",g)}}(e,"WACLauncher__ButtonContainer--bounceAnimation",M,{startingIndex:E-1,afterEach:()=>{s++,o.store.dispatch(l.Ay.setLauncherProperty("bounceTurn",s))},afterAll:()=>{o.store.dispatch(l.Ay.setLauncherProperty("mobileLauncherDisableBounce",!0))}})}};e.addEventListener("animationend",t)}}}),(0,a.useEffect)(()=>{(m.mainWindow||m.tour)&&k()},[m,k]),(0,a.useEffect)(()=>{if(R){b.current&&(b.current=!1);const e=T.current;e&&(e(),T.current=null),w.current&&clearTimeout(w.current),H(),o.store.dispatch(l.Ay.setLauncherConfigProperty("new_expand_time",!1,f.vX.MOBILE))}},[H,R,o.store,b]);const x=(0,a.useCallback)(()=>{k(),s()},[s,k]),F=(0,a.useCallback)(()=>{W()},[W]);return(0,a.useEffect)(()=>{u&&(I.current=setTimeout(()=>{W()},P),document.addEventListener("scroll",W))},[u,W,P,o]),a.createElement(Bt,{className:rt({"WACLauncher__ButtonContainer--noAnimation":N}),ref:t,launcherConfig:i,showUnreadIndicator:p,unreadAgentCount:c,isExtended:u,playExtendAnimation:B,onToggleOpen:x,onSwipeRight:F,onReduceEnd:L,launcherHidden:n,activeTour:r})}function Nt(){const e=(0,ut.O)(),t=(0,a.useRef)(),s=(0,ct.d4)(e=>e.persistedToBrowserStorage.launcherState.viewState),n=(0,ct.d4)(e=>e.initialViewChangeComplete),r=!s.launcher,o=(0,ct.d4)(e=>e.persistedToBrowserStorage.launcherState.activeTour),i=(0,a.useCallback)(()=>{t.current?.requestFocus()},[t]),c=(0,a.useCallback)(()=>o?e.actions.changeView(f.qi.TOUR,{viewChangeReason:p.ey.LAUNCHER_CLICKED}):e.actions.changeView(f.qi.MAIN_WINDOW,{mainWindowOpenReason:p.eg.DEFAULT_LAUNCHER}),[o,e.actions]);let l;return function(e,r){const o=(0,a.useRef)(!1);(0,a.useEffect)(()=>{o.current?s.launcher&&!s.mainWindow&&!s.tour&&n&&t.current?.requestFocus():o.current=!0},r)}(0,[s]),l=He.a3?a.createElement(Ot,{launcherRef:t,onToggleOpen:c,launcherHidden:r,activeTour:o}):a.createElement(bt,{launcherRef:t,onDoToggle:c,requestFocus:i,launcherHidden:r,activeTour:o}),l}var Lt=s(9964),Wt=s(6538),Ht=s(8583),kt=s(4544),xt=s(4630),Ft=s(9186),Vt=s(5884),Ut=s(7429),$t=s(5005),qt=s(4458);function Yt({onClose:e,languagePack:t,isHydrated:s,headerDisplayName:n,useHomeScreenVersion:r}){const o=(0,a.useContext)(xt.l);let i;return i=r?a.createElement(Vt.Z,{onClose:e}):a.createElement(Ft.r,{onClose:e,headerDisplayName:n,onToggleHomeScreen:null,includeWriteableElement:!1,testIdPrefix:qt.G.HYDRATING}),a.createElement("div",{className:"WAC WAC__hydratingContainer"},i,a.createElement("div",{className:rt("WAC__hydrating","WACPanelContent",{"WAC__hydrating--homeScreen":r})},!o&&a.createElement($t.l,{delay:400},!s&&a.createElement(Ut.D,{announceOnce:t.window_ariaWindowLoading}),a.createElement(Ct.Rhj,{withOverlay:!1,"aria-label":t.window_ariaWindowLoading}))))}var Gt=s(4271),jt=s(1424),Xt=s(8205);function Qt(e){const{useAITheme:t,onPanelOpenEnd:s,onPanelCloseEnd:n,onPanelOpenStart:r,onPanelCloseStart:o,onClose:i,onCloseAndRestart:c,onClickRestart:u}=e,d=(0,gt.D)(),{isOpen:h,options:g}=(0,ct.d4)(e=>e.customPanelState),{title:m,hidePanelHeader:S,disableDefaultCloseAction:f,disableAnimation:y,onClickBack:C,onClickClose:v,onClickCloseAndRestart:E}=g,A=(0,ut.O)(),w=(0,Rt.q)(),I=(0,mt.Z)(h),M=y?Gt.K.NONE:Gt.K.SLIDE_IN_FROM_BOTTOM,T=y?Gt.v.NONE:Gt.v.SLIDE_OUT_TO_BOTTOM;(0,a.useEffect)(()=>{I!==h&&h&&!S&&m&&w(m)},[w,S,h,I,m]);const b=(0,a.useCallback)(()=>{A.store.dispatch(l.Ay.setCustomPanelOpen(!1)),C?.()},[A,C]),_=(0,a.useCallback)(()=>{f||(Kt(A.store.getState().viewChanging),i()),v?.()},[f,v,i,A]),R=(0,a.useCallback)(()=>{f||(Kt(A.store.getState().viewChanging),c()),E?.()},[f,E,c,A]);return a.createElement(qt.j,{className:"WAC__overlay--covering",onOpenStart:()=>{A.eventBus.fire({type:p.xp.CUSTOM_PANEL_PRE_OPEN},A.instance),r()},onOpenEnd:()=>{A.eventBus.fire({type:p.xp.CUSTOM_PANEL_OPEN},A.instance),s()},onCloseStart:()=>{A.eventBus.fire({type:p.xp.CUSTOM_PANEL_PRE_CLOSE},A.instance),o()},onCloseEnd:()=>{A.eventBus.fire({type:p.xp.CUSTOM_PANEL_CLOSE},A.instance),n(),A.store.dispatch(l.Ay.setCustomPanelConfigOptions(D))},animationOnOpen:M,animationOnClose:T,shouldOpen:h,serviceManager:A,overlayPanelName:qt.G.CUSTOM},a.createElement(jt.b,{className:"WACCustomPanel",eventName:"Custom panel opened",eventDescription:"A user opened a custom panel.",labelBackButton:d.general_returnToAssistant,isOpen:h,title:m,useAITheme:t,onClickBack:b,onClickClose:_,onClickCloseAndRestart:R,onClickRestart:u,hidePanelHeader:S,hideBackButton:g.hideBackButton,hideCloseButton:g.hideCloseButton,hideCloseAndRestartButton:g.hideCloseAndRestartButton,testIdPrefix:qt.G.CUSTOM},a.createElement(Xt.A,{slotName:"customPanelElement",className:"WACCustomPanel__ContentContainer"})))}function Kt(e){if(e){const e="You are attempting to close Carbon AI chat from a custom panel while Carbon AI chat is currently running a view change event which is not permitted. Please use the disableDefaultCloseAction option to disable this behavior for the custom panel and then use onClickClose to resolve your Promise that is handling the event; that Promise will allow you to close Carbon AI chat.";throw(0,g.yA)(e),new Error(e)}}const zt=a.memo(Qt);var Jt=s(6516),Zt=s(5112),es=s(6718),ts=s(8018);const ss=(0,nt.hY)(),ns=(0,nt.cq)(),as=(0,nt.Mx)(),rs=(0,nt.$O)(),os=(0,nt.j0)(),is=(0,nt.ZF)(),cs=(0,nt.ad)(),ls="WAC--standardWidth",us="WAC--narrowWidth",ds="WAC--wideWidth";class hs extends a.Component{constructor(){super(...arguments),this.state={closing:!1,open:this.props.persistedToBrowserStorage.launcherState.viewState.mainWindow,modalPortalHostElement:null,numPanelsOpen:0,numPanelsAnimating:0,numPanelsCovering:0,isHydrationAnimationComplete:this.props.isHydrated,shouldAutoFocus:this.props.config.public.shouldTakeFocusIfOpensAutomatically,extraClassNames:[],areModulesLoaded:!1},this.mainWindowRef=a.createRef(),this.containerRef=a.createRef(),this.botChatRef=a.createRef(),this.homeScreenInputRef=a.createRef(),this.disclaimerRef=a.createRef(),this.brandingRef=a.createRef(),this.animationContainerRef=a.createRef(),this.iframePanelRef=a.createRef(),this.viewSourcePanelRef=a.createRef(),this.previousBodyVisibility=void 0,this.previousBodyPosition=void 0,this.onResize=()=>{let e;const t=this.containerRef?.current?.offsetHeight,s=this.containerRef?.current?.offsetWidth;e=s>=704?ts.g.WIDE:s>=360?ts.g.STANDARD:ts.g.NARROW,this.props.serviceManager.store.dispatch(l.Ay.setAppStateValue("chatWidth",s)),this.props.serviceManager.store.dispatch(l.Ay.setAppStateValue("chatHeight",t)),this.props.serviceManager.store.dispatch(l.Ay.setAppStateValue("chatWidthBreakpoint",e))},this.onVisualViewportResize=()=>{this.updateFromVisualViewport()},this.updateFromVisualViewport=()=>{const e=this.props.serviceManager.container,{visualViewport:t}=window;if(t)e.style.setProperty("--cds-chat-viewport-height",`${t.height}px`),e.style.setProperty("--cds-chat-viewport-width",`${t.width}px`),e.style.setProperty("--cds-chat-viewport-offsetTop",`${t.offsetTop}px`),e.style.setProperty("--cds-chat-viewport-offsetLeft",`${t.offsetLeft}px`);else{const t="100vh";e.style.setProperty("--cds-chat-viewport-height",t),e.style.setProperty("--cds-chat-viewport-width","100vw"),e.style.setProperty("--cds-chat-viewport-offsetTop","0"),e.style.setProperty("--cds-chat-viewport-offsetLeft","0")}},this.setModalPortalHostElement=e=>{this.state.modalPortalHostElement!==e&&this.setState({modalPortalHostElement:e})},this.onSendInput=async(e,t,s)=>{const n=(0,u.PK)(this.props),{serviceManager:a}=this.props,r=a.store.getState(),{files:o}=(0,u.i_)(r);if(n)a.humanAgentService.sendMessageToAgent(e,o);else{const n=(0,Z.r2)(e);a.actions.sendWithCatch(n,t,{...s})}o.length&&a.store.dispatch(l.Ay.clearInputFiles(n))},this.onSendHomeButtonInput=e=>{const t=(0,Z.Bj)(e);this.props.serviceManager.actions.sendWithCatch(t,p.vW.HOME_SCREEN_STARTER)},this.removeChatFromDom=()=>{this.containerRef.current.removeEventListener("animationend",this.removeChatFromDom),this.setState({open:!1,closing:!1})},this.onRestart=async()=>{await this.props.serviceManager.actions.restartConversation(),this.requestFocus()},this.onClose=async()=>this.doClose(!1),this.onCloseAndRestart=async()=>this.doClose(!0),this.onToggleHomeScreen=()=>{this.props.serviceManager.store.dispatch(l.Ay.toggleHomeScreen())},this.requestFocus=()=>{try{this.state.shouldAutoFocus&&!He.yS&&(this.getShowDisclaimer()?this.disclaimerRef.current&&(0,vt.Ht)(this.disclaimerRef):this.getShowHomeScreen()?this.homeScreenInputRef.current&&this.homeScreenInputRef.current.takeFocus():this.props.iFramePanelState.isOpen?this.iframePanelRef.current&&this.iframePanelRef.current.requestFocus():this.botChatRef.current&&this.botChatRef.current.requestInputFocus())}catch(e){(0,g.yA)("An error occurred in MainWindow.requestFocus",e)}},this.onUserTyping=e=>{this.props.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.isConnected&&this.props.serviceManager.humanAgentService.userTyping(e)},this.onAcceptDisclaimer=()=>{this.props.serviceManager.store.dispatch(l.Ay.acceptDisclaimer())},this.onPanelOpenStart=e=>{this.setState(t=>({numPanelsOpen:t.numPanelsOpen+1,numPanelsAnimating:t.numPanelsAnimating+1,numPanelsCovering:t.numPanelsCovering+(e?1:0)}),this.requestFocus)},this.onPanelOpenEnd=()=>{this.setState(e=>({numPanelsAnimating:e.numPanelsAnimating-1}))},this.onPanelCloseStart=()=>{this.setState(e=>({numPanelsAnimating:e.numPanelsAnimating+1}),this.requestFocus)},this.onPanelCloseEnd=e=>{this.setState(t=>({numPanelsOpen:t.numPanelsOpen-1,numPanelsAnimating:t.numPanelsAnimating-1,numPanelsCovering:t.numPanelsCovering-(e?1:0)}))},this.onHydrationPanelClose=()=>{this.setState({isHydrationAnimationComplete:!0},this.requestFocus)}}componentDidMount(){const{persistedToBrowserStorage:e,config:t,serviceManager:s,mainWindowRef:n}=this.props,{viewState:a}=e.launcherState,{public:r}=t;if(s.mainWindow=this,n.current=this,this.mainWindowObserver=new ResizeObserver(this.onResize),this.mainWindowObserver.observe(this.containerRef.current),He.yS&&!r.disableCustomElementMobileEnhancements){const{visualViewport:e}=window;e&&(e.addEventListener("resize",this.onVisualViewportResize),e.addEventListener("scroll",this.updateFromVisualViewport)),this.updateFromVisualViewport(),this.updateBody(!1)}this.containerRef.current.style.setProperty("--cds-chat-scrollbar-width",`${(0,vt.gU)()}px`),a.mainWindow&&this.loadPanels()}componentWillUnmount(){this.mainWindowObserver.unobserve(this.containerRef.current)}destroy(){if(He.yS&&!this.props.config.public.disableCustomElementMobileEnhancements){const{visualViewport:e}=window;e&&(e.removeEventListener("resize",this.onVisualViewportResize),e.removeEventListener("scroll",this.updateFromVisualViewport))}this.updateBody(!0)}componentDidUpdate(e,t){const s=this.props,n=this.state,{persistedToBrowserStorage:a,useCustomHostElement:r,isDestroyed:o}=s,{viewState:i}=a.launcherState,{open:c}=n,l=e.persistedToBrowserStorage.launcherState.viewState;i.mainWindow!==l.mainWindow&&(this.updateBody(!1),this.updateFromVisualViewport()),o&&!e.isDestroyed&&this.destroy(),(t.areModulesLoaded!==n.areModulesLoaded||e.isHydrated!==s.isHydrated)&&s.isHydrated&&n.areModulesLoaded&&this.setState({isHydrationAnimationComplete:!0},()=>{requestAnimationFrame(()=>{this.requestFocus()})}),!i.mainWindow||l.mainWindow&&c?!i.mainWindow&&l.mainWindow&&t.open&&c&&(this.setState({closing:!0}),r?this.removeChatFromDom():(this.containerRef.current.addEventListener("animationend",this.removeChatFromDom),this.requestFocus())):(this.setState({open:!0},()=>{this.requestFocus()}),this.loadPanels()),s.config.public.shouldTakeFocusIfOpensAutomatically&&(e.persistedToBrowserStorage.chatState.hasSentNonWelcomeMessage||!s.persistedToBrowserStorage.chatState.hasSentNonWelcomeMessage||this.state.shouldAutoFocus?e.botMessageState.localMessageIDs.length>s.botMessageState.localMessageIDs.length&&this.state.shouldAutoFocus?this.setState({shouldAutoFocus:!1}):e.botMessageState.localMessageIDs.length<s.botMessageState.localMessageIDs.length&&!this.state.shouldAutoFocus&&this.setState({shouldAutoFocus:!0}):this.setState({shouldAutoFocus:!0}));const u=(0,K.ns)(s.botMessageState.localMessageIDs);if(u!==(0,K.ns)(e.botMessageState.localMessageIDs)&&n.shouldAutoFocus){const e=s.allMessageItemsByID[u],t=s.allMessagesByID[e?.fullMessageID];t?.history?.from_history||this.requestFocus()}}componentDidCatch(e,t){this.props.serviceManager.actions.errorOccurred((0,g.Jg)("MainWindow",e,t,!0))}loadPanels(){Promise.all([ss.preload(),ns.preload(),as.preload(),rs.preload(),os.preload(),is.preload(),cs.preload()]).then(()=>{this.setState({areModulesLoaded:!0})})}updateBody(e){He.pz&&!this.props.config.public.disableCustomElementMobileEnhancements&&((window.screen.width<=500||window.screen.height<=500)&&this.props.persistedToBrowserStorage.launcherState.viewState.mainWindow&&!e?(this.previousBodyVisibility=document.body.style.getPropertyValue("visibility"),this.previousBodyPosition=document.body.style.getPropertyValue("position"),document.body.style.setProperty("visibility","hidden","important"),document.body.style.setProperty("position","fixed","important")):(document.body.style.setProperty("visibility",this.previousBodyVisibility),document.body.style.setProperty("position",this.previousBodyPosition)))}async doClose(e){const{serviceManager:t}=this.props,{activeTour:s}=t.store.getState().persistedToBrowserStorage.launcherState;e?(await t.actions.changeView(f.qi.LAUNCHER,{mainWindowCloseReason:p.MX.MAIN_WINDOW_CLOSED_AND_RESTARTED})).mainWindow||await t.actions.restartConversation():await t.actions.changeView(s?f.qi.TOUR:f.qi.LAUNCHER,{mainWindowCloseReason:p.MX.DEFAULT_MINIMIZE})}getShowHomeScreen(){return this.props.homeScreenConfig.is_on&&this.props.persistedToBrowserStorage.chatState.homeScreenState.isHomeScreenOpen&&!this.getShowDisclaimer()}getShowDisclaimer(){return this.props.config.public.disclaimer?.is_on&&!this.props.persistedToBrowserStorage.chatState.disclaimersAccepted[window.location.hostname]}doAutoScroll(e){this.botChatRef?.current?.doAutoScroll(e)}getMessagesScrollBottom(){return this.botChatRef?.current?.getMessagesScrollBottom()}doScrollToMessage(e,t=!0){this.botChatRef.current?.doScrollToMessage(e,t)}getMessageInput(){return this.botChatRef.current?.getMessageInput()}getHomeScreenInput(){return this.homeScreenInputRef.current?.getMessageInput()}addClassName(e){this.setState(function(e){return t=>-1===t.extraClassNames.indexOf(e)?{extraClassNames:[...t.extraClassNames,e]}:null}(e))}removeClassName(e){this.setState(function(e){return t=>({extraClassNames:t.extraClassNames.filter(t=>t!==e)})}(e))}renderChat(){const{isHydrated:e,config:t,chatWidthBreakpoint:s}=this.props,{areModulesLoaded:n}=this.state,r=this.state.numPanelsCovering>0&&t.public.layout?.hasContentMaxWidth&&s===ts.g.WIDE;return a.createElement("div",{className:"WACWidget--content"},this.renderCustomPanel(),this.renderHydrationPanel(),e&&n&&a.createElement(a.Fragment,null,this.renderDisclaimerPanel(),this.renderResponsePanel(),this.renderHomeScreenPanel(),this.renderIFramePanel(),this.renderViewSourcePanel(),r&&a.createElement("div",{className:"WACBackgroundCover"}),this.renderBotChat()))}renderBotChat(){const{botName:e,languagePack:t,config:s,serviceManager:n,botMessageState:r,agentState:o,allMessageItemsByID:i,isHydrated:c,locale:l,theme:d,headerDisplayName:h,headerAvatarConfig:g}=this.props,{numPanelsAnimating:m,numPanelsOpen:S,isHydrationAnimationComplete:f}=this.state,y=(0,u.i_)(this.props),C=(0,u.R0)(this.props),v=this.getShowDisclaimer();let E;return f?m>0?E=!1:S>0&&(E=!0):E=!0,a.createElement(Jt.G,{className:"WACBotContainer",hidden:E},a.createElement(a.Suspense,{fallback:null},a.createElement(ss,{botName:e,headerDisplayName:h,headerAvatarConfig:g,ref:this.botChatRef,languagePack:t,config:s,serviceManager:n,onClose:this.onClose,onCloseAndRestart:this.onCloseAndRestart,messageState:r,onSendInput:e=>this.onSendInput(e,p.vW.MESSAGE_INPUT),agentState:o,agentDisplayState:C,allMessageItemsByID:i,onRestart:this.onRestart,isHydrated:c,isHydrationAnimationComplete:f&&!v,inputState:y,onToggleHomeScreen:this.onToggleHomeScreen,onUserTyping:this.onUserTyping,locale:l,useAITheme:d.useAITheme,carbonTheme:d.carbonTheme})))}renderInnerHydrationPanel(){const{botMessageState:e,serviceManager:t,languagePack:s,headerDisplayName:n,persistedToBrowserStorage:r,homeScreenConfig:o}=this.props,{areModulesLoaded:i}=this.state,c=o.is_on&&!r.launcherState.hasSentNonWelcomeMessage;return a.createElement(Yt,{headerDisplayName:n,isHydrated:0===e.isHydratingCounter&&i,serviceManager:t,onClose:this.onClose,languagePack:s,useHomeScreenVersion:c})}renderHydrationPanel(){const{botMessageState:e,serviceManager:t,catastrophicErrorType:s,persistedToBrowserStorage:n}=this.props,{viewState:r}=n.launcherState,{areModulesLoaded:o}=this.state;return a.createElement(qt.j,{onOpenStart:()=>this.onPanelOpenStart(!1),onCloseStart:this.onPanelCloseStart,onOpenEnd:this.onPanelOpenEnd,onCloseEnd:()=>{this.onHydrationPanelClose(),this.onPanelCloseEnd(!1)},animationOnOpen:Gt.K.NONE,animationOnClose:Gt.v.NONE,shouldOpen:(e.isHydratingCounter>0||!o)&&!s&&r.mainWindow,shouldHide:!1,serviceManager:t,overlayPanelName:qt.G.HYDRATING},this.renderInnerHydrationPanel())}renderCatastrophicPanel(){const{serviceManager:e,botName:t,languagePack:s,headerDisplayName:n}=this.props;return a.createElement(qt.j,{animationOnOpen:Gt.K.NONE,animationOnClose:Gt.v.NONE,shouldOpen:!0,serviceManager:e,overlayPanelName:qt.G.CATASTROPHIC},a.createElement(a.Suspense,{fallback:null},a.createElement(ns,{onClose:this.onClose,headerDisplayName:n,languagePack:s,onRestart:this.onRestart,showHeader:!0,botName:t})))}renderDisclaimerPanel(){const{serviceManager:e,config:t}=this.props,s=this.getShowDisclaimer();return t.public.disclaimer?.is_on?a.createElement(qt.j,{onOpenStart:()=>this.onPanelOpenStart(!1),onCloseStart:this.onPanelCloseStart,onOpenEnd:this.onPanelOpenEnd,onCloseEnd:()=>this.onPanelCloseEnd(!1),animationOnOpen:Gt.K.FADE_IN,animationOnClose:Gt.v.FADE_OUT,shouldOpen:s,serviceManager:e,overlayPanelName:qt.G.DISCLAIMER},a.createElement(a.Suspense,{fallback:null},a.createElement(as,{onAcceptDisclaimer:this.onAcceptDisclaimer,onClose:this.onClose,disclaimerHTML:t.public.disclaimer?.disclaimerHTML,disclaimerAcceptButtonRef:this.disclaimerRef}))):null}renderHomeScreenPanel(){const{isHydrationAnimationComplete:e}=this.state,t=this.getShowHomeScreen();return a.createElement(a.Suspense,{fallback:null},a.createElement(rs,{onPanelOpenStart:()=>this.onPanelOpenStart(!1),onPanelOpenEnd:this.onPanelOpenEnd,onPanelCloseStart:this.onPanelCloseStart,onPanelCloseEnd:()=>this.onPanelCloseEnd(!1),onClose:this.onClose,onCloseAndRestart:this.onCloseAndRestart,onSendBotInput:e=>this.onSendInput(e,p.vW.HOME_SCREEN_INPUT),onSendButtonInput:this.onSendHomeButtonInput,onRestart:this.onRestart,showHomeScreen:t,isHydrationAnimationComplete:e,homeScreenInputRef:this.homeScreenInputRef,onToggleHomeScreen:this.onToggleHomeScreen,requestFocus:this.requestFocus}))}renderIFramePanel(){const{serviceManager:e,iFramePanelState:t}=this.props;return a.createElement(qt.j,{className:"WAC__overlay--covering",onOpenStart:()=>this.onPanelOpenStart(!0),onCloseStart:this.onPanelCloseStart,onOpenEnd:this.onPanelOpenEnd,onCloseEnd:()=>this.onPanelCloseEnd(!0),animationOnOpen:Gt.K.SLIDE_IN_FROM_BOTTOM,animationOnClose:Gt.v.SLIDE_OUT_TO_BOTTOM,shouldOpen:t.isOpen,serviceManager:e,overlayPanelName:qt.G.IFRAME},a.createElement(a.Suspense,{fallback:null},a.createElement(os,{useAITheme:this.props.theme.useAITheme,ref:this.iframePanelRef,onClickClose:this.onClose,onClickRestart:this.onRestart,onClickCloseAndRestart:this.onCloseAndRestart})))}renderViewSourcePanel(){const{serviceManager:e,viewSourcePanelState:t}=this.props;return a.createElement(qt.j,{className:"WAC__overlay--covering",onOpenStart:()=>this.onPanelOpenStart(!0),onCloseStart:this.onPanelCloseStart,onOpenEnd:this.onPanelOpenEnd,onCloseEnd:()=>this.onPanelCloseEnd(!0),animationOnOpen:Gt.K.SLIDE_IN_FROM_BOTTOM,animationOnClose:Gt.v.SLIDE_OUT_TO_BOTTOM,shouldOpen:t.isOpen,serviceManager:e,overlayPanelName:qt.G.CONVERSATIONAL_SEARCH_CITATION},a.createElement(a.Suspense,{fallback:null},a.createElement(is,{ref:this.viewSourcePanelRef,onClickClose:this.onClose,onClickRestart:this.onRestart,onClickCloseAndRestart:this.onCloseAndRestart})))}renderCustomPanel(){return a.createElement(zt,{useAITheme:this.props.theme.useAITheme,onClose:this.onClose,onClickRestart:this.onRestart,onCloseAndRestart:this.onCloseAndRestart,onPanelOpenStart:()=>this.onPanelOpenStart(!0),onPanelOpenEnd:this.onPanelOpenEnd,onPanelCloseStart:this.onPanelCloseStart,onPanelCloseEnd:()=>this.onPanelCloseEnd(!0)})}renderResponsePanel(){if(!this.props.responsePanelState.localMessageItem)return null;const{isOpen:e,localMessageItem:t,isMessageForInput:s}=this.props.responsePanelState,n=(t?.item).panel,r=qt.G.PANEL_RESPONSE;return a.createElement(a.Suspense,{fallback:null},a.createElement(cs,{eventName:'"Show panel" opened',eventDescription:"Panel opened through panel response type",overlayPanelName:r,testIdPrefix:r,isOpen:e,isMessageForInput:s,localMessageItem:t,title:n?.title,showAnimations:n?.show_animations,useAITheme:this.props.theme.useAITheme,requestFocus:this.requestFocus,onClose:this.onClose,onClickRestart:this.onRestart,onCloseAndRestart:this.onCloseAndRestart,onClickBack:()=>this.props.serviceManager.store.dispatch(l.Ay.setResponsePanelIsOpen(!1)),onPanelOpenStart:()=>this.onPanelOpenStart(!0),onPanelOpenEnd:this.onPanelOpenEnd,onPanelCloseStart:this.onPanelCloseStart,onPanelCloseEnd:()=>{this.onPanelCloseEnd(!0),this.props.serviceManager.store.dispatch(l.Ay.setResponsePanelContent(null,!1))}}))}renderWidget(){const{serviceManager:e,useCustomHostElement:t,locale:s,catastrophicErrorType:n,config:r,isHydrated:o,theme:i,chatWidthBreakpoint:c,layout:l,languagePack:u}=this.props,{closing:d,open:h,extraClassNames:g}=this.state,p=`WACLocale-${s||"en"}`,m=r.public.enableFocusTrap&&h&&!r.public.hideCloseButton&&!r.public.headerConfig.hideMinimizeButton,S=Boolean(m&&o),f=c===ts.g.WIDE;return a.createElement(kt,{active:S},a.createElement("div",{className:rt("WACMainWindow","WACWidget__FocusTrapContainer",...g),ref:this.mainWindowRef},m&&a.createElement("div",{className:"WACWidget__FocusTrapGlass"}),a.createElement("div",{id:`WACWidget${e.namespace.suffix}`,className:rt(`WACWidget ${p}`,{"WACWidget--rounded":i.corners===R.L.ROUND,"WACWidget--defaultElement":!t,"WACWidget--launched":!d,"WACWidget--closing":d,"WACWidget--closed":!h,"WACWidget--maxWidth":f&&l.hasContentMaxWidth,[us]:c===ts.g.NARROW,[ls]:c===ts.g.STANDARD,[ds]:f}),ref:this.containerRef},a.createElement(Zt.A,null,a.createElement("h1",null,u.window_title)),n&&this.renderCatastrophicPanel(),!n&&a.createElement("div",{ref:this.animationContainerRef,className:"WACWidget__animationContainer",onScroll:()=>{0!==this.animationContainerRef.current.scrollTop&&(this.animationContainerRef.current.scrollTop=0)}},this.renderChat()),a.createElement("div",{className:"WACMainWindowModalHost",ref:this.setModalPortalHostElement}))))}render(){return a.createElement(es.B.Provider,{value:this.state.modalPortalHostElement},this.renderWidget())}}var gs=(0,ct.Ng)(e=>e,null,null,{forwardRef:!0})(hs);const ps=(0,nt.QT)();function ms({serviceManager:e,hostElement:t,applicationStyles:s,fontStyles:n}){const{store:r}=e,{config:o}=r.getState();o.public.debug&&(0,g.$Z)("[render] Called render");const i=`${n?`${n} `:""}${s}`;return a.createElement(ct.Kq,{store:r},a.createElement(Ss,{serviceManager:e,hostElement:t,applicationStyles:i}))}function Ss({serviceManager:e,hostElement:t,applicationStyles:s}){const n=(0,ct.d4)(e=>e.languagePack),r=(0,ct.d4)(e=>e.cssVariableOverrides),o=(0,ct.d4)(e=>e.theme),i=(0,ct.d4)(e=>e.config),c=(0,ct.d4)(e=>e.layout),{namespace:u}=e,{originalName:d}=u,h=(0,ct.wA)(),[g,p]=(0,a.useState)({width:window.innerWidth,height:window.innerHeight}),m=(0,a.useMemo)(()=>function(e){let t="";const s=Object.keys(e).map(t=>{const s=e[t];return void 0===s?"":`${t.startsWith("$")?`${ue}${t.replace(/^\$/,"")}`:`${ue}chat-${t}`}:${s};`}).join("");return s.length>0&&(t=`.WACContainer .cds--white, .WACContainer .cds--g10, .WACContainer .cds--g90, .WACContainer .cds--g100, :host{${s}}`),t}(r),[r]),S=document.dir||"auto";return(0,pt.y)(()=>{const e=()=>{p({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",e);const t=()=>{h(l.Ay.setIsBrowserPageVisible("visible"===document.visibilityState))};return document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("resize",e),document.removeEventListener("visibilitychange",t)}}),a.createElement("div",{className:"WACContainer","data-namespace":d,ref:e=>{e&&t&&(e.style.setProperty("height","100%","important"),e.style.setProperty("width","100%","important"))}},a.createElement("div",{className:"WACContainer--styles"},a.createElement("style",{"data-base-styles":"true",nonce:i.public.cspNonce},s||".WACContainer { visibility: hidden; }"),a.createElement("style",{"data-variables-custom":"true",nonce:i.public.cspNonce},m)),a.createElement("div",{className:rt("WACContainer--render",fe(o),{"WACContainer-disableMobileEnhancements":t&&i.public.disableCustomElementMobileEnhancements,"WAC-isPhone":He.a3&&!i.public.disableCustomElementMobileEnhancements,"WAC-isPhonePortraitMode":He.cT&&!i.public.disableCustomElementMobileEnhancements,"WAC--frameless":!c?.showFrame}),dir:S},a.createElement(Wt.l.Provider,{value:g},a.createElement(Ht.k.Provider,{value:e},a.createElement(ot.Kq,{value:e.intl},a.createElement(Lt.F.Provider,{value:n},a.createElement(ht,null,a.createElement(fs,{serviceManager:e,hostElement:t}))))))))}function fs(e){const{hostElement:t,serviceManager:s}=e,n=(0,ct.d4)(e=>e.launcher.config.is_on),{viewState:r}=(0,ct.d4)(e=>e.persistedToBrowserStorage.launcherState),o=(0,a.useRef)(),i=(0,a.useRef)(),c=r.tour,l=(0,a.useRef)(c);l.current=c||l.current;const u=(0,it.A)(),d=s.namespace.originalName,h=d?"window_ariaChatRegionNamespace":"window_ariaChatRegion",p=u.formatMessage({id:h},{namespace:d});return(0,pt.y)(()=>{s.appWindow={requestFocus:function(){try{const{persistedToBrowserStorage:e}=s.store.getState(),{viewState:t}=e.launcherState;t.tour?o.current?.requestFocus():t.mainWindow&&i.current?.requestFocus()}catch(e){(0,g.yA)("An error occurred in App.requestFocus",e)}}}}),a.createElement("div",{className:"WACWidget__regionContainer",role:"region","aria-label":p},a.createElement(gs,{mainWindowRef:i,useCustomHostElement:Boolean(t),serviceManager:s}),l.current&&a.createElement(a.Suspense,{fallback:null},a.createElement(ps,{ref:o})),n&&a.createElement(Nt,null))}var ys=s(8325);function Cs({chatInstance:e,renderUserDefinedResponse:t,userDefinedResponseEventsBySlot:s}){return t?Object.entries(s).map(([s,n])=>{const{element:r}=n;return r?a.createElement(vs,{key:s,hostElement:r},t(n,e)):null}):null}function vs({hostElement:e,children:t}){return ys.createPortal(t,e)}const Es=a.memo(Cs);function As({chatInstance:e,renderResponseMap:t}){return a.createElement(a.Fragment,null,Object.keys(e.writeableElements).map(s=>{const n=t[s];return n?a.createElement(ws,{key:s,hostElement:e.writeableElements[s]},n):null}))}function ws({hostElement:e,children:t}){return ys.createPortal(t,e)}const Is=a.memo(As);function Ms({config:e,onBeforeRender:t,onAfterRender:s,renderUserDefinedResponse:r,renderWriteableElements:o,container:i,setParentInstance:l,element:u}){const[d,h]=(0,a.useState)(null),[m,S]=(0,a.useState)(null),[f,y]=(0,a.useState)(null),C=e=>{h(e),l?.(e)},[v,E]=(0,a.useState)({}),A=(0,a.useRef)(null),w=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const a=w.current;if(w.current=e,!(0,n.A)(a,e)){const n={instance:null,shouldDestroy:!1,config:e};return e&&async function({managedWebChatRef:e,managedWebChat:t,render:s,setInstance:n,onBeforeRender:a,onAfterRender:r,setUserDefinedResponseEventsBySlot:o,element:i}){if(await Ts(e.current,n),e.current=t,t.shouldDestroy)return void await Ts(t,n);const l=await async function(e,t,s,n){const a=(0,c.A)(e);if(!a.messaging?.customSendMessage)throw new Error("You must set messaging.customSendMessage in your configuration object.");a?.debug&&(0,g.$Z)("[ChatEntry] Called instantiateWidget",a),"https:"!==document.location.protocol&&(0,g.OP)('Your page is not running with "https"; your data will not be sent  securely.'),"CSS1Compat"!==document.compatMode&&(0,g.OP)('Your page is running in quirks mode; you may experience layout issues with the chat. Add "<!DOCTYPE html>" to the page to run in standards mode.');const{onError:r,...o}=a;return new(await Promise.resolve(at))(o,n,{onError:r,render:s})}(t.config,0,Promise.resolve(s),i),u=await l.start();(function(e,t){e.on({type:p.xp.CHUNK_USER_DEFINED_RESPONSE,handler:function(e){if("complete_item"in e.data.chunk){const s=e.data.chunk.complete_item;t(t=>({...t,[e.data.slot]:{messageItem:s,element:e.data.element}}))}else if("partial_item"in e.data.chunk){const s=e.data.chunk.partial_item;t(t=>({...t,[e.data.slot]:{partialItems:[...t[e.data.slot]?.partialItems||[],s],element:e.data.element}}))}}}),e.on({type:p.xp.USER_DEFINED_RESPONSE,handler:function(e){t(t=>({...t,[e.data.slot]:{fullMessage:e.data.fullMessage,messageItem:e.data.message,element:e.data.element}}))}}),e.on({type:p.xp.RESTART_CONVERSATION,handler:function(){t({})}})})(u,o),a?.(u),await u.render(),r?.(u),n(u),t.instance=u,t.shouldDestroy&&await Ts(t,n)}({managedWebChatRef:A,managedWebChat:n,render:async function({serviceManager:e}){const t=await async function(){const[e,t]=await Promise.all([_s(),Rs()]);return t+e}();e.container=i,e.customHostElement?(i.style.setProperty("width","100%","important"),i.style.setProperty("height","100%","important")):(i.style.setProperty("width","0","important"),i.style.setProperty("height","0","important")),y(t),S({serviceManager:e}),await(0,z.y)(0)},setInstance:C,onBeforeRender:t,onAfterRender:s,setUserDefinedResponseEventsBySlot:E,element:u}),()=>{Ts(n,C),w.current=null}}},[e,i]),m&&d?a.createElement(a.Fragment,null,a.createElement(ms,{serviceManager:m.serviceManager,hostElement:m.serviceManager.customHostElement,applicationStyles:f}),r&&a.createElement(Es,{chatInstance:d,renderUserDefinedResponse:r,userDefinedResponseEventsBySlot:v}),o&&a.createElement(Is,{chatInstance:d,renderResponseMap:o})):null}async function Ts(e,t){e&&(e.instance&&(e.instance.destroy(),await(0,z.y)(0)),e.shouldDestroy=!0,e.instance=null),t(null),await(0,z.y)(0)}const bs=a.memo(Ms),_s=async()=>{const{default:e}=await s.e(3212).then(s.bind(s,3212));return e},Rs=async()=>{const{default:e}=await s.e(2971).then(s.bind(s,2971));return e}},2537:function(e,t,s){s.d(t,{J:function(){return r}});var n=s(3696),a=s(395);function r(e){const t=n.forwardRef((t,s)=>{const r=(0,n.useContext)(a.s);return n.createElement(e,{...t,ref:s,ariaAnnouncer:r})});return t.displayName=`withAriaAnnouncer(${e.displayName||e.name||"Component"})`,t}},3092:function(e,t,s){var n;s.d(t,{J:function(){return n}}),function(e){e[e.NONE=1]="NONE",e[e.FAILED=2]="FAILED",e[e.RETRYING=3]="RETRYING",e[e.WAITING=4]="WAITING"}(n||(n={}))},5041:function(e,t,s){function n(){let e,t;const s=new Promise((s,n)=>{e=s,t=n});return s.doResolve=t=>{s.isResolved=!0,s.isComplete=!0,e(t)},s.doReject=e=>{s.isRejected=!0,s.isComplete=!0,t(e)},s.isResolved=!1,s.isRejected=!1,s.isComplete=!1,s}s.d(t,{H:function(){return n}})},5807:function(e,t,s){s.d(t,{P:function(){return l},o:function(){return c}});var n=s(3696),a=s(7338),r=s(5112);const o=new Set(["button","date","datetime-local","email","file","month","number","range","reset","search","submit","tel","text","time","url","week"]),i="data-wac-exclude-node-read";class c extends n.PureComponent{constructor(){super(...arguments),this.ref1=n.createRef(),this.ref2=n.createRef(),this.useRef1=!0,this.doAnnouncements=()=>{const e=[];this.pendingValues.forEach(t=>{"string"==typeof t?e.push(t):l(t,e)});const t=this.useRef1?this.ref1.current:this.ref2.current;t&&(t.innerText=e.join(" "),(this.useRef1?this.ref2.current:this.ref1.current).innerHTML=""),this.useRef1=!this.useRef1,this.pendingValues=null}}announceValue(e){if(e)if(this.pendingValues||(this.pendingValues=[],setTimeout(this.doAnnouncements,250)),"string"==typeof e||function(e){return void 0!==e.nodeType}(e))this.pendingValues.push(e);else if(e.messageID){const t=this.props.intl.formatMessage({id:e.messageID},e.messageValues);this.pendingValues.push(t)}else this.pendingValues.push(e.messageText)}render(){return n.createElement(r.A,{className:"WACAriaAnnouncer"},n.createElement("div",{ref:this.ref1,"aria-live":"polite"}),n.createElement("div",{ref:this.ref2,"aria-live":"polite"}))}}function l(e,t){(0,a.vq)(e)?"none"===window.getComputedStyle(e).display||"true"===e.getAttribute("aria-hidden")||e.hasAttribute(i)||(u(e.getAttribute("aria-label"),t),(0,a.vQ)(e)&&o.has(e.type.toLowerCase())?""===e.value?u(e.placeholder,t):u(e.value,t):(0,a.rG)(e)?""===e.value&&u(e.placeholder,t):(0,a.A8)(e)&&u(e.alt,t),e.shadowRoot&&e.shadowRoot.childNodes?.forEach(e=>{l(e,t)}),e.childNodes&&e.childNodes.forEach(e=>{l(e,t)})):(0,a.ir)(e)&&u(e.data,t)}function u(e,t){e&&(e=e.trim())&&t.push(e.replaceAll("\n"," "))}},5884:function(e,t,s){s.d(t,{Z:function(){return c}});var n=s(3696),a=s(5022),r=s(5688),o=s(4458);function i(e,t){const{brandColor:s,onClose:i,onRestart:c,onCloseAndRestart:l}=e,u=(0,a.d4)(e=>e.config.public.showRestartButton||e.config.public.headerConfig?.showRestartButton),d=(0,a.d4)(e=>e.persistedToBrowserStorage.chatState.homeScreenState.showBackToBot),h=(0,a.d4)(e=>e.headerDisplayName),g=(0,a.d4)(e=>e.customMenuOptions),p=(0,a.d4)(e=>e.theme.useAITheme),m=(0,n.useRef)();(0,n.useImperativeHandle)(t,()=>m.current);const S=!d,f=(0,n.useCallback)(e=>{const{handler:t}=g[e];t()},[g]),y=g?.map(e=>e.text);return n.createElement("div",{className:"WACHomeScreenHeader"},n.createElement(r.Y,{ref:m,displayName:h,showCenter:!0,showRestartButton:u,hideCloseAndRestartButton:S,onClickRestart:c,onClickClose:i,onCloseAndRestart:l,overflowClicked:f,overflowItems:y,useAITheme:p,brandColor:s,testIdPrefix:o.G.HOME_SCREEN}))}const c=n.memo((0,n.forwardRef)(i))},6538:function(e,t,s){s.d(t,{l:function(){return n}});const n=s(3696).createContext(null)},7429:function(e,t,s){s.d(t,{D:function(){return o}});var n=s(3696),a=s(2537);class r extends n.PureComponent{constructor(){super(...arguments),this.state={isMounted:!1},this.onceAnnounced=!1}componentDidMount(){this.setState({isMounted:!0}),this.onceAnnounced||(this.props.announceOnce&&setTimeout(()=>{this.props.ariaAnnouncer(this.props.announceOnce)}),this.onceAnnounced=!0)}render(){return n.createElement("div",{"aria-live":"polite"},this.state.isMounted&&this.props.children)}}const o=(0,a.J)(r)},9049:function(e,t,s){s.d(t,{PK:function(){return c},R0:function(){return i},i_:function(){return l}});const n=e=>e.botInputState,a=e=>e.agentState.inputState,r=e=>e.agentState,o=e=>e.persistedToBrowserStorage.chatState.agentState;function i(e){const t=r(e),s=o(e);if(s.isSuspended)return{isConnectingOrConnected:!1,disableInput:!1,isAgentTyping:!1,inputPlaceholderKey:null};const{isReconnecting:n,isConnecting:a,isAgentTyping:i}=t,{isConnected:c}=s;let l;return l=a?"agent_inputPlaceholderConnecting":n?"agent_inputPlaceholderReconnecting":null,{isAgentTyping:i,isConnectingOrConnected:a||c,disableInput:a||n,inputPlaceholderKey:l}}function c(e){return i(e).isConnectingOrConnected}function l(e){return c(e)?a(e):n(e)}},9186:function(e,t,s){s.d(t,{r:function(){return g}});var n=s(1311),a=s(3696),r=s(5022),o=s(6254),i=s(6683),c=s(9049),l=s(8205),u=s(5688),d=s(8795);function h(e,t){const{onClose:s,onCloseAndRestart:h,onRestart:g,onToggleHomeScreen:p,headerDisplayName:m,includeWriteableElement:S,enableChatHeaderConfig:f,headerAvatarConfig:y,testIdPrefix:C}=e,v=(0,i.O)(),E=(0,o.D)(),A=(0,r.d4)(e=>e.homeScreenConfig.is_on&&e.homeScreenConfig.allow_return),w=(0,r.d4)(e=>e.config.public),I=(0,r.d4)(e=>e.customMenuOptions),{isConnectingOrConnected:M}=(0,r.d4)(c.R0,r.bN),T=(0,r.d4)(e=>e.theme.useAITheme),b=(0,r.d4)(e=>e.chatHeaderState.maxVisibleHeaderObjects),_=(0,r.d4)(e=>e.chatHeaderState.config?.left?.length||0),R=(0,r.d4)(e=>e.chatHeaderState.config?.right?.length||0),P=(0,a.useRef)(),D=f&&(_>b||R>b),B=w.showRestartButton||w.headerConfig?.showRestartButton,O=A&&!M,N=(0,a.useCallback)(e=>{if(0===e&&O)p?.();else{const{handler:t}=I[O?e-1:e];t()}},[I,p,O]);let L=I?.map(e=>e.text);return L&&O?L.splice(0,0,E.homeScreen_overflowMenuHomeScreen):!L&&O&&D&&(L=[E.homeScreen_overflowMenuHomeScreen]),(0,a.useImperativeHandle)(t,()=>P.current),a.createElement("div",{className:"WACHeader__Container"},a.createElement(u.Y,{ref:P,showCenter:!0,headerAvatarConfig:y,displayName:m,showBackButton:Boolean(O&&p),showRestartButton:B,useAITheme:T,backContent:a.createElement(n.A,null),labelBackButton:E.homeScreen_returnToHome,onClickRestart:g,onClickClose:s,onCloseAndRestart:h,onClickBack:p,overflowItems:L,overflowClicked:N,enableChatHeaderConfig:f,testIdPrefix:C}),S&&a.createElement(l.A,{slotName:d.t.HEADER_BOTTOM_ELEMENT,id:`headerBottomElement${v.namespace.suffix}`,className:"WACHeader__HeaderBottomElement"}))}const g=a.memo((0,a.forwardRef)(h))},9280:function(e,t,s){function n(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(t=>{!Object.prototype.hasOwnProperty.call(e,t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||n(e[t])}),e}s.d(t,{o:function(){return n}})},9499:function(e,t,s){s.d(t,{A:function(){return o}});var n=s(9633),a=s(6753),r=s(577);function o(e,t,s=(0,a.u)(r.y.LOCAL_MESSAGE)){return{item:{response_type:n.sP.TEXT,...e.input},ui_state:{id:s,originalUserText:t,needsAnnouncement:!1},fullMessageID:e.id}}},9763:function(e,t,s){s.d(t,{A9:function(){return b},AF:function(){return f},BC:function(){return E},F:function(){return M},G:function(){return i},HD:function(){return o},HM:function(){return u},HO:function(){return T},KK:function(){return r},KT:function(){return I},Nj:function(){return c},Rf:function(){return m},VD:function(){return y},XF:function(){return l},_0:function(){return C},bf:function(){return a},cg:function(){return w},dB:function(){return n},gW:function(){return d},hB:function(){return v},j1:function(){return p},np:function(){return S},o$:function(){return h},oP:function(){return _},qb:function(){return A},xO:function(){return g}});const n="HA_SET_AGENT_AVAILABILITY",a="HA_SET_IS_CONNECTING",r="HA_SET_IS_RECONNECTING",o="HA_SET_AGENT_JOINED",i="HA_SET_AGENT_LEFT_CHAT",c="HA_END_CHAT",l="HA_UPDATE_CAPABILITIES",u="HA_UPDATE_FILE_UPLOAD_IN_PROGRESS",d="HA_SET_SHOW_SCREEN_SHARE_REQUEST",h="HA_SET_IS_SCREEN_SHARING",g="HA_SET_PERSISTED_STATE",p="HA_UPDATE_IS_SUSPENDED",m="HA_UPDATE_IS_TYPING";function S(e,t){return{type:a,isConnecting:e,localMessageID:t}}function f(e){return{type:r,isReconnecting:e}}function y(){return{type:i}}function C(){return{type:c}}function v(e){return{type:n,availability:e}}function E(e){return{type:o,agentProfile:e}}function A(e){return{type:l,capabilities:e}}function w(e){return{type:u,fileUploadInProgress:e}}function I(e){return{type:d,showRequest:e}}function M(e){return{type:h,isSharing:e}}function T(e){return{type:g,state:e}}function b(e){return{type:p,isSuspended:e}}function _(e){return{type:m,isTyping:e}}}}]);
//# sourceMappingURL=2288.bundle.js.map