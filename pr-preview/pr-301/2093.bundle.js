/*! For license information please see 2093.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_carbon_ai_chat_examples_demo=self.webpackChunk_carbon_ai_chat_examples_demo||[]).push([[2093],{171:function(e,t,n){n.d(t,{U:function(){return r},u:function(){return a}});var r,s=n(5745);function a(e){return(0,s.A)()}!function(e){e[e.MISCELLANEOUS=1]="MISCELLANEOUS",e[e.LOCAL_MESSAGE=2]="LOCAL_MESSAGE",e[e.MESSAGE=3]="MESSAGE",e[e.COMPONENT=4]="COMPONENT",e[e.USER=6]="USER",e[e.DEVICE_ID=8]="DEVICE_ID",e[e.FILE=9]="FILE"}(r||(r={}))},307:function(e,t,n){n.d(t,{A:function(){return g},B:function(){return f},C:function(){return X},D:function(){return y},E:function(){return N},F:function(){return D},G:function(){return J},H:function(){return l},I:function(){return G},J:function(){return v},K:function(){return I},L:function(){return x},M:function(){return O},N:function(){return L},O:function(){return B},P:function(){return R},Q:function(){return w},T:function(){return E},a:function(){return p},b:function(){return d},c:function(){return T},d:function(){return W},e:function(){return V},f:function(){return c},g:function(){return $},h:function(){return m},i:function(){return H},j:function(){return _},k:function(){return M},l:function(){return h},m:function(){return C},n:function(){return Y},o:function(){return q},p:function(){return j},q:function(){return P},r:function(){return b},s:function(){return o},t:function(){return z},u:function(){return S},v:function(){return k},w:function(){return F},x:function(){return A},y:function(){return i},z:function(){return u}});var r=n(8690),s=n(171),a=n(1536);function i(e){return Array.isArray(e)?e:[e]}async function o(e,t){for(let n=0;n<e.length;n++){const r=e[n];await t(r,n,e)}}function u(e,t,n){const r=function(e,t){if(e)for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}(e,t);return-1===r?void 0:e[r]}function c(e){return e&&e.length?e[e.length-1]:null}const E="main";function d(e){return e&&void 0!==e.output}function g(e){return e?.item.response_type===a.e.DATE}function h(e){return e.id||(e.id=(0,s.u)(s.U.MESSAGE)),e.thread_id||(e.thread_id=E),e.history||(e.history={}),e.ui_state_internal||(e.ui_state_internal={}),e.history.timestamp||(e.history.timestamp=Date.now()),void 0===e.ui_state_internal.from_history&&(e.ui_state_internal.from_history=!1),e}function p(e){return void 0!==e?.input}function _(e){return Boolean(e.item.agent_message_type)}function f(e){return e?.input?.message_type===a.d.EVENT}function l(e){return e&&"text"===e.response_type&&void 0!==e.text}function A(e){return e.response_type===a.e.PAUSE&&1==e.typing}function S(e){return e.response_type===a.e.PAUSE}function T(e){return e?.response_type===a.e.OPTION&&void 0!==e.options}function y(e,t){const n={id:(0,s.u)(s.U.MESSAGE),thread_id:E,...(0,r.A)(e.value)};return n.history={label:e.label,related_message_id:t},n}function N(e,t){const n={id:(0,s.u)(s.U.MESSAGE),thread_id:E,input:null};return e.value?.input?.text?n.input=(0,r.A)(e.value.input):n.input={text:e.label},n.history={related_message_id:t},n}function m(){return h({id:(0,s.u)(s.U.MESSAGE),input:{text:""},history:{silent:!0,is_welcome_request:!0},thread_id:E})}function M(e){return h({input:{text:e,message_type:a.d.TEXT}})}function I(e){return h({id:e.id,input:{text:e.file.name,message_type:a.s.FILE,agent_message_type:a.H.FROM_USER},history:{file_upload_status:a.F.UPLOADING}})}function D(e,t,n){const r=M(e);return r.history={label:t,related_message_id:n},r}function C(e,t=E,n=a.e.TEXT,r){const i={response_type:n,text:e};return{id:(0,s.u)(s.U.MESSAGE),thread_id:t,output:{generic:[i]}}}function v(e,t){return h({output:{generic:[e]}})}function H(e){return e?.response_type===a.e.CONNECT_TO_HUMAN_AGENT}function R(e){return e?.response_type===a.e.CARD}function O(e){return e?.response_type===a.e.CAROUSEL}function w(e){return e?.response_type===a.e.BUTTON}function L(e){return w(e)&&e.button_type===a.c.SHOW_PANEL}function P(e){return w(e)?U(e.panel):R(e)?U(e):O(e)?void 0!==e.items:x(e)}function U(e){return void 0!==e?.body||void 0!==e?.footer}function b(e){switch(e.response_type){case a.e.TEXT:case a.e.IMAGE:case a.e.OPTION:case a.e.CONNECT_TO_HUMAN_AGENT:case a.e.IFRAME:case a.e.VIDEO:case a.e.AUDIO:case a.e.DATE:case a.e.CONVERSATIONAL_SEARCH:case a.e.TABLE:case a.e.INLINE_ERROR:case a.e.CARD:case a.e.CAROUSEL:case a.e.BUTTON:case a.e.GRID:return!1;default:return!G(e)}}function G(e){return k(e)}function k(e){return"IBM_BETA_JOURNEYS_TOUR"===e?.user_defined?.user_defined_type}function F(e){return Boolean(e.public.serviceDeskFactory)}function B(e){switch(e.response_type){case a.e.IMAGE:case a.e.IFRAME:case a.e.VIDEO:case a.e.AUDIO:case a.e.TEXT:case a.e.USER_DEFINED:case a.e.CARD:case a.e.GRID:return!0;default:return!1}}function V(e){return O(e)&&1===e.items.length}function W(e){return t=e,t?.response_type===a.e.USER_DEFINED&&e.full_width;var t}function x(e){return e?.response_type===a.e.GRID}function J(e,t){let n="button";return e&&"button"===e?n="button":(e&&"dropdown"===e||t>4)&&(n="dropdown"),n}function q(e){return Boolean(e.partial_item)}function Y(e){return Boolean(e.complete_item)}function j(e){return Boolean(e.final_response)}function z(e,t){const n=t?.streaming_metadata?.id;return n?`${e}-${n}`:null}function $(e){return e.dimensions}function X(e){return function(e,t,n){for(let r=e.length-1;r>=0;r--){const s=t[e[r]];if(n(s))return s}}(e.botMessageState.messageIDs||[],e.allMessagesByID,e=>d(e)&&!function(e){return d(e)&&Boolean(e.output.generic?.find(e=>e?.agent_message_type))||p(e)&&Boolean(e.input.agent_message_type)}(e)&&Boolean(e.context))}},481:function(e,t,n){n.d(t,{I:function(){return E},a:function(){return h},b:function(){return d},c:function(){return c},d:function(){return g},e:function(){return _},g:function(){return p}});var r=n(4880),s=n(711);const a="undefined"!=typeof window&&"undefined"!=typeof navigator,i=a?(0,r.o0)():void 0;let o=0,u=0;a&&(o=window.screen.width,u=window.screen.height);const c="iOS"===i?.os,E=c||"Android OS"===i?.os,d=E&&(o<500||u<500),g=d&&o<500,h=(0,s.A)(function(){if(!a||!window.sessionStorage)return!1;try{return window.sessionStorage.setItem("web-chat-test-item","true"),window.sessionStorage.getItem("web-chat-test-item"),window.sessionStorage.removeItem("web-chat-test-item"),!0}catch{return!1}});function p(e){try{return new URL(e).hostname}catch{return e}}function _(e,t){return t?setTimeout(e,t):(e(),null)}},1400:function(e,t,n){n.d(t,{A:function(){return R},B:function(){return O},C:function(){return k},D:function(){return v},E:function(){return b},H:function(){return A},a:function(){return G},b:function(){return c},c:function(){return E},d:function(){return F},e:function(){return T},f:function(){return N},g:function(){return S},h:function(){return l},i:function(){return o},j:function(){return I},k:function(){return M},l:function(){return m},m:function(){return f},n:function(){return y},o:function(){return u},p:function(){return h},q:function(){return _},r:function(){return B},s:function(){return p},t:function(){return D},u:function(){return L},v:function(){return H},w:function(){return U},x:function(){return C},y:function(){return P},z:function(){return w}});var r=n(1536),s=n(171),a=n(307),i=n(4859);function o(e,t,n=(0,s.u)(s.U.LOCAL_MESSAGE)){return{item:{response_type:r.e.TEXT,...e.input},ui_state:{id:n,originalUserText:t,needsAnnouncement:!1},fullMessageID:e.id}}function u(e,t,n=!1,r=!1){const i={ui_state:{id:(0,a.t)(t.id,e)||(0,s.u)(s.U.LOCAL_MESSAGE),needsAnnouncement:!t.ui_state_internal?.from_history,disableFadeAnimation:r},item:e,fullMessageID:t.id};return n&&(i.ui_state.isWelcomeResponse=!0),i}function c(e){return function(e){const t=(0,a.J)(e);return{originalMessage:t,localMessage:u(e,t)}}({response_type:r.e.INLINE_ERROR,text:e})}function E(e,t,n,r,s){const{item:i}=e;if((0,a.L)(i))e.ui_state.gridLocalMessageItemIDs=i.rows.map(s=>s.cells.map(s=>{const a=[];return d("items",e,s.items,a,t,n,r,t=>g(e.item,t),!1),a}));else if((0,a.M)(i))e.ui_state.itemsLocalMessageItemIDs=[],d("items",e,i.items,e.ui_state.itemsLocalMessageItemIDs,t,n,r,e=>g(i,e),s);else{const o=i.body||i.panel?.body;if(o&&(e.ui_state.bodyLocalMessageItemIDs=[],d("body",e,o,e.ui_state.bodyLocalMessageItemIDs,t,n,r,e=>g(i,e),!(0,a.N)(i))),!s)return;const u=i.footer||i.panel?.footer;u&&(e.ui_state.footerLocalMessageItemIDs=[],d("footer",e,u,e.ui_state.footerLocalMessageItemIDs,t,n,r,e=>function(e,t){return!!(0,a.Q)(t)&&(!(0,a.N)(e)||!(0,a.N)(t))}(i,e),!(0,a.N)(i)))}}function d(e,t,n,r,s,o,c,d,g){n.forEach(n=>{if(d(n)){const e=u(n,s,!1,!0);r.push(e.ui_state.id),c.push(e),(0,a.q)(e.item)&&E(e,s,o,c,g)}else(0,i.b)(`The "${t.item.response_type}" response type does not support "${n.response_type}" in "${e}" array.`)})}function g(e,t){switch(e.response_type){case r.e.CARD:return!(0,a.P)(t)&&(0,a.O)(t);case r.e.CAROUSEL:return(0,a.P)(t);case r.e.BUTTON:return e.button_type===r.c.SHOW_PANEL&&(0,a.O)(t);case r.e.GRID:return!(0,a.P)(t)&&(0,a.O)(t);default:return!1}}const h="HA_SET_HUMAN_AGENT_AVAILABILITY",p="HA_SET_IS_CONNECTING",_="HA_SET_IS_RECONNECTING",f="HA_SET_HUMAN_AGENT_JOINED",l="HA_SET_HUMAN_AGENT_LEFT_CHAT",A="HA_END_CHAT",S="HA_UPDATE_CAPABILITIES",T="HA_UPDATE_FILE_UPLOAD_IN_PROGRESS",y="HA_SET_SHOW_SCREEN_SHARE_REQUEST",N="HA_SET_IS_SCREEN_SHARING",m="HA_SET_PERSISTED_STATE",M="HA_UPDATE_IS_SUSPENDED",I="HA_UPDATE_IS_TYPING";function D(e,t){return{type:p,isConnecting:e,localMessageID:t}}function C(e){return{type:_,isReconnecting:e}}function v(){return{type:l}}function H(){return{type:A}}function R(e){return{type:h,availability:e}}function O(e){return{type:f,responseUserProfile:e}}function w(e){return{type:S,capabilities:e}}function L(e){return{type:T,fileUploadInProgress:e}}function P(e){return{type:y,showRequest:e}}function U(e){return{type:N,isSharing:e}}function b(e){return{type:m,state:e}}function G(e){return{type:M,isSuspended:e}}function k(e){return{type:I,isTyping:e}}function F(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(t=>{!Object.prototype.hasOwnProperty.call(e,t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||F(e[t])}),e}function B(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});return n.doResolve=t=>{n.isResolved=!0,n.isComplete=!0,e(t)},n.doReject=e=>{n.isRejected=!0,n.isComplete=!0,t(e)},n.isResolved=!1,n.isRejected=!1,n.isComplete=!1,n}},1517:function(e,t,n){n.d(t,{$:function(){return U},A:function(){return re},B:function(){return v},C:function(){return Z},D:function(){return C},E:function(){return V},F:function(){return ne},G:function(){return B},H:function(){return w},I:function(){return H},J:function(){return M},K:function(){return I},L:function(){return m},M:function(){return D},N:function(){return P},O:function(){return q},P:function(){return y},Q:function(){return u},R:function(){return Ee},S:function(){return fe},T:function(){return $},U:function(){return le},V:function(){return o},W:function(){return i},X:function(){return a},Y:function(){return T},Z:function(){return S},_:function(){return A},a:function(){return Ae},a0:function(){return b},a1:function(){return p},a2:function(){return l},a3:function(){return f},a4:function(){return _},a5:function(){return N},a6:function(){return L},a7:function(){return W},a8:function(){return h},a9:function(){return g},aa:function(){return d},ab:function(){return E},ac:function(){return O},ad:function(){return c},ae:function(){return s},b:function(){return _e},c:function(){return pe},d:function(){return he},e:function(){return ge},f:function(){return ie},g:function(){return ue},h:function(){return oe},i:function(){return ae},j:function(){return se},k:function(){return de},l:function(){return ce},m:function(){return te},n:function(){return ee},o:function(){return Q},p:function(){return K},q:function(){return X},r:function(){return F},s:function(){return k},t:function(){return G},u:function(){return j},v:function(){return z},w:function(){return Y},x:function(){return J},y:function(){return x},z:function(){return R}});var r=n(171);const s="CHANGE_STATE",a="UPDATE_BOT_NAME",i="UPDATE_BOT_AVATAR_URL",o="UPDATE_LAUNCHER_AVATAR_URL",u="UPDATE_MAIN_HEADER_TITLE",c="HYDRATE_CHAT",E="HYDRATE_MESSAGE_HISTORY",d="ADD_LOCAL_MESSAGE_ITEM",g="REMOVE_MESSAGES",h="UPDATE_LOCAL_MESSAGE_ITEM",p="SET_APP_STATE_VALUE",_="ADD_IS_TYPING_COUNTER",f="ADD_IS_LOADING_COUNTER",l="ADD_IS_HYDRATING_COUNTER",A="SET_VIEW_STATE",S="SET_VIEW_CHANGING",T="SET_INITIAL_VIEW_CHANGE_COMPLETE",y="UPDATE_CSS_VARIABLES",N="MESSAGE_SET_OPTION_SELECTED",m="SET_MESSAGE_UI_PROPERTY",M="SET_MESSAGE_UI_STATE_INTERNAL_PROPERTY",I="SET_MESSAGE_HISTORY_PROPERTY",D="MERGE_HISTORY",C="SET_LAUNCHER_PROPERTY",v="SET_LAUNCHER_CONFIG_PROPERTY",H="ANNOUNCE_MESSAGE",R="SET_CHAT_MESSAGES_PROPERTY",O="RESTART_CONVERSATION",w="ACCEPTED_DISCLAIMER",L="ADD_MESSAGE",P="UPDATE_HOME_SCREEN_CONFIG",U="UPDATE_HAS_SENT_NON_WELCOME_MESSAGE",b="UPDATE_PERSISTED_CHAT_STATE",G="SET_TOUR_DATA",k="CLEAR_TOUR_DATA",F="CHANGE_STEP_IN_TOUR",B="SET_HOME_SCREEN_IS_OPEN",V="UPDATE_LAUNCHER_CONFIG",W="UPDATE_MESSAGE",x="SET_LAUNCHER_MINIMIZED",J="CLOSE_IFRAME_PANEL",q="OPEN_IFRAME_CONTENT",Y="SET_CONVERSATIONAL_SEARCH_CITATION_PANEL_IS_OPEN",j="SET_CUSTOM_PANEL_OPTIONS",z="SET_CUSTOM_PANEL_OPEN",$="GO_BACK_TO_HOME",X="UPDATE_INPUT_STATE",K="SET_IS_PAGE_VISIBLE",Q="ADD_INPUT_FILE",Z="CLEAR_INPUT_FILES",ee="REMOVE_INPUT_FILE",te="REMOVE_LOCAL_MESSAGE_ITEM",ne="FILE_UPLOAD_INPUT_ERROR",re="ADD_NESTED_MESSAGES",se="SET_RESPONSE_PANEL_IS_OPEN",ae="SET_PANEL_RESPONSE_CONTENT",ie="STREAMING_ADD_CHUNK",oe="STREAMING_START",ue="STREAMING_MERGE_HISTORY",ce="ADD_NOTIFICATION",Ee="REMOVE_ALL_NOTIFICATIONS",de="REMOVE_NOTIFICATIONS",ge="UPDATE_CHAT_HEADER_CONFIG",he="UPDATE_MAX_VISIBLE_HEADER_OBJECTS",pe="SET_STOP_STREAMING_BUTTON_VISIBLE",_e="SET_STOP_STREAMING_BUTTON_DISABLED",fe="SET_STREAM_ID",le="UPDATE_MAIN_HEADER_AVATAR",Ae={changeState(e){return{type:s,partialState:e}},chatWasHydrated(){return{type:c}},hydrateMessageHistory(e){return{type:E,messageHistory:e}},removeMessages(e){return{type:g,messageIDs:e}},restartConversation(){return{type:O}},addLocalMessageItem(e,t,n,r){return{type:d,messageItem:e,message:t,addMessage:n,addAfterID:r}},addMessage(e){return{type:L,message:e}},updateLocalMessageItem(e){return{type:h,messageItem:e}},updateMessage(e){return{type:W,message:e}},messageSetOptionSelected(e,t){return{type:N,messageID:e,sentMessage:t}},updatePersistedChatState(e){return{type:b,chatState:e}},setTourData(e){return{type:G,newActiveTourMessageID:e}},clearTourData(){return{type:k}},changeStepInTour(e){return{type:F,newStepNumber:e}},updateHasSentNonWelcomeMessage(e){return{type:U,hasSentNonWelcomeMessage:e}},setAppStateValue(e,t){return{type:p,key:e,value:t}},addIsTypingCounter(e){return{type:_,addToIsTyping:e}},addIsLoadingCounter(e){return{type:f,addToIsLoading:e}},addIsHydratingCounter(e){return{type:l,addToIsHydrating:e}},updateBotName(e){return{type:a,name:e}},updateMainHeaderTitle(e){return{type:u,title:e}},updateBotAvatarURL(e){return{type:i,url:e}},updateCSSVariables(e,t,n){return{type:y,variables:e,publicVars:t,whiteLabelVariables:n}},updateHomeScreenConfig(e){return{type:P,homeScreenConfig:e}},setViewState(e){return{type:A,viewState:e}},setViewChanging(e){return{type:S,viewChanging:e}},setInitialViewChangeComplete(e){return{type:T,changeComplete:e}},setMessageUIProperty(e,t,n){return{type:m,localMessageID:e,propertyName:t,propertyValue:n}},setLauncherProperty(e,t){return{type:C,propertyName:e,propertyValue:t}},setLauncherConfigProperty(e,t,n){return{type:v,propertyName:e,propertyValue:t,launcherType:n}},setMessageHistoryProperty(e,t,n){return{type:I,messageID:e,propertyName:t,propertyValue:n}},setMessageUIStateInternalProperty(e,t,n){return{type:M,messageID:e,propertyName:t,propertyValue:n}},mergeMessageHistory(e,t){return{type:D,messageID:e,history:t}},setMessageErrorState(e,t){return Ae.setMessageHistoryProperty(e,"error_state",t)},setMessageWasAnnounced(e){return Ae.setMessageUIProperty(e,"needsAnnouncement",!1)},announceMessage(e){return{type:H,message:e}},setChatMessagesStateProperty(e,t){return{type:R,propertyName:e,propertyValue:t}},addNotification(e){const t=(0,r.u)();return{type:ce,notificationID:t,notification:e}},removeNotifications({groupID:e,notificationID:t}){return{type:de,groupID:e,notificationID:t}},removeAllNotifications(){return{type:Ee}},acceptDisclaimer(){return{type:w}},setHomeScreenIsOpen(e){return{type:B,isOpen:e}},updateLauncherConfig(e){return{type:V,launcherConfig:e}},setLauncherMinimized(){return{type:x}},closeIFramePanel(){return{type:J}},setIFrameContent(e){return{type:q,messageItem:e}},setViewSourcePanelIsOpen(e,t,n){return{type:Y,isOpen:e,citationItem:t,relatedSearchResult:n}},setCustomPanelConfigOptions(e){return{type:j,options:e}},setCustomPanelOpen(e){return{type:z,isOpen:e}},toggleHomeScreen(){return{type:$}},updateInputState(e,t){return{type:X,newState:e,isInputToHumanAgent:t}},setIsBrowserPageVisible(e){return{type:K,isVisible:e}},addInputFile(e,t){return{type:Q,file:e,isInputToHumanAgent:t}},removeFileUpload(e,t){return{type:ee,fileID:e,isInputToHumanAgent:t}},removeLocalMessageItem(e){return{type:te,localMessageItemID:e}},fileUploadInputError(e,t,n){return{type:ne,fileID:e,errorMessage:t,isInputToHumanAgent:n}},clearInputFiles(e){return{type:Z,isInputToHumanAgent:e}},addNestedMessages(e){return{type:re,localMessageItems:e}},setResponsePanelIsOpen(e){return{type:se,isOpen:e}},setResponsePanelContent(e,t=!1){return{type:ae,localMessageItem:e,isMessageForInput:t}},streamingStart(e){return{type:oe,messageID:e}},streamingMergeHistory(e,t){return{type:ue,messageID:e,history:t}},streamingAddChunk(e,t,n,r){return{type:ie,fullMessageID:e,chunkItem:t,isCompleteItem:n,disableFadeAnimation:r}},updateChatHeaderConfig(e){return{type:ge,chatHeaderConfig:e}},setMaxVisibleHeaderObjects(e){return{type:he,maxTotal:e}},setStopStreamingButtonVisible(e){return{type:pe,isVisible:e}},setStopStreamingButtonDisabled(e){return{type:_e,isDisabled:e}},setStreamID(e){return{type:fe,currentStreamID:e}},updateMainHeaderAvatar(e){return{type:le,config:e}}}},2093:function(e,t,n){n.r(t),n.d(t,{HumanAgentServiceImpl:function(){return P},createService:function(){return b},default:function(){return b},validateCustomServiceDesk:function(){return G}});var r=n(8690),s=n(1122),a=n(1400),i=n(1517),o=n(5569),u=n(4859),c=n(307),E=n(3539),d=n(481),g=n(1536);function h(e,t){return{localMessages:e,originalMessage:t}}async function p(e,t,n,r=!0){const s=function(e,t,n){const r=t?.nickname;let s;switch(e){case g.H.HUMAN_AGENT_JOINED:s=r?"agent_agentJoinedName":"agent_agentJoinedNoName";break;case g.H.RELOAD_WARNING:s="agent_youConnectedWarning";break;case g.H.HUMAN_AGENT_LEFT_CHAT:s=r?"agent_agentLeftChat":"agent_agentLeftChatNoName";break;case g.H.HUMAN_AGENT_ENDED_CHAT:s=r?"agent_agentEndedChat":"agent_agentEndedChatNoName";break;case g.H.TRANSFER_TO_HUMAN_AGENT:s=r?"agent_transferring":"agent_transferringNoName";break;case g.H.USER_ENDED_CHAT:s="agent_youEndedChat";break;case g.H.CHAT_WAS_ENDED:s="agent_conversationWasEnded";break;case g.H.DISCONNECTED:s="agent_disconnected";break;case g.H.RECONNECTED:s="agent_reconnected";break;case g.H.SHARING_REQUESTED:s="agent_sharingRequested";break;case g.H.SHARING_ACCEPTED:s="agent_sharingAccepted";break;case g.H.SHARING_DECLINED:s="agent_sharingDeclined";break;case g.H.SHARING_CANCELLED:s="agent_sharingCancelled";break;case g.H.SHARING_ENDED:s="agent_sharingEnded";break;default:return""}return s&&n.formatMessage({id:s},{personName:r})}(e,n,t.intl),i=_(e),{originalMessage:o,localMessage:u}=i;return u.item.text=s,n&&(o.history||(o.history={}),o.history.response_user_profile=n),r&&await t.fire({type:E.B.HUMAN_AGENT_PRE_RECEIVE,data:o}),(0,a.d)(o),r&&await t.fire({type:E.B.HUMAN_AGENT_RECEIVE,data:o}),i}function _(e){const t={response_type:g.e.TEXT,agent_message_type:e},n=(0,c.J)(t);return{localMessage:(0,a.o)(t,n),originalMessage:n}}async function f(e,t,n,r,s){r&&await(0,c.s)(e,async({localMessages:e,originalMessage:t})=>{await(0,c.s)(e,async(e,n)=>{await s.actions.handleUserDefinedResponseItems(e,t),s.store.dispatch(i.a.addLocalMessageItem(e,t,0===n))})})}async function l(e,t,n){const r=function(e){const{agent_botReturned:t}=e;if(!t)return null;const{originalMessage:n,localMessage:r}=_(null);return r.item.text=t,{originalMessage:n,localMessage:r}}(n.store.getState().languagePack);if(r){const s=n.restartCount;(0,d.e)(()=>{s===n.restartCount&&f([h([r.localMessage],r.originalMessage)],0,0,!t,n)},e)}}async function A(e,t,n,r,s){const a=await p(e,s,t,n);await f([h([a.localMessage],a.originalMessage)],0,0,!r,s)}n(3696);const{FROM_USER:S,RECONNECTED:T,DISCONNECTED:y,HUMAN_AGENT_ENDED_CHAT:N,HUMAN_AGENT_JOINED:m,USER_ENDED_CHAT:M,CHAT_WAS_ENDED:I,TRANSFER_TO_HUMAN_AGENT:D,HUMAN_AGENT_LEFT_CHAT:C,RELOAD_WARNING:v,SHARING_CANCELLED:H,SHARING_DECLINED:R,SHARING_ACCEPTED:O,SHARING_REQUESTED:w,SHARING_ENDED:L}=g.H;class P{constructor(e){this.chatStarted=!1,this.showingDisconnectedError=!1,this.isHumanAgentTyping=!1,this.uploadingFiles=new Set,this.showLeaveWarning=!0,this.serviceManager=e}getCustomServiceDeskName(){return this.serviceManager.store.getState().config.public.serviceDeskFactory?this.serviceDesk.getName?.():void 0}async initialize(){if(this.serviceDesk)throw new Error("A service desk has already been created!");const{store:e,instance:t}=this.serviceManager,n=e.getState(),{config:s,persistedToBrowserStorage:a}=n,i=(0,r.A)(a.chatState.humanAgentState.serviceDeskState);if(this.serviceDeskCallback=new U(this.serviceManager,this),s.public.serviceDeskFactory){const e={callback:this.serviceDeskCallback,instance:t,persistedState:i};this.serviceDesk=await s.public.serviceDeskFactory(e),G(this.serviceDesk),(0,u.e)("Initializing a custom service desk")}this.showLeaveWarning=!this.serviceDesk?.reconnect}async startChat(e,t){if(!this.serviceDesk)throw new Error("A service desk has not been configured.");if(this.serviceManager.store.getState().persistedToBrowserStorage.chatState.humanAgentState.isSuspended&&await this.endChat(!0,!0,!1),this.chatStarted)throw new Error("A chat is already running. A call to endChat must be made before a new chat can start.");const{serviceManager:n}=this;try{this.chatStarted=!0,this.isHumanAgentTyping=!1,this.uploadingFiles.clear(),this.serviceManager.store.dispatch((0,a.u)(this.uploadingFiles.size>0));const r={type:E.B.HUMAN_AGENT_PRE_START_CHAT,message:t};if(await n.fire(r),r.cancelStartChat)return this.chatStarted=!1,await this.fireEndChat(!1,!0),void n.store.dispatch((0,a.t)(!1,null));const s=n.store.getState().config.public.serviceDesk?.agentJoinTimeoutSeconds;s&&(this.waitingForHumanAgentJoinedTimer=setTimeout(()=>this.handleHumanAgentJoinedTimeout(),1e3*s)),n.store.dispatch((0,a.t)(!0,e.ui_state.id)),await this.serviceDesk.startChat(t,{preStartChatPayload:r.preStartChatPayload})}catch(e){throw(0,u.b)("[startChat] An error with the service desk occurred.",e),this.serviceDeskCallback&&await this.serviceDeskCallback.setErrorStatus({type:o.E.CONNECTING,logInfo:e}),n.store.dispatch((0,a.t)(!1,null)),this.chatStarted=!1,this.cancelHumanAgentJoinedTimer(),e}}async firePreEndChat(e){const t={type:E.B.HUMAN_AGENT_PRE_END_CHAT,endedByHumanAgent:e,preEndChatPayload:null,cancelEndChat:!1};return await this.serviceManager.fire(t),t}async fireEndChat(e,t){await this.serviceManager.fire({type:E.B.HUMAN_AGENT_END_CHAT,endedByHumanAgent:e,requestCancelled:t})}async endChat(e,t=!0,n=!0){if(!this.chatStarted||!this.serviceDesk)return;const{isConnected:r}=this.persistedHumanAgentState();let s;if(r&&(s=await this.firePreEndChat(!1),s.cancelEndChat))return;const a=e?M:I;await this.doEndChat(!1,s?.preEndChatPayload,t,n,a)}async doEndChat(e,t,n,r,s){const{isConnected:i}=this.persistedHumanAgentState(),c=this.isSuspended();this.cancelHumanAgentJoinedTimer(),this.closeScreenShareRequestModal(o.S.CANCELLED);try{await(0,u.r)(this.serviceDesk.endChat({endedByHumanAgent:e,preEndChatPayload:t}),5e3)}catch(e){(0,u.b)("[doEndChat] An error with the service desk occurred.",e)}if(i&&n){const{responseUserProfile:e}=this.persistedHumanAgentState();await A(s,e,!0,c,this.serviceManager)}this.chatStarted=!1,this.isHumanAgentTyping=!1,this.serviceManager.store.dispatch((0,a.v)()),await this.fireEndChat(e,!i),i&&r&&await l(1500,c,this.serviceManager)}async sendMessageToAgent(e,t){if(!this.serviceDesk||!this.chatStarted)return;const{serviceManager:n}=this;(0,a.d)(t);const r=(0,c.k)(e);r.input.agent_message_type=S,await n.fire({type:E.B.HUMAN_AGENT_PRE_SEND,data:r,files:t});const s=(0,a.i)(r,r.input.text),i=s.ui_state.id,d=[];s.item.text&&d.push(h([s],r)),t.forEach(e=>{const t=(0,c.K)(e),n=(0,a.i)(t,t.input.text,e.id);d.push(h([n],t)),this.uploadingFiles.add(e.id)}),this.serviceManager.store.dispatch((0,a.u)(this.uploadingFiles.size>0)),await f(d,0,0,!this.isSuspended(),n);let g=!1,p=!1;setTimeout(()=>{g||p||this.setMessageErrorState(s.fullMessageID,o.M.RETRYING)},3e3),setTimeout(()=>{g||this.setMessageErrorState(s.fullMessageID,o.M.FAILED)},2e4);const _={filesToUpload:t};try{await this.serviceDesk.sendMessageToAgent(r,i,_),g=!0,this.setMessageErrorState(s.fullMessageID,o.M.NONE),await n.fire({type:E.B.HUMAN_AGENT_SEND,data:r,files:t})}catch(e){p=!0,(0,u.b)("[sendMessageToAgent] An error with the service desk occurred.",e),this.setMessageErrorState(s.fullMessageID,o.M.FAILED)}}filesSelectedForUpload(e){if(this.serviceDesk&&this.chatStarted)try{this.serviceDesk.filesSelectedForUpload?.(e)}catch(e){(0,u.b)("[userReadMessages] An error with the service desk occurred.",e)}}async userReadMessages(){if(this.serviceDesk&&this.chatStarted)try{await this.serviceDesk.userReadMessages()}catch(e){(0,u.b)("[userReadMessages] An error with the service desk occurred.",e)}}async checkAreAnyHumanAgentsOnline(e){let t;const n=this.serviceManager.restartCount;if(this.serviceDesk?.areAnyAgentsOnline)try{const n=this.serviceManager.store.getState().config.public.serviceDesk?.availabilityTimeoutSeconds,r=n?1e3*n:5e3,s=await(0,u.r)(this.serviceDesk.areAnyAgentsOnline(e),r);t=!0===s?o.H.ONLINE:!1===s?o.H.OFFLINE:o.H.UNKNOWN}catch(e){(0,u.b)("Error attempting to get agent availability",e),t=o.H.OFFLINE}else t=o.H.UNKNOWN;return n===this.serviceManager.restartCount&&this.serviceManager.fire({type:E.B.HUMAN_AGENT_ARE_ANY_AGENTS_ONLINE,areAnyAgentsOnline:t}),t}async userTyping(e){if(this.serviceDesk&&this.chatStarted)try{await(this.serviceDesk.userTyping?.(e))}catch(e){(0,u.b)("[userTyping] An error with the service desk occurred.",e)}}setMessageErrorState(e,t){this.serviceManager.store.dispatch(i.a.setMessageErrorState(e,t))}async handleHumanAgentJoinedTimeout(){const e=this.serviceManager.store.getState().languagePack.errors_noHumanAgentsJoined,{originalMessage:t,localMessage:n}=(0,a.b)(e);await f([h([n],t)],0,0,!this.isSuspended(),this.serviceManager),this.endChat(!1)}cancelHumanAgentJoinedTimer(){this.waitingForHumanAgentJoinedTimer&&(clearTimeout(this.waitingForHumanAgentJoinedTimer),this.waitingForHumanAgentJoinedTimer=null)}async screenShareUpdateRequestState(e){if(!this.persistedHumanAgentState().isConnected)return;let t;switch(this.closeScreenShareRequestModal(e),e){case o.S.ACCEPTED:t=O;break;case o.S.DECLINED:t=R;break;case o.S.CANCELLED:t=H;break;case o.S.ENDED:t=L;break;default:return}await this.addHumanAgentLocalMessage(t)}async screenShareStop(){this.serviceManager.store.dispatch((0,a.w)(!1)),await this.addHumanAgentLocalMessage(L),await(this.serviceDesk?.screenShareStop?.())}async handleHydration(e,t){const{store:n}=this.serviceManager;let r=!1;const{isConnected:s}=this.persistedHumanAgentState();if(s){if(this.chatStarted=!0,e&&this.serviceDesk?.reconnect)try{n.dispatch((0,a.x)(!0)),setTimeout(this.serviceManager.appWindow.requestFocus),r=await this.serviceDesk.reconnect()}catch(e){(0,u.b)("Error while trying to reconnect to an agent.",e)}if(n.dispatch((0,a.x)(!1)),!this.persistedHumanAgentState().isConnected)return void(this.chatStarted=!1);if(setTimeout(this.serviceManager.appWindow.requestFocus),r)this.showLeaveWarning=!1;else{this.chatStarted=!1;const e=this.isSuspended();if(n.dispatch((0,a.v)()),t){const{responseUserProfile:t}=this.persistedHumanAgentState();await A(g.H.CHAT_WAS_ENDED,t,!1,e,this.serviceManager),await l(0,e,this.serviceManager)}}}}closeScreenShareRequestModal(e){this.serviceManager.store.dispatch((0,a.y)(!1)),this.screenShareRequestPromise&&(this.screenShareRequestPromise.doResolve(e),this.screenShareRequestPromise=null),this.serviceManager.store.dispatch((0,a.w)(e===o.S.ACCEPTED))}async addHumanAgentLocalMessage(e,t,n=!0,r=!0){t||(t=this.persistedHumanAgentState().responseUserProfile);const{localMessage:s,originalMessage:a}=await p(e,this.serviceManager,t,n);await f([h([s],a)],0,0,!this.isSuspended(),this.serviceManager)}persistedHumanAgentState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.humanAgentState}isSuspended(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.humanAgentState.isSuspended}}class U{constructor(e,t){this.serviceManager=e,this.service=t}updateCapabilities(e){this.serviceManager.store.dispatch((0,a.z)((0,r.A)(e)))}async updateAgentAvailability(e){this.service.chatStarted&&this.serviceManager.store.dispatch((0,a.A)(e))}async agentJoined(e){this.service.chatStarted&&(this.service.cancelHumanAgentJoinedTimer(),this.serviceManager.store.dispatch((0,a.B)(e)),await this.service.addHumanAgentLocalMessage(m,e),this.service.showLeaveWarning&&(await this.service.addHumanAgentLocalMessage(v,null,!1,!1),this.service.showLeaveWarning=!1))}async agentReadMessages(){this.service.chatStarted&&(0,u.e)("[ServiceDeskCallbackImpl] agentReadMessages")}async agentTyping(e){this.persistedHumanAgentState().isConnected&&e!==this.service.isHumanAgentTyping&&(this.serviceManager.store.dispatch((0,a.C)(e)),this.service.isHumanAgentTyping=e)}async sendMessageToUser(e,t){if(!this.service.chatStarted||!e)return;const n="string"==typeof e?(0,c.m)(e):e;(0,c.l)(n),n.output?.generic?.length&&n.output.generic.forEach(e=>{e.agent_message_type||(e.agent_message_type=g.H.FROM_HUMAN_AGENT)});const{serviceManager:r}=this;let s;void 0===t?s=this.persistedHumanAgentState().responseUserProfile:(s=this.persistedHumanAgentState().responseUserProfiles[t],s||(s=this.persistedHumanAgentState().responseUserProfile,s&&(0,u.b)(`Got agent ID ${t} but no agent with that ID joined the conversation. Using the current agent instead.`))),await r.fire({type:E.B.HUMAN_AGENT_PRE_RECEIVE,data:n,responseUserProfile:s}),n.history.response_user_profile=s;const i=n.output.generic.map(e=>(0,a.o)(e,n));await f([h(i,n)],0,0,!this.service.isSuspended(),this.serviceManager),await r.fire({type:E.B.HUMAN_AGENT_RECEIVE,data:n,responseUserProfile:s})}async beginTransferToAnotherAgent(e){this.service.chatStarted&&(e&&this.serviceManager.store.dispatch((0,a.B)(e)),await this.service.addHumanAgentLocalMessage(D,e))}async agentLeftChat(){this.service.chatStarted&&(await this.service.addHumanAgentLocalMessage(C),this.service.isHumanAgentTyping=!1,this.serviceManager.store.dispatch((0,a.D)()))}async agentEndedChat(){if(!this.service.chatStarted)return;const e=await this.service.firePreEndChat(!0);e.cancelEndChat||await this.service.doEndChat(!0,e.preEndChatPayload,!0,!0,N)}async setErrorStatus(e){if(!this.service.chatStarted)return;const{type:t,logInfo:n}=e,{store:r}=this.serviceManager,{isConnecting:s}=r.getState().humanAgentState;switch(n&&(0,u.b)(`An error occurred in the service desk (type=${t})`,n),s&&e.type===o.E.DISCONNECTED&&e.isDisconnected&&(e={type:o.E.CONNECTING}),e.type){case o.E.DISCONNECTED:e.isDisconnected?(this.service.showingDisconnectedError=!0,await this.service.addHumanAgentLocalMessage(y,null,!0,!1),r.dispatch(i.a.updateInputState({isReadonly:!0},!0))):this.service.showingDisconnectedError&&(this.service.showingDisconnectedError=!1,await this.service.addHumanAgentLocalMessage(T,null,!0,!1),r.dispatch(i.a.updateInputState({isReadonly:!1},!0)));break;case o.E.CONNECTING:{const{languagePack:t}=this.serviceManager.store.getState(),n=e.messageToUser||t.errors_connectingToHumanAgent,{originalMessage:r,localMessage:i}=(0,a.b)(n);await f([h([i],r)],0,0,!this.service.isSuspended(),this.serviceManager),this.serviceManager.store.dispatch((0,a.t)(!1,null)),this.service.chatStarted=!1,this.service.cancelHumanAgentJoinedTimer(),await this.service.fireEndChat(!1,s);break}case o.E.USER_MESSAGE:this.service.setMessageErrorState(e.messageID,o.M.FAILED)}}async setFileUploadStatus(e,t,n){const{store:r}=this.serviceManager;if(r.getState().allMessagesByID[e])if(g.F.COMPLETE,t){if(r.dispatch(i.a.setMessageHistoryProperty(e,"file_upload_status",g.F.COMPLETE)),r.dispatch(i.a.setMessageHistoryProperty(e,"error_state",o.M.FAILED)),o.M.FAILED,n){const{originalMessage:e,localMessage:t}=(0,a.b)(n);t.item.agent_message_type=g.H.INLINE_ERROR,await f([h([t],e)],0,0,!this.service.isSuspended(),this.serviceManager)}}else r.dispatch(i.a.setMessageHistoryProperty(e,"file_upload_status",g.F.SUCCESS)),r.dispatch(i.a.announceMessage({messageID:"fileSharing_ariaAnnounceSuccess"}));else t&&r.dispatch(i.a.fileUploadInputError(e,n,!0));this.service.uploadingFiles.delete(e),this.serviceManager.store.dispatch((0,a.u)(this.service.uploadingFiles.size>0))}async screenShareRequest(){return this.persistedHumanAgentState().isConnected?(this.service.screenShareRequestPromise||(this.service.screenShareRequestPromise=(0,a.r)(),this.serviceManager.store.dispatch((0,a.y)(!0)),await this.service.addHumanAgentLocalMessage(w)),this.service.screenShareRequestPromise):Promise.reject(new Error("Cannot request screen sharing if no chat is in progress."))}async screenShareEnded(){const e=this.serviceManager.store.getState().humanAgentState.isScreenSharing,t=this.service.screenShareRequestPromise;this.service.closeScreenShareRequestModal(o.S.CANCELLED),e?(this.serviceManager.store.dispatch((0,a.w)(!1)),await this.service.addHumanAgentLocalMessage(L)):t&&await this.service.addHumanAgentLocalMessage(H)}persistedHumanAgentState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.humanAgentState}persistedState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.humanAgentState.serviceDeskState}updatePersistedState(e,t=!0){const{store:n}=this.serviceManager;let i;i=t?(0,s.A)({},n.getState().persistedToBrowserStorage.chatState.humanAgentState.serviceDeskState,e):(0,r.A)(e),n.dispatch((0,a.E)((0,a.d)(i)))}}function b(e){return new P(e)}function G(e){if(e)if("object"!=typeof e)(0,u.b)(`The custom service desk does not appear to be valid. The type should be "object" but is "${typeof e}"`,e);else{["startChat","endChat","sendMessageToAgent"].forEach(t=>{const n=e[t];"function"!=typeof n&&(0,u.b)(`The custom service desk does not appear to be valid. The type of property "${t}"should be "function" but is "${typeof n}"`,n,e)});const t=e.getName?.();if(!t)throw Error("The custom service desk does not have a name.");if(t&&("string"!=typeof t||t.length>40))throw new Error(`The custom service desk name "${t}" is not valid.`)}else(0,u.b)("The custom service desk does not appear to be valid. No service desk was provided.",e)}}}]);
//# sourceMappingURL=2093.bundle.js.map