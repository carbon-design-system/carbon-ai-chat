/*! For license information please see 2093.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_carbon_ai_chat_examples_demo=self.webpackChunk_carbon_ai_chat_examples_demo||[]).push([[2093],{171:function(e,t,n){n.d(t,{U:function(){return r},u:function(){return i}});var r,s=n(5745);function i(e){return(0,s.A)()}!function(e){e[e.MISCELLANEOUS=1]="MISCELLANEOUS",e[e.LOCAL_MESSAGE=2]="LOCAL_MESSAGE",e[e.MESSAGE=3]="MESSAGE",e[e.COMPONENT=4]="COMPONENT",e[e.USER=6]="USER",e[e.DEVICE_ID=8]="DEVICE_ID",e[e.FILE=9]="FILE"}(r||(r={}))},307:function(e,t,n){n.d(t,{A:function(){return h},B:function(){return l},C:function(){return K},D:function(){return I},E:function(){return N},F:function(){return v},G:function(){return q},H:function(){return S},I:function(){return k},J:function(){return R},K:function(){return C},L:function(){return J},M:function(){return w},N:function(){return P},O:function(){return V},P:function(){return b},Q:function(){return L},T:function(){return E},a:function(){return f},b:function(){return g},c:function(){return y},d:function(){return x},e:function(){return W},f:function(){return d},g:function(){return X},h:function(){return M},i:function(){return O},j:function(){return _},k:function(){return D},l:function(){return p},m:function(){return m},n:function(){return j},o:function(){return Y},p:function(){return z},q:function(){return U},r:function(){return H},s:function(){return c},t:function(){return $},u:function(){return T},v:function(){return F},w:function(){return B},x:function(){return A},y:function(){return o},z:function(){return u}});var r=n(8690),s=n(171),i=n(5564),a=n(1536);function o(e){return Array.isArray(e)?e:[e]}async function c(e,t){for(let n=0;n<e.length;n++){const r=e[n];await t(r,n,e)}}function u(e,t,n){const r=function(e,t){if(e)for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}(e,t);return-1===r?void 0:e[r]}function d(e){return e&&e.length?e[e.length-1]:null}const E="main";function g(e){return e&&void 0!==e.output}function h(e){return e?.item.response_type===i.b.DATE}function p(e){return e.id||(e.id=(0,s.u)(s.U.MESSAGE)),e.thread_id||(e.thread_id=E),e.history||(e.history={}),e.history.timestamp||(e.history.timestamp=Date.now()),void 0===e.history.from_history&&(e.history.from_history=!1),e}function f(e){return void 0!==e?.input}function _(e){return Boolean(e.item.agent_message_type)}function l(e){return e?.input?.message_type===i.M.EVENT}function S(e){return e&&"text"===e.response_type&&void 0!==e.text}function A(e){return e.response_type===i.b.PAUSE&&1==e.typing}function T(e){return e.response_type===i.b.PAUSE}function y(e){return e?.response_type===i.b.OPTION&&void 0!==e.options}function I(e,t){const n={id:(0,s.u)(s.U.MESSAGE),thread_id:E,...(0,r.A)(e.value)};return n.history={label:e.label,related_message_id:t},n}function N(e,t){const n={id:(0,s.u)(s.U.MESSAGE),thread_id:E,input:null};return e.value?.input?.text?n.input=(0,r.A)(e.value.input):n.input={text:e.label},n.history={related_message_id:t},n}function M(){return p({id:(0,s.u)(s.U.MESSAGE),input:{text:""},history:{silent:!0,is_welcome_request:!0},thread_id:E})}function D(e){return p({input:{text:e,message_type:i.M.TEXT}})}function C(e){return p({id:e.id,input:{text:e.file.name,message_type:i.c.FILE,agent_message_type:i.A.FROM_USER},history:{file_upload_status:a.F.UPLOADING}})}function v(e,t,n){const r=D(e);return r.history={label:t,related_message_id:n},r}function m(e,t=E,n=i.b.TEXT,r){const a={response_type:n,text:e};return{id:(0,s.u)(s.U.MESSAGE),thread_id:t,output:{generic:[a]}}}function R(e,t){return p({output:{generic:[e]}})}function O(e){return e?.response_type===i.b.CONNECT_TO_AGENT}function b(e){return e?.response_type===i.b.CARD}function w(e){return e?.response_type===i.b.CAROUSEL}function L(e){return e?.response_type===i.b.BUTTON}function P(e){return L(e)&&e.button_type===i.a.SHOW_PANEL}function U(e){return L(e)?G(e.panel):b(e)?G(e):w(e)?void 0!==e.items:J(e)}function G(e){return void 0!==e?.body||void 0!==e?.footer}function H(e){switch(e.response_type){case i.b.TEXT:case i.b.IMAGE:case i.b.OPTION:case i.b.CONNECT_TO_AGENT:case i.b.IFRAME:case i.b.VIDEO:case i.b.AUDIO:case i.b.DATE:case i.b.CONVERSATIONAL_SEARCH:case i.b.TABLE:case i.b.INLINE_ERROR:case i.b.CARD:case i.b.CAROUSEL:case i.b.BUTTON:case i.b.GRID:return!1;default:return!k(e)}}function k(e){return F(e)}function F(e){return"IBM_BETA_JOURNEYS_TOUR"===e?.user_defined?.user_defined_type}function B(e){return Boolean(e.public.serviceDeskFactory)}function V(e){switch(e.response_type){case i.b.IMAGE:case i.b.IFRAME:case i.b.VIDEO:case i.b.AUDIO:case i.b.TEXT:case i.b.USER_DEFINED:case i.b.CARD:case i.b.GRID:return!0;default:return!1}}function W(e){return w(e)&&1===e.items.length}function x(e){return t=e,t?.response_type===i.b.USER_DEFINED&&e.full_width;var t}function J(e){return e?.response_type===i.b.GRID}function q(e,t){let n="button";return e&&"button"===e?n="button":(e&&"dropdown"===e||t>4)&&(n="dropdown"),n}function Y(e){return Boolean(e.partial_item)}function j(e){return Boolean(e.complete_item)}function z(e){return Boolean(e.final_response)}function $(e,t){const n=t?.streaming_metadata?.id;return n?`${e}-${n}`:null}function X(e){return e.dimensions}function K(e){return function(e,t,n){for(let r=e.length-1;r>=0;r--){const s=t[e[r]];if(n(s))return s}}(e.botMessageState.messageIDs||[],e.allMessagesByID,e=>g(e)&&!function(e){return g(e)&&Boolean(e.output.generic?.find(e=>e?.agent_message_type))||f(e)&&Boolean(e.input.agent_message_type)}(e)&&Boolean(e.context))}},481:function(e,t,n){n.d(t,{I:function(){return d},a:function(){return h},b:function(){return E},c:function(){return u},d:function(){return g},e:function(){return f},g:function(){return p}});var r=n(4880),s=n(711);const i="undefined"!=typeof window&&"undefined"!=typeof navigator,a=i?(0,r.o0)():void 0;let o=0,c=0;i&&(o=window.screen.width,c=window.screen.height);const u="iOS"===a?.os,d=u||"Android OS"===a?.os,E=d&&(o<500||c<500),g=E&&o<500,h=(0,s.A)(function(){if(!i||!window.sessionStorage)return!1;try{return window.sessionStorage.setItem("web-chat-test-item","true"),window.sessionStorage.getItem("web-chat-test-item"),window.sessionStorage.removeItem("web-chat-test-item"),!0}catch{return!1}});function p(e){try{return new URL(e).hostname}catch{return e}}function f(e,t){return t?setTimeout(e,t):(e(),null)}},1400:function(e,t,n){n.d(t,{A:function(){return O},B:function(){return b},C:function(){return k},D:function(){return m},E:function(){return G},H:function(){return S},a:function(){return H},b:function(){return u},c:function(){return d},d:function(){return F},e:function(){return T},f:function(){return I},g:function(){return A},h:function(){return l},i:function(){return o},j:function(){return D},k:function(){return M},l:function(){return N},m:function(){return _},n:function(){return y},o:function(){return c},p:function(){return h},q:function(){return f},r:function(){return B},s:function(){return p},t:function(){return C},u:function(){return L},v:function(){return R},w:function(){return U},x:function(){return v},y:function(){return P},z:function(){return w}});var r=n(5564),s=n(171),i=n(307),a=n(4859);function o(e,t,n=(0,s.u)(s.U.LOCAL_MESSAGE)){return{item:{response_type:r.b.TEXT,...e.input},ui_state:{id:n,originalUserText:t,needsAnnouncement:!1},fullMessageID:e.id}}function c(e,t,n=!1,r=!1){const a={ui_state:{id:(0,i.t)(t.id,e)||(0,s.u)(s.U.LOCAL_MESSAGE),needsAnnouncement:!t.history.from_history,disableFadeAnimation:r},item:e,fullMessageID:t.id};return n&&(a.ui_state.isWelcomeResponse=!0),a}function u(e){return function(e){const t=(0,i.J)(e);return{originalMessage:t,localMessage:c(e,t)}}({response_type:r.b.INLINE_ERROR,text:e})}function d(e,t,n,r,s){const{item:a}=e;if((0,i.L)(a))e.ui_state.gridLocalMessageItemIDs=a.rows.map(s=>s.cells.map(s=>{const i=[];return E("items",e,s.items,i,t,n,r,t=>g(e.item,t),!1),i}));else if((0,i.M)(a))e.ui_state.itemsLocalMessageItemIDs=[],E("items",e,a.items,e.ui_state.itemsLocalMessageItemIDs,t,n,r,e=>g(a,e),s);else{const o=a.body||a.panel?.body;if(o&&(e.ui_state.bodyLocalMessageItemIDs=[],E("body",e,o,e.ui_state.bodyLocalMessageItemIDs,t,n,r,e=>g(a,e),!(0,i.N)(a))),!s)return;const c=a.footer||a.panel?.footer;c&&(e.ui_state.footerLocalMessageItemIDs=[],E("footer",e,c,e.ui_state.footerLocalMessageItemIDs,t,n,r,e=>function(e,t){return!!(0,i.Q)(t)&&(!(0,i.N)(e)||!(0,i.N)(t))}(a,e),!(0,i.N)(a)))}}function E(e,t,n,r,s,o,u,E,g){n.forEach(n=>{if(E(n)){const e=c(n,s,!1,!0);r.push(e.ui_state.id),u.push(e),(0,i.q)(e.item)&&d(e,s,o,u,g)}else(0,a.b)(`The "${t.item.response_type}" response type does not support "${n.response_type}" in "${e}" array.`)})}function g(e,t){switch(e.response_type){case r.b.CARD:return!(0,i.P)(t)&&(0,i.O)(t);case r.b.CAROUSEL:return(0,i.P)(t);case r.b.BUTTON:return e.button_type===r.a.SHOW_PANEL&&(0,i.O)(t);case r.b.GRID:return!(0,i.P)(t)&&(0,i.O)(t);default:return!1}}const h="HA_SET_AGENT_AVAILABILITY",p="HA_SET_IS_CONNECTING",f="HA_SET_IS_RECONNECTING",_="HA_SET_AGENT_JOINED",l="HA_SET_AGENT_LEFT_CHAT",S="HA_END_CHAT",A="HA_UPDATE_CAPABILITIES",T="HA_UPDATE_FILE_UPLOAD_IN_PROGRESS",y="HA_SET_SHOW_SCREEN_SHARE_REQUEST",I="HA_SET_IS_SCREEN_SHARING",N="HA_SET_PERSISTED_STATE",M="HA_UPDATE_IS_SUSPENDED",D="HA_UPDATE_IS_TYPING";function C(e,t){return{type:p,isConnecting:e,localMessageID:t}}function v(e){return{type:f,isReconnecting:e}}function m(){return{type:l}}function R(){return{type:S}}function O(e){return{type:h,availability:e}}function b(e){return{type:_,agentProfile:e}}function w(e){return{type:A,capabilities:e}}function L(e){return{type:T,fileUploadInProgress:e}}function P(e){return{type:y,showRequest:e}}function U(e){return{type:I,isSharing:e}}function G(e){return{type:N,state:e}}function H(e){return{type:M,isSuspended:e}}function k(e){return{type:D,isTyping:e}}function F(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(t=>{!Object.prototype.hasOwnProperty.call(e,t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||F(e[t])}),e}function B(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});return n.doResolve=t=>{n.isResolved=!0,n.isComplete=!0,e(t)},n.doReject=e=>{n.isRejected=!0,n.isComplete=!0,t(e)},n.isResolved=!1,n.isRejected=!1,n.isComplete=!1,n}},1517:function(e,t,n){n.d(t,{$:function(){return U},A:function(){return ne},B:function(){return v},C:function(){return Q},D:function(){return C},E:function(){return B},F:function(){return te},G:function(){return F},H:function(){return b},I:function(){return m},J:function(){return M},K:function(){return N},L:function(){return L},M:function(){return D},N:function(){return y},O:function(){return J},P:function(){return c},Q:function(){return o},R:function(){return ue},S:function(){return fe},T:function(){return z},U:function(){return _e},V:function(){return a},W:function(){return i},X:function(){return T},Y:function(){return A},Z:function(){return S},_:function(){return P},a:function(){return le},a0:function(){return p},a1:function(){return l},a2:function(){return _},a3:function(){return f},a4:function(){return I},a5:function(){return w},a6:function(){return V},a7:function(){return h},a8:function(){return g},a9:function(){return E},aa:function(){return d},ab:function(){return O},ac:function(){return u},ad:function(){return s},b:function(){return pe},c:function(){return he},d:function(){return ge},e:function(){return Ee},f:function(){return ie},g:function(){return oe},h:function(){return ae},i:function(){return se},j:function(){return re},k:function(){return de},l:function(){return ce},m:function(){return ee},n:function(){return Z},o:function(){return K},p:function(){return X},q:function(){return $},r:function(){return k},s:function(){return H},t:function(){return G},u:function(){return Y},v:function(){return j},w:function(){return q},x:function(){return x},y:function(){return W},z:function(){return R}});var r=n(171);const s="CHANGE_STATE",i="UPDATE_BOT_NAME",a="UPDATE_BOT_AVATAR_URL",o="UPDATE_LAUNCHER_AVATAR_URL",c="UPDATE_MAIN_HEADER_TITLE",u="HYDRATE_CHAT",d="HYDRATE_MESSAGE_HISTORY",E="ADD_LOCAL_MESSAGE_ITEM",g="REMOVE_MESSAGES",h="UPDATE_LOCAL_MESSAGE_ITEM",p="SET_APP_STATE_VALUE",f="ADD_IS_TYPING_COUNTER",_="ADD_IS_LOADING_COUNTER",l="ADD_IS_HYDRATING_COUNTER",S="SET_VIEW_STATE",A="SET_VIEW_CHANGING",T="SET_INITIAL_VIEW_CHANGE_COMPLETE",y="UPDATE_CSS_VARIABLES",I="MESSAGE_SET_OPTION_SELECTED",N="SET_MESSAGE_UI_PROPERTY",M="SET_MESSAGE_HISTORY_PROPERTY",D="MERGE_HISTORY",C="SET_LAUNCHER_PROPERTY",v="SET_LAUNCHER_CONFIG_PROPERTY",m="ANNOUNCE_MESSAGE",R="SET_CHAT_MESSAGES_PROPERTY",O="RESTART_CONVERSATION",b="ACCEPTED_DISCLAIMER",w="ADD_MESSAGE",L="UPDATE_HOME_SCREEN_CONFIG",P="UPDATE_HAS_SENT_NON_WELCOME_MESSAGE",U="UPDATE_PERSISTED_CHAT_STATE",G="SET_TOUR_DATA",H="CLEAR_TOUR_DATA",k="CHANGE_STEP_IN_TOUR",F="SET_HOME_SCREEN_IS_OPEN",B="UPDATE_LAUNCHER_CONFIG",V="UPDATE_MESSAGE",W="SET_LAUNCHER_MINIMIZED",x="CLOSE_IFRAME_PANEL",J="OPEN_IFRAME_CONTENT",q="SET_CONVERSATIONAL_SEARCH_CITATION_PANEL_IS_OPEN",Y="SET_CUSTOM_PANEL_OPTIONS",j="SET_CUSTOM_PANEL_OPEN",z="GO_BACK_TO_HOME",$="UPDATE_INPUT_STATE",X="SET_IS_PAGE_VISIBLE",K="ADD_INPUT_FILE",Q="CLEAR_INPUT_FILES",Z="REMOVE_INPUT_FILE",ee="REMOVE_LOCAL_MESSAGE_ITEM",te="FILE_UPLOAD_INPUT_ERROR",ne="ADD_NESTED_MESSAGES",re="SET_RESPONSE_PANEL_IS_OPEN",se="SET_PANEL_RESPONSE_CONTENT",ie="STREAMING_ADD_CHUNK",ae="STREAMING_START",oe="STREAMING_MERGE_HISTORY",ce="ADD_NOTIFICATION",ue="REMOVE_ALL_NOTIFICATIONS",de="REMOVE_NOTIFICATIONS",Ee="UPDATE_CHAT_HEADER_CONFIG",ge="UPDATE_MAX_VISIBLE_HEADER_OBJECTS",he="SET_STOP_STREAMING_BUTTON_VISIBLE",pe="SET_STOP_STREAMING_BUTTON_DISABLED",fe="SET_STREAM_ID",_e="UPDATE_MAIN_HEADER_AVATAR",le={changeState(e){return{type:s,partialState:e}},chatWasHydrated(){return{type:u}},hydrateMessageHistory(e){return{type:d,messageHistory:e}},removeMessages(e){return{type:g,messageIDs:e}},restartConversation(){return{type:O}},addLocalMessageItem(e,t,n,r){return{type:E,messageItem:e,message:t,addMessage:n,addAfterID:r}},addMessage(e){return{type:w,message:e}},updateLocalMessageItem(e){return{type:h,messageItem:e}},updateMessage(e){return{type:V,message:e}},messageSetOptionSelected(e,t){return{type:I,messageID:e,sentMessage:t}},updatePersistedChatState(e){return{type:U,chatState:e}},setTourData(e){return{type:G,newActiveTourMessageID:e}},clearTourData(){return{type:H}},changeStepInTour(e){return{type:k,newStepNumber:e}},updateHasSentNonWelcomeMessage(e){return{type:P,hasSentNonWelcomeMessage:e}},setAppStateValue(e,t){return{type:p,key:e,value:t}},addIsTypingCounter(e){return{type:f,addToIsTyping:e}},addIsLoadingCounter(e){return{type:_,addToIsLoading:e}},addIsHydratingCounter(e){return{type:l,addToIsHydrating:e}},updateBotName(e){return{type:i,name:e}},updateMainHeaderTitle(e){return{type:c,title:e}},updateBotAvatarURL(e){return{type:a,url:e}},updateCSSVariables(e,t,n){return{type:y,variables:e,publicVars:t,whiteLabelVariables:n}},updateHomeScreenConfig(e){return{type:L,homeScreenConfig:e}},setViewState(e){return{type:S,viewState:e}},setViewChanging(e){return{type:A,viewChanging:e}},setInitialViewChangeComplete(e){return{type:T,changeComplete:e}},setMessageUIProperty(e,t,n){return{type:N,localMessageID:e,propertyName:t,propertyValue:n}},setLauncherProperty(e,t){return{type:C,propertyName:e,propertyValue:t}},setLauncherConfigProperty(e,t,n){return{type:v,propertyName:e,propertyValue:t,launcherType:n}},setMessageHistoryProperty(e,t,n){return{type:M,messageID:e,propertyName:t,propertyValue:n}},mergeMessageHistory(e,t){return{type:D,messageID:e,history:t}},setMessageErrorState(e,t){return le.setMessageHistoryProperty(e,"error_state",t)},setMessageWasAnnounced(e){return le.setMessageUIProperty(e,"needsAnnouncement",!1)},announceMessage(e){return{type:m,message:e}},setChatMessagesStateProperty(e,t){return{type:R,propertyName:e,propertyValue:t}},addNotification(e){const t=(0,r.u)();return{type:ce,notificationID:t,notification:e}},removeNotifications({groupID:e,notificationID:t}){return{type:de,groupID:e,notificationID:t}},removeAllNotifications(){return{type:ue}},acceptDisclaimer(){return{type:b}},setHomeScreenIsOpen(e){return{type:F,isOpen:e}},updateLauncherConfig(e){return{type:B,launcherConfig:e}},setLauncherMinimized(){return{type:W}},closeIFramePanel(){return{type:x}},setIFrameContent(e){return{type:J,messageItem:e}},setViewSourcePanelIsOpen(e,t,n){return{type:q,isOpen:e,citationItem:t,relatedSearchResult:n}},setCustomPanelConfigOptions(e){return{type:Y,options:e}},setCustomPanelOpen(e){return{type:j,isOpen:e}},toggleHomeScreen(){return{type:z}},updateInputState(e,t){return{type:$,newState:e,isInputToAgent:t}},setIsBrowserPageVisible(e){return{type:X,isVisible:e}},addInputFile(e,t){return{type:K,file:e,isInputToAgent:t}},removeFileUpload(e,t){return{type:Z,fileID:e,isInputToAgent:t}},removeLocalMessageItem(e){return{type:ee,localMessageItemID:e}},fileUploadInputError(e,t,n){return{type:te,fileID:e,errorMessage:t,isInputToAgent:n}},clearInputFiles(e){return{type:Q,isInputToAgent:e}},addNestedMessages(e){return{type:ne,localMessageItems:e}},setResponsePanelIsOpen(e){return{type:re,isOpen:e}},setResponsePanelContent(e,t=!1){return{type:se,localMessageItem:e,isMessageForInput:t}},streamingStart(e){return{type:ae,messageID:e}},streamingMergeHistory(e,t){return{type:oe,messageID:e,history:t}},streamingAddChunk(e,t,n,r){return{type:ie,fullMessageID:e,chunkItem:t,isCompleteItem:n,disableFadeAnimation:r}},updateChatHeaderConfig(e){return{type:Ee,chatHeaderConfig:e}},setMaxVisibleHeaderObjects(e){return{type:ge,maxTotal:e}},setStopStreamingButtonVisible(e){return{type:he,isVisible:e}},setStopStreamingButtonDisabled(e){return{type:pe,isDisabled:e}},setStreamID(e){return{type:fe,currentStreamID:e}},updateMainHeaderAvatar(e){return{type:_e,config:e}}}},2093:function(e,t,n){n.r(t),n.d(t,{HumanAgentServiceImpl:function(){return P},createService:function(){return G},default:function(){return G},validateCustomServiceDesk:function(){return H}});var r=n(8690),s=n(1122),i=n(1400),a=n(1517),o=n(5569),c=n(4859),u=n(307),d=n(1536),E=n(481),g=n(5564);function h(e,t){return{localMessages:e,originalMessage:t}}async function p(e,t,n,r=!0){const s=function(e,t,n){const r=t?.nickname;let s;switch(e){case g.A.AGENT_JOINED:s=r?"agent_agentJoinedName":"agent_agentJoinedNoName";break;case g.A.RELOAD_WARNING:s="agent_youConnectedWarning";break;case g.A.AGENT_LEFT_CHAT:s=r?"agent_agentLeftChat":"agent_agentLeftChatNoName";break;case g.A.AGENT_ENDED_CHAT:s=r?"agent_agentEndedChat":"agent_agentEndedChatNoName";break;case g.A.TRANSFER_TO_AGENT:s=r?"agent_transferring":"agent_transferringNoName";break;case g.A.USER_ENDED_CHAT:s="agent_youEndedChat";break;case g.A.CHAT_WAS_ENDED:s="agent_conversationWasEnded";break;case g.A.DISCONNECTED:s="agent_disconnected";break;case g.A.RECONNECTED:s="agent_reconnected";break;case g.A.SHARING_REQUESTED:s="agent_sharingRequested";break;case g.A.SHARING_ACCEPTED:s="agent_sharingAccepted";break;case g.A.SHARING_DECLINED:s="agent_sharingDeclined";break;case g.A.SHARING_CANCELLED:s="agent_sharingCancelled";break;case g.A.SHARING_ENDED:s="agent_sharingEnded";break;default:return""}return s&&n.formatMessage({id:s},{personName:r})}(e,n,t.intl),a=f(e),{originalMessage:o,localMessage:c}=a;return c.item.text=s,n&&(o.history||(o.history={}),o.history.agent_profile=n),r&&await t.fire({type:d.B.AGENT_PRE_RECEIVE,data:o}),(0,i.d)(o),r&&await t.fire({type:d.B.AGENT_RECEIVE,data:o}),a}function f(e){const t={response_type:g.b.TEXT,agent_message_type:e},n=(0,u.J)(t);return{localMessage:(0,i.o)(t,n),originalMessage:n}}async function _(e,t,n,r,s){r&&await(0,u.s)(e,async({localMessages:e,originalMessage:t})=>{await(0,u.s)(e,async(e,n)=>{await s.actions.handleUserDefinedResponseItems(e,t),s.store.dispatch(a.a.addLocalMessageItem(e,t,0===n))})})}async function l(e,t,n){const r=function(e){const{agent_botReturned:t}=e;if(!t)return null;const{originalMessage:n,localMessage:r}=f(null);return r.item.text=t,{originalMessage:n,localMessage:r}}(n.store.getState().languagePack);if(r){const s=n.restartCount;(0,E.e)(()=>{s===n.restartCount&&_([h([r.localMessage],r.originalMessage)],0,0,!t,n)},e)}}async function S(e,t,n,r,s){const i=await p(e,s,t,n);await _([h([i.localMessage],i.originalMessage)],0,0,!r,s)}n(3696);const{FROM_USER:A,RECONNECTED:T,DISCONNECTED:y,AGENT_ENDED_CHAT:I,AGENT_JOINED:N,USER_ENDED_CHAT:M,CHAT_WAS_ENDED:D,TRANSFER_TO_AGENT:C,AGENT_LEFT_CHAT:v,RELOAD_WARNING:m,SHARING_CANCELLED:R,SHARING_DECLINED:O,SHARING_ACCEPTED:b,SHARING_REQUESTED:w,SHARING_ENDED:L}=g.A;class P{constructor(e){this.chatStarted=!1,this.showingDisconnectedError=!1,this.isAgentTyping=!1,this.uploadingFiles=new Set,this.showLeaveWarning=!0,this.serviceManager=e}getCustomServiceDeskName(){return this.serviceManager.store.getState().config.public.serviceDeskFactory?this.serviceDesk.getName?.():void 0}async initialize(){if(this.serviceDesk)throw new Error("A service desk has already been created!");const{store:e,instance:t}=this.serviceManager,n=e.getState(),{config:s,persistedToBrowserStorage:i}=n,a=(0,r.A)(i.chatState.agentState.serviceDeskState);if(this.serviceDeskCallback=new U(this.serviceManager,this),s.public.serviceDeskFactory){const e={callback:this.serviceDeskCallback,instance:t,persistedState:a};this.serviceDesk=await s.public.serviceDeskFactory(e),H(this.serviceDesk),(0,c.e)("Initializing a custom service desk")}this.showLeaveWarning=!this.serviceDesk?.reconnect}async startChat(e,t){if(!this.serviceDesk)throw new Error("A service desk has not been configured.");if(this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.isSuspended&&await this.endChat(!0,!0,!1),this.chatStarted)throw new Error("A chat is already running. A call to endChat must be made before a new chat can start.");const{serviceManager:n}=this;try{this.chatStarted=!0,this.isAgentTyping=!1,this.uploadingFiles.clear(),this.serviceManager.store.dispatch((0,i.u)(this.uploadingFiles.size>0));const r={type:d.B.AGENT_PRE_START_CHAT,message:t};if(await n.fire(r),r.cancelStartChat)return this.chatStarted=!1,await this.fireEndChat(!1,!0),void n.store.dispatch((0,i.t)(!1,null));const s=n.store.getState().config.public.serviceDesk?.agentJoinTimeoutSeconds;s&&(this.waitingForAgentJoinedTimer=setTimeout(()=>this.handleAgentJoinedTimeout(),1e3*s)),n.store.dispatch((0,i.t)(!0,e.ui_state.id)),await this.serviceDesk.startChat(t,{preStartChatPayload:r.preStartChatPayload})}catch(e){throw(0,c.b)("[startChat] An error with the service desk occurred.",e),this.serviceDeskCallback&&await this.serviceDeskCallback.setErrorStatus({type:o.E.CONNECTING,logInfo:e}),n.store.dispatch((0,i.t)(!1,null)),this.chatStarted=!1,this.cancelAgentJoinedTimer(),e}}async firePreEndChat(e){const t={type:d.B.AGENT_PRE_END_CHAT,endedByAgent:e,preEndChatPayload:null,cancelEndChat:!1};return await this.serviceManager.fire(t),t}async fireEndChat(e,t){await this.serviceManager.fire({type:d.B.AGENT_END_CHAT,endedByAgent:e,requestCancelled:t})}async endChat(e,t=!0,n=!0){if(!this.chatStarted||!this.serviceDesk)return;const{isConnected:r}=this.persistedAgentState();let s;if(r&&(s=await this.firePreEndChat(!1),s.cancelEndChat))return;const i=e?M:D;await this.doEndChat(!1,s?.preEndChatPayload,t,n,i)}async doEndChat(e,t,n,r,s){const{isConnected:a}=this.persistedAgentState(),u=this.isSuspended();this.cancelAgentJoinedTimer(),this.closeScreenShareRequestModal(o.S.CANCELLED);try{await(0,c.r)(this.serviceDesk.endChat({endedByAgent:e,preEndChatPayload:t}),5e3)}catch(e){(0,c.b)("[doEndChat] An error with the service desk occurred.",e)}if(a&&n){const{agentProfile:e}=this.persistedAgentState();await S(s,e,!0,u,this.serviceManager)}this.chatStarted=!1,this.isAgentTyping=!1,this.serviceManager.store.dispatch((0,i.v)()),await this.fireEndChat(e,!a),a&&r&&await l(1500,u,this.serviceManager)}async sendMessageToAgent(e,t){if(!this.serviceDesk||!this.chatStarted)return;const{serviceManager:n}=this;(0,i.d)(t);const r=(0,u.k)(e);r.input.agent_message_type=A,await n.fire({type:d.B.AGENT_PRE_SEND,data:r,files:t});const s=(0,i.i)(r,r.input.text),a=s.ui_state.id,E=[];s.item.text&&E.push(h([s],r)),t.forEach(e=>{const t=(0,u.K)(e),n=(0,i.i)(t,t.input.text,e.id);E.push(h([n],t)),this.uploadingFiles.add(e.id)}),this.serviceManager.store.dispatch((0,i.u)(this.uploadingFiles.size>0)),await _(E,0,0,!this.isSuspended(),n);let g=!1,p=!1;setTimeout(()=>{g||p||this.setMessageErrorState(s.fullMessageID,o.M.RETRYING)},3e3),setTimeout(()=>{g||this.setMessageErrorState(s.fullMessageID,o.M.FAILED)},2e4);const f={filesToUpload:t};try{await this.serviceDesk.sendMessageToAgent(r,a,f),g=!0,this.setMessageErrorState(s.fullMessageID,o.M.NONE),await n.fire({type:d.B.AGENT_SEND,data:r,files:t})}catch(e){p=!0,(0,c.b)("[sendMessageToAgent] An error with the service desk occurred.",e),this.setMessageErrorState(s.fullMessageID,o.M.FAILED)}}filesSelectedForUpload(e){if(this.serviceDesk&&this.chatStarted)try{this.serviceDesk.filesSelectedForUpload?.(e)}catch(e){(0,c.b)("[userReadMessages] An error with the service desk occurred.",e)}}async userReadMessages(){if(this.serviceDesk&&this.chatStarted)try{await this.serviceDesk.userReadMessages()}catch(e){(0,c.b)("[userReadMessages] An error with the service desk occurred.",e)}}async checkAreAnyAgentsOnline(e){let t;const n=this.serviceManager.restartCount;if(this.serviceDesk?.areAnyAgentsOnline)try{const n=this.serviceManager.store.getState().config.public.serviceDesk?.availabilityTimeoutSeconds,r=n?1e3*n:5e3,s=await(0,c.r)(this.serviceDesk.areAnyAgentsOnline(e),r);t=!0===s?o.A.ONLINE:!1===s?o.A.OFFLINE:o.A.UNKNOWN}catch(e){(0,c.b)("Error attempting to get agent availability",e),t=o.A.OFFLINE}else t=o.A.UNKNOWN;return n===this.serviceManager.restartCount&&this.serviceManager.fire({type:d.B.AGENT_ARE_ANY_AGENTS_ONLINE,areAnyAgentsOnline:t}),t}async userTyping(e){if(this.serviceDesk&&this.chatStarted)try{await(this.serviceDesk.userTyping?.(e))}catch(e){(0,c.b)("[userTyping] An error with the service desk occurred.",e)}}setMessageErrorState(e,t){this.serviceManager.store.dispatch(a.a.setMessageErrorState(e,t))}async handleAgentJoinedTimeout(){const e=this.serviceManager.store.getState().languagePack.errors_noAgentsJoined,{originalMessage:t,localMessage:n}=(0,i.b)(e);await _([h([n],t)],0,0,!this.isSuspended(),this.serviceManager),this.endChat(!1)}cancelAgentJoinedTimer(){this.waitingForAgentJoinedTimer&&(clearTimeout(this.waitingForAgentJoinedTimer),this.waitingForAgentJoinedTimer=null)}async screenShareUpdateRequestState(e){if(!this.persistedAgentState().isConnected)return;let t;switch(this.closeScreenShareRequestModal(e),e){case o.S.ACCEPTED:t=b;break;case o.S.DECLINED:t=O;break;case o.S.CANCELLED:t=R;break;case o.S.ENDED:t=L;break;default:return}await this.addAgentLocalMessage(t)}async screenShareStop(){this.serviceManager.store.dispatch((0,i.w)(!1)),await this.addAgentLocalMessage(L),await(this.serviceDesk?.screenShareStop?.())}async handleHydration(e,t){const{store:n}=this.serviceManager;let r=!1;const{isConnected:s}=this.persistedAgentState();if(s){if(this.chatStarted=!0,e&&this.serviceDesk?.reconnect)try{n.dispatch((0,i.x)(!0)),setTimeout(this.serviceManager.appWindow.requestFocus),r=await this.serviceDesk.reconnect()}catch(e){(0,c.b)("Error while trying to reconnect to an agent.",e)}if(n.dispatch((0,i.x)(!1)),!this.persistedAgentState().isConnected)return void(this.chatStarted=!1);if(setTimeout(this.serviceManager.appWindow.requestFocus),r)this.showLeaveWarning=!1;else{this.chatStarted=!1;const e=this.isSuspended();if(n.dispatch((0,i.v)()),t){const{agentProfile:t}=this.persistedAgentState();await S(g.A.CHAT_WAS_ENDED,t,!1,e,this.serviceManager),await l(0,e,this.serviceManager)}}}}closeScreenShareRequestModal(e){this.serviceManager.store.dispatch((0,i.y)(!1)),this.screenShareRequestPromise&&(this.screenShareRequestPromise.doResolve(e),this.screenShareRequestPromise=null),this.serviceManager.store.dispatch((0,i.w)(e===o.S.ACCEPTED))}async addAgentLocalMessage(e,t,n=!0,r=!0){t||(t=this.persistedAgentState().agentProfile);const{localMessage:s,originalMessage:i}=await p(e,this.serviceManager,t,n);await _([h([s],i)],0,0,!this.isSuspended(),this.serviceManager)}persistedAgentState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState}isSuspended(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.isSuspended}}class U{constructor(e,t){this.serviceManager=e,this.service=t}updateCapabilities(e){this.serviceManager.store.dispatch((0,i.z)((0,r.A)(e)))}async updateAgentAvailability(e){this.service.chatStarted&&this.serviceManager.store.dispatch((0,i.A)(e))}async agentJoined(e){this.service.chatStarted&&(this.service.cancelAgentJoinedTimer(),this.serviceManager.store.dispatch((0,i.B)(e)),await this.service.addAgentLocalMessage(N,e),this.service.showLeaveWarning&&(await this.service.addAgentLocalMessage(m,null,!1,!1),this.service.showLeaveWarning=!1))}async agentReadMessages(){this.service.chatStarted&&(0,c.e)("[ServiceDeskCallbackImpl] agentReadMessages")}async agentTyping(e){this.persistedAgentState().isConnected&&e!==this.service.isAgentTyping&&(this.serviceManager.store.dispatch((0,i.C)(e)),this.service.isAgentTyping=e)}async sendMessageToUser(e,t){if(!this.service.chatStarted||!e)return;const n="string"==typeof e?(0,u.m)(e):e;(0,u.l)(n),n.output?.generic?.length&&n.output.generic.forEach(e=>{e.agent_message_type||(e.agent_message_type=g.A.FROM_AGENT)});const{serviceManager:r}=this;let s;void 0===t?s=this.persistedAgentState().agentProfile:(s=this.persistedAgentState().agentProfiles[t],s||(s=this.persistedAgentState().agentProfile,s&&(0,c.b)(`Got agent ID ${t} but no agent with that ID joined the conversation. Using the current agent instead.`))),await r.fire({type:d.B.AGENT_PRE_RECEIVE,data:n,agentProfile:s}),n.history.agent_profile=s;const a=n.output.generic.map(e=>(0,i.o)(e,n));await _([h(a,n)],0,0,!this.service.isSuspended(),this.serviceManager),await r.fire({type:d.B.AGENT_RECEIVE,data:n,agentProfile:s})}async beginTransferToAnotherAgent(e){this.service.chatStarted&&(e&&this.serviceManager.store.dispatch((0,i.B)(e)),await this.service.addAgentLocalMessage(C,e))}async agentLeftChat(){this.service.chatStarted&&(await this.service.addAgentLocalMessage(v),this.service.isAgentTyping=!1,this.serviceManager.store.dispatch((0,i.D)()))}async agentEndedChat(){if(!this.service.chatStarted)return;const e=await this.service.firePreEndChat(!0);e.cancelEndChat||await this.service.doEndChat(!0,e.preEndChatPayload,!0,!0,I)}async setErrorStatus(e){if(!this.service.chatStarted)return;const{type:t,logInfo:n}=e,{store:r}=this.serviceManager,{isConnecting:s}=r.getState().agentState;switch(n&&(0,c.b)(`An error occurred in the service desk (type=${t})`,n),s&&e.type===o.E.DISCONNECTED&&e.isDisconnected&&(e={type:o.E.CONNECTING}),e.type){case o.E.DISCONNECTED:e.isDisconnected?(this.service.showingDisconnectedError=!0,await this.service.addAgentLocalMessage(y,null,!0,!1),r.dispatch(a.a.updateInputState({isReadonly:!0},!0))):this.service.showingDisconnectedError&&(this.service.showingDisconnectedError=!1,await this.service.addAgentLocalMessage(T,null,!0,!1),r.dispatch(a.a.updateInputState({isReadonly:!1},!0)));break;case o.E.CONNECTING:{const{languagePack:t}=this.serviceManager.store.getState(),n=e.messageToUser||t.errors_connectingToAgent,{originalMessage:r,localMessage:a}=(0,i.b)(n);await _([h([a],r)],0,0,!this.service.isSuspended(),this.serviceManager),this.serviceManager.store.dispatch((0,i.t)(!1,null)),this.service.chatStarted=!1,this.service.cancelAgentJoinedTimer(),await this.service.fireEndChat(!1,s);break}case o.E.USER_MESSAGE:this.service.setMessageErrorState(e.messageID,o.M.FAILED)}}async setFileUploadStatus(e,t,n){const{store:r}=this.serviceManager;if(r.getState().allMessagesByID[e])if(d.F.COMPLETE,t){if(r.dispatch(a.a.setMessageHistoryProperty(e,"file_upload_status",d.F.COMPLETE)),r.dispatch(a.a.setMessageHistoryProperty(e,"error_state",o.M.FAILED)),o.M.FAILED,n){const{originalMessage:e,localMessage:t}=(0,i.b)(n);t.item.agent_message_type=g.A.INLINE_ERROR,await _([h([t],e)],0,0,!this.service.isSuspended(),this.serviceManager)}}else r.dispatch(a.a.setMessageHistoryProperty(e,"file_upload_status",d.F.SUCCESS)),r.dispatch(a.a.announceMessage({messageID:"fileSharing_ariaAnnounceSuccess"}));else t&&r.dispatch(a.a.fileUploadInputError(e,n,!0));this.service.uploadingFiles.delete(e),this.serviceManager.store.dispatch((0,i.u)(this.service.uploadingFiles.size>0))}async screenShareRequest(){return this.persistedAgentState().isConnected?(this.service.screenShareRequestPromise||(this.service.screenShareRequestPromise=(0,i.r)(),this.serviceManager.store.dispatch((0,i.y)(!0)),await this.service.addAgentLocalMessage(w)),this.service.screenShareRequestPromise):Promise.reject(new Error("Cannot request screen sharing if no chat is in progress."))}async screenShareEnded(){const e=this.serviceManager.store.getState().agentState.isScreenSharing,t=this.service.screenShareRequestPromise;this.service.closeScreenShareRequestModal(o.S.CANCELLED),e?(this.serviceManager.store.dispatch((0,i.w)(!1)),await this.service.addAgentLocalMessage(L)):t&&await this.service.addAgentLocalMessage(R)}persistedAgentState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState}persistedState(){return this.serviceManager.store.getState().persistedToBrowserStorage.chatState.agentState.serviceDeskState}updatePersistedState(e,t=!0){const{store:n}=this.serviceManager;let a;a=t?(0,s.A)({},n.getState().persistedToBrowserStorage.chatState.agentState.serviceDeskState,e):(0,r.A)(e),n.dispatch((0,i.E)((0,i.d)(a)))}}function G(e){return new P(e)}function H(e){if(e)if("object"!=typeof e)(0,c.b)(`The custom service desk does not appear to be valid. The type should be "object" but is "${typeof e}"`,e);else{["startChat","endChat","sendMessageToAgent"].forEach(t=>{const n=e[t];"function"!=typeof n&&(0,c.b)(`The custom service desk does not appear to be valid. The type of property "${t}"should be "function" but is "${typeof n}"`,n,e)});const t=e.getName?.();if(!t)throw Error("The custom service desk does not have a name.");if(t&&("string"!=typeof t||t.length>40))throw new Error(`The custom service desk name "${t}" is not valid.`)}else(0,c.b)("The custom service desk does not appear to be valid. No service desk was provided.",e)}}}]);
//# sourceMappingURL=2093.bundle.js.map