import { ArgTypes, Canvas, Markdown, Meta } from '@storybook/addon-docs/blocks';

import { cdnJs, cdnCss } from "../../../globals/internal/storybook-cdn";
import * as ChainOfThoughtStories from "./chain-of-thought.stories";

<Meta of={ChainOfThoughtStories} parameters={{ previewTabs: { "storybook/docs/panel": { title: "Overview" } } }} />

# Chain of thought

[Source code](https://github.com/carbon-design-system/carbon-ai-chat/tree/main/packages/ai-chat-components/src/components/chain-of-thought) &nbsp;|&nbsp; [Feedback](https://github.com/carbon-design-system/carbon-ai-chat/issues)

{/* <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> */}

## Table of Contents
- [Overview](#overview)
- [Component API](#component-api)
- [JS (via import)](#js-via-import)
- [JS (via CDN)](#js-via-cdn)
- [Feedback](#feedback)

## Overview

The `cds-aichat-chain-of-thought` component displays a collapsible panel showing tool calls and intermediate outputs that an AI agent used to arrive at its final answer. It is primarly focused around tool calling and technical output. You should highly consider using `cds-aichat-reasoning-steps` for most non-debugging use cases.

### Getting started

Here's a quick example to get you started.

```html
<script type="module">
  window.addEventListener("DOMContentLoaded", () => {
    const toggle = document.querySelector(
      "cds-aichat-chain-of-thought-toggle",
    );
    const chainOfThought = document.querySelector(
      "cds-aichat-chain-of-thought",
    );
    const [searchStep, queryStep] =
      chainOfThought.querySelectorAll("cds-aichat-tool-call-data");
    const searchDescription = searchStep.querySelector(
      '[slot="description"]',
    );
    const searchInput = searchStep.querySelector('[slot="input"]');
    const searchOutput = searchStep.querySelector('[slot="output"]');
    const queryDescription = queryStep.querySelector('[slot="description"]');
    const queryOutput = queryStep.querySelector('[slot="output"]');

    toggle.addEventListener("chain-of-thought-toggle", (event) => {
      chainOfThought.open = event.detail.open;
    });

    searchDescription.textContent =
      "Find authentication guidance in the product docs.";
    searchInput.textContent = "```\n{ \"query\": \"API authentication methods\" }\n```";
    searchOutput.textContent = `\`\`\`
{
  "results": [
    {
      title: "Search documentation",
      description: "Find authentication guidance in the product docs",
      tool_name: "documentation_search",
      request: {
        args: {
          query: "API authentication methods",
        },
      },
      response: {
        content: {
          results: [
            {
              title: "OAuth 2.0 Authentication",
              snippet: "Use OAuth 2.0 for user-facing authentication flows.",
            },
          ],
        },
      },
      status: "success",
    },
    {
      title: "Fetch account settings",
      tool_name: "database_query",
      request: {
        args: {
          table: "user_settings",
          user_id: "12345",
        },
      },
      response: {
        content: {
          auth_method: "oauth",
          scopes: ["read", "write"],
        },
      },
      status: "success",
    },
    {
      title: "Draft response",
      tool_name: "response_generator",
      request: {
        args: {
          format: "markdown",
        },
      },
      response: {
        content:
          "You're using **OAuth 2.0** with read and write scopes. Tokens expire after 1 hour.",
      },
      status: "processing",
    },
  ];

  const chainOfThought = document.querySelector("cds-aichat-chain-of-thought");
  chainOfThought.steps = steps;
</script>

<cds-aichat-chain-of-thought
  explainability-text="Show chain of thought"
  input-label-text="Input"
  output-label-text="Output"
  tool-label-text="Tool"
  status-succeeded-label-text="Succeeded"
  status-failed-label-text="Failed"
  status-processing-label-text="Processing"
></cds-aichat-chain-of-thought>
```

## Component API

<ArgTypes of="cds-aichat-chain-of-thought" />

### Step Structure

Each step in the `steps` array should follow the `ChainOfThoughtStep` shape:

- **title**: Plain text name of the step
- **description**: Optional markdown-formatted description of what the tool does
- **tool_name**: Name of the tool that was called
- **request.args**: Arguments sent to the tool (automatically formatted as JSON if applicable)
- **response.content**: Content returned by the tool (supports JSON and markdown)
- **status**: One of "processing", "success", or "failure"

## JS (via import)

```javascript
import "@carbon/ai-chat-components/es/components/chain-of-thought/index.js";
```


<Markdown>{`${cdnJs(["chain-of-thought"])}`}</Markdown>
<Markdown>{`${cdnCss()}`}</Markdown>

## Feedback

Open an issue at https://github.com/carbon-design-system/carbon-ai-chat/issues to provide feedback or request changes.
